---
title: "Linux内核学习笔记之内核活动"
author: Jinkai
date: 2022-12-28 09:00:00 +0800
published: false
math: true
categories: [学习笔记]
tags: [kernel, Linux]
---

## 前言

系统在执行时可以划分为两个大而不同的部分：`核心态`和`用户态`。

系统调用不是在用户态和系统状态之间`切换`的唯一途径。所有支持 Linux 的平台都采用了`中断（interrupt）`的概念

- `硬件中断（hardware interrupt）`：由系统自身和与之连接的外设自动产生。它们用于支持更高效地实现设备驱动程序，也用于引起处理器自身对异常或错误的关注，这些是需要与内核代码进行交互的。
- `软中断（SoftIRQ）`：用于有效实现内核中的延期操作。

## 中断

中断相关的代码特定于不同的体系架构

在内核版本 2.6 的开发期间，这种情况有了很大改善，因为其中引入了一个用于中断和 IRQ 的通用框架。各个平台现在只负责在最低层次上与硬件交互。所有其他功能都由通用代码提供。

### 中断类型

- **同步中断和异常**：这些由`CPU自身`产生，针对当前执行的程序。由于运行时发生的程序设计错误（典型的例子是`除0`），或由于出现了异常的情况或条件，致使处理器需要“外部”的帮助才能处理。
- **异步中断**：由外部设备产生，可能发生在任意时间。不同于同步中断，异步中断并不与特定进程关联。它们可能发生在任何时间，而不牵涉系统当前执行的活动。

如果 CPU 当前不处于核心态，则发起从用户态到核心态的切换。接下来，在内核中执行一个专门的例程，称为`中断服务例程`（interrupt service routine，简称 ISR）或`中断处理程序`（interrupt handler）。

内核试图避免禁用中断防止`嵌套`产生`死锁`

只有`很少的编号`可用于硬件中断，所以必须由几个设备共享一个编号。这个过程称为中断共享（interrupt sharing）。

### 硬件 IRQ

中断不能由处理器外部的外设直接产生，而必须借助于一个称为`中断控制器(interrupt controller)`的标准组件来请求，产生的请求可以称为 IRQ。典型的中断控制器 8256A。

中断控制器除了负责 IRQ 信号的电工处理之外，还会 对 IRQ 编号和中断号进行一个“转换”。在 IA-32 系统上，加 32 即可。如果设备发出 IRQ 9，CPU 将产生中断 4



## 参考

- [深入理解 linux 内核(Professional Linux Kernel Architecture) - Wolfgang Mauerer](https://www.amazon.com/Professional-Kernel-Architecture-Wolfgang-Mauerer/dp/0470343435)
