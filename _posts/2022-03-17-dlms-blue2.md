---
title: "DLMS/COSEM Blue Bookå­¦ä¹ ç¬”è®°"
date: 2022-03-08 09:00:00 +0800
published: true
categories: [æŠ€æœ¯]
tags: [C++, DAO, database]
---

## s4.1 åŸºæœ¬æ¦‚å¿µ

### s4.1.2 Referencing methods

`logical names` (`LN` referencing):The reference for an `attribute` is: `class_id`, value of the `logical_name` attribute, `attribute_index`.The reference for a `method` is: `class_id`, value of the `logical_name` attribute, `method_index`

> å…³äºindexï¼Œ`è§„èŒƒ`å†…çš„å±æ€§æˆ–æ–¹æ³•ä¸º`1å¼€å§‹`çš„`æ­£æ•°`ï¼Œ`ä¸“æœ‰`çš„å±æ€§æˆ–æ–¹æ³•åº”è¯¥è®¾ç½®ä¸º`è´Ÿæ•°`
>
> logical namesä¸­çš„OBISçš„æ¯ä¸ªå­—æ®µï¼ŒA,B,C,D,E,Féƒ½æœ‰å„è‡ªå«ä¹‰ï¼Œåœ¨blue book1ä¸­ç»™å‡º
{: .prompt-tip }

`Short names`(`SN` referencing)ï¼šCOSEMå¯¹è±¡çš„æ¯ä¸ªå±æ€§å’Œæ–¹æ³•éƒ½ç”¨ä¸€ä¸ª`13ä½æ•´æ•°`æ ‡è¯†ã€‚çŸ­åç§°çš„è¯­æ³•ä¸DLMSå‘½åå˜é‡åç§°çš„è¯­æ³•ç›¸åŒã€‚ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨SNå¼•ç”¨è®¿é—®è®¾å¤‡ï¼Œä¸€äº›`short_name`è¢«ä¿ç•™ä¸ºç‰¹æ®ŠCOSEMå¯¹è±¡çš„`base_name(objectName)`ã€‚ä¿ç•™base_namesçš„èŒƒå›´æ˜¯0xFA00åˆ°0xFFF8ã€‚è¿™é‡Œçš„`base_name`å°±æ˜¯cosemç±»çš„`ä¸åŒ…å«åç§»`çš„çŸ­åï¼Œç›¸å½“äºæ¯ä¸ªç±»è¡¨æ ¼ä¸­çš„xï¼Œå¯¹åº”æ¯ä¸ªå±æ€§çš„çŸ­åå«short_nameï¼Œæ˜¯åŒ…å«åç§»çš„

### s4.1.4.6 Attributes

(dyn.)
:å¯¹å¸¦æœ‰æµç¨‹å€¼çš„å±æ€§è¿›è¡Œåˆ†ç±»ï¼Œæµç¨‹å€¼ç”±`ä»ªè¡¨æœ¬èº«æ›´æ–°`ã€‚

(static)
:å¯¹ä¸€ä¸ªå±æ€§è¿›è¡Œåˆ†ç±»ï¼Œè¯¥å±æ€§`ä¸ä¼šç”±ä»ªè¡¨æœ¬èº«æ›´æ–°`(ä¾‹å¦‚`é…ç½®æ•°æ®`ï¼Œ**ä½†å¯é€šè¿‡å¤–éƒ¨é€šä¿¡æ–¹å¼ä¿®æ”¹**)ã€‚

### s4.1.4.14 m/o

m (mandatory)
:The method is mandatory`å¼ºåˆ¶çš„`.

o (optional)
:The method is optional`å¯é€‰çš„`.

#### s4.1.4.17 Selective access

éƒ¨åˆ†å±æ€§æ”¯æŒ`é€‰æ‹©æ€§è®¿é—®`

- â€œ`Profile generic`â€ objects, `buffer` attribute;
- â€œ`Association SN`â€ objects, `object_list` and `access_rights_list` attribute;
- â€œ`Association LN`â€ objects, `object_list` attribute;
- â€œ`Compact data`â€, objects, `compact_buffer` attribute;
- â€œ`Push`â€ objects, `push_object_list` attribute;
- â€œ`Data protection`â€ objects, `protection_object_list` attribute `get_protected_attributes` method and `set_protected_attributes` method.

#### s4.1.6.3 Null-data and delta-value encoding

ç”¨äºarrayå†…`æ•°æ®å‹ç¼©`

`ç©ºå€¼`è¡¨ç¤ºè¯¥å€¼å¯ä»¥ä»å‰ä¸€æ¡è®°å½•ä¸­æ¢å¤ï¼Œæ¯”å¦‚å’Œä¸Šä¸€æ¡å€¼ç›¸åŒ

`å¢é‡å€¼`è¡¨ç¤ºè¯¥å€¼å¯ä»¥ä»å‰ä¸€æ¡è®°å½•ä¸­é€šè¿‡é€’å¢æ–¹å¼æ¢å¤ï¼Œç¬¬ä¸€æ¡å€¼å¿…é¡»æ˜¯ integer æˆ– unsigned ç±»å‹ï¼Œåé¢å°±å¯ä»¥ä¸€æ¡æ¡é€’å¢äº†

### s4.1.8 The COSEM logical device

#### s4.1.8.2 COSEM logical device name (LDN)

æ¯ä¸ªCOSEMé€»è¾‘è®¾å¤‡éƒ½å¯ä»¥ç”±å…¶å”¯ä¸€çš„COSEM LDNæ¥æ ‡è¯†ã€‚LDNå®šä¹‰ä¸ºæœ€å¤š16ä¸ªå­—èŠ‚çš„å­—ç¬¦ä¸²ã€‚`å‰ä¸‰ä¸ªå­—èŠ‚`åº”æºå¸¦`åˆ¶é€ å•†æ ‡è¯†ç¬¦`ã€‚åˆ¶é€ å•†åº”ç¡®ä¿`LDN`ï¼Œä»æ ‡è¯†åˆ¶é€ å•†çš„`3ä¸ªå­—èŠ‚å¼€å§‹`ï¼Œ`åé¢æ˜¯æœ€å¤š13ä¸ªå­—èŠ‚`ï¼Œå¯¹æ¯ä¸ªåˆ¶é€ çš„é€»è¾‘è®¾å¤‡æ˜¯`å”¯ä¸€`çš„ã€‚

#### s4.1.8.3 The â€œassociation viewâ€ of the logical device

ä¸ºäº†è®¿é—®æœåŠ¡å™¨ä¸­çš„COSEMå¯¹è±¡ï¼Œé¦–å…ˆè¦ä¸å®¢æˆ·ç«¯å»ºç«‹åº”ç”¨å…³è”(AAï¼Œapplication association)ã€‚AAsæ ‡è¯†partnersï¼Œå¹¶æè¿°AAå°†åœ¨å…¶ä¸­é€šä¿¡çš„`ä¸Šä¸‹æ–‡`ã€‚ä¸Šä¸‹æ–‡ä¸»è¦å†…å®¹æ˜¯:

- the application context;
- the authentication mechanism;è®¤è¯æœºåˆ¶
- the xDLMS context.

æ ¹æ®å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹çš„AAå…³ç³»ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šæˆäºˆä¸åŒçš„`è®¿é—®æƒé™`ã€‚è®¿é—®æƒé™æ¶‰åŠä¸€ç»„COSEMå¯¹è±¡(`å¯è§å¯¹è±¡`)ï¼Œè¿™äº›å¯¹è±¡å¯ä»¥åœ¨`ç»™å®šçš„AA`ä¸­è¢«è®¿é—®(â€œå¯è§â€)ã€‚æ­¤å¤–ï¼Œå¯¹è¿™äº›COSEMå¯¹è±¡çš„`å±æ€§å’Œæ–¹æ³•`çš„è®¿é—®ä¹Ÿå¯èƒ½åœ¨AAä¸­å—åˆ°é™åˆ¶(ä¾‹å¦‚ï¼ŒæŸç§ç±»å‹çš„å®¢æˆ·ç«¯`åªèƒ½è¯»å–`COSEMå¯¹è±¡çš„`ç‰¹å®šå±æ€§`ï¼Œä½†`ä¸èƒ½å†™å…¥`å®ƒ)ã€‚è®¿é—®æƒä¹Ÿå¯ä»¥è§„å®šæ‰€éœ€çš„å¯†ç ä¿æŠ¤ã€‚

#### s4.1.8.4 Mandatory contents of a COSEM logical device

æ¯ä¸ªé€»è¾‘è®¾å¤‡éƒ½åº”æœ‰ï¼š

- COSEM LDNå¯¹è±¡
- â€œAssociationâ€ (LN or SN)å¯¹è±¡

> å¦‚æœSAP Assignmentå¯¹è±¡å­˜åœ¨ï¼Œâ€œAssociationâ€ (LN or SN)å¯¹è±¡éå¿…é€‰

è¯†åˆ«å›ºä»¶å¿…é€‰å¯¹è±¡ï¼š

- active firmware identifier
- active firmware signature

æ¯ä¸ªå›ºä»¶å¯¹åº”ä»¥ä¸Šä¸¤ä¸ªå¯¹è±¡å„ä¸€ä¸ª

#### s4.1.8.5 Management logical device

ç”¨äºç®¡ç†çš„é€»è¾‘è®¾å¤‡ï¼Œæ¯ä¸ªç‰©ç†è®¾å¤‡å¿…é¡»è¦æœ‰ä¸€ä¸ªã€‚

å¯ä»¥é€šè¿‡`public client`ä½¿ç”¨lowest level securtyè®¿é—®ï¼Œä½œç”¨æ˜¯æ­ç¤ºç‰©ç†è®¾å¤‡`å†…éƒ¨ç»“æ„`ä»¥åŠ`ä¸ŠæŠ¥äº‹ä»¶`

éœ€è¦åŒ…å«ä¸€ä¸ªâ€œSAP assignmentâ€ objectï¼Œå¯ä»¥è¢«public clientè¯»å–ï¼ŒåŒ…å«ç‰©ç†è®¾å¤‡å†…æ‰€æœ‰çš„`é€»è¾‘è®¾å¤‡`å¯¹åº”çš„`SAPä¿¡æ¯`ï¼Œå¦‚æœç‰©ç†è®¾å¤‡åªæœ‰ä¸€ä¸ªé€»è¾‘è®¾å¤‡ï¼Œåˆ™å¯ä»¥çœç•¥

## s4.3 å‚æ•°å’Œæµ‹é‡æ•°æ®çš„æ¥å£ç±»Interface classes for parameters and measurement data

### 4.3.1 Data (class_id = 1, version = 0)

value å¯ä»¥ä½¿ç”¨ä»»ä½• Choice ä¸­å¯é€‰ç±»å‹ï¼Œå’Œ DLMS green book ä¸­å®šä¹‰çš„ Data ç›¸åŒï¼Œä½†å…·ä½“ç±»å‹åœ¨å®ä¾‹åŒ–åå°±ç¡®å®šä¸‹æ¥ï¼Œä¸å¯¹è±¡çš„é€»è¾‘è®¾å¤‡åç»‘å®šï¼Œä¸å…è®¸åŠ¨æ€æ”¹å˜ã€‚

### s4.3.2 Register (class_id = 3, version = 0)

åŒ…å«`å€¼`ï¼ˆvalueï¼‰å’Œ`é‡çº²`ï¼ˆscaler_unit,åŒ…æ‹¬`ç²¾åº¦`(scaler)ã€`å•ä½`(unit)ï¼‰

æ¸…é™¤æ–¹æ³•

### s4.3.3 Extended register (class_id = 4, version = 0)

åŒ…å«`å€¼`ã€`é‡çº²`ã€`çŠ¶æ€`ï¼ˆå‚å®¶è‡ªå®šä¹‰ï¼‰ã€`å¯„å­˜å™¨æ•è·æ—¶é—´`

æ¸…é™¤æ–¹æ³•

### s4.3.4 Demand register (class_id = 5, version = 0)

`éœ€é‡å¯„å­˜å™¨`

å‘¨æœŸæ€§æµ‹é‡æŸä¸ªå€¼å¾—åˆ°å½“å‰å¹³å‡å€¼ä¸ä¸Šæ¬¡å¹³å‡å€¼,`æ»‘å·®å¼`ç»Ÿè®¡ï¼Œ`ç»Ÿè®¡çª—å£`å¯ä»¥æ˜¯`1ä¸ªæˆ–å¤šä¸ªå‘¨æœŸ`

![demand](/assets/img/2022-03-17-dlms-blue2/demand.jpg)

E3è¡¨ç¤ºç¬¬ä¸‰ä¸ªå‘¨æœŸå†…çš„ç”µé‡å¢é‡,`å‡è®¾`å½“å‰æ—¶é—´`å¤§äº`E3ç»Ÿè®¡`ç»“æŸæ—¶é—´`ï¼ˆç¬¬ä¸‰å‘¨æœŸç»“æŸæ—¶é—´ï¼‰ï¼Œ`å°äº`E4ç»Ÿè®¡`ç»“æŸæ—¶é—´`ï¼Œç”µé‡è®°å½•å€¼æ¯”E3ç»Ÿè®¡ç»“æŸæ—¶å¤§`Î”e`

- current_average_value `å½“å‰å¹³å‡å€¼`ï¼Œenergy/3t,energy=E2+E3+Î”e,t=period,3=å‘¨æœŸä¸ªæ•°
- last_average_value `ä¸Šä¸€å¹³å‡å€¼`ï¼Œenergy/3t,energy=E1+E2+E3,t=period,3=å‘¨æœŸä¸ªæ•°
- scaler_unit é‡çº²
- status çŠ¶æ€
- capture_time `last_average_value`è®¡ç®—æ—¶é—´
- start_time_current `current_average_value`ç»Ÿè®¡å¼€å§‹æ—¶é—´, TODO:è¿™ä¸ªstart_timeå¿…é¡»æ˜¯å‘¨æœŸå¼€å§‹æ—¶é—´å—ï¼Ÿå›¾é‡Œæ˜¾ç¤ºè¿™ä¸ªå€¼ä¼šè·³å˜ï¼Œè¯´æ˜start_timeåœ¨è·³å˜,ç»“åˆnext_periodå¥½åƒè¯´å¾—é€šï¼Œæ¯åˆ°æ–°çš„å‘¨æœŸå¼€å§‹ç‚¹æ‰§è¡Œnext_periodï¼Œstart_timeåŠ ä¸€ä¸ªå‘¨æœŸçš„æ—¶é—´ï¼Œå¯¼è‡´åˆ†å­æ€¥å‰§å˜å°
- period `å‘¨æœŸ`
- number_of_periods `å‘¨æœŸä¸ªæ•°`ï¼Œç”¨äº`last_average_value`è®¡ç®—ï¼Œä¸º`1è¡¨ç¤ºåŒºé—´å¼`(block)ï¼Œ`å¤§äº1è¡¨ç¤ºæ»‘å·®å¼`(sliding)

æ–¹æ³•ï¼š

- reset (data) æ¸…é™¤
- next_period (data) è¯¥æ–¹æ³•ç”¨äºè§¦å‘ä¸€ä¸ªæ—¶é—´æ®µçš„æ­£å¸¸ç»ˆæ­¢(å’Œé‡æ–°å¯åŠ¨)ã€‚å…³é—­(ç»ˆæ­¢)å½“å‰æµ‹é‡å‘¨æœŸã€‚`æ›´æ–°capture_timeå’Œstart_time`ï¼Œæ‹·è´current_average_valueåˆ°last_average_valueï¼Œè®¾ç½®current_average_valueä¸ºé»˜è®¤å€¼ã€‚å¼€å§‹ä¸‹ä¸€ä¸ªæµ‹é‡å‘¨æœŸã€‚

### s4.3.5 Register activation (class_id = 6, version = 0)

è¯¥ IC å…è®¸å¯¹ä¸åŒæ”¶è´¹ç»“æ„çš„å¤„ç†è¿›è¡Œå»ºæ¨¡ã€‚ ä¸ºæ¯ä¸ªâ€œRegister activationâ€å¯¹è±¡åˆ†é…â€œRegisterâ€, â€œExtended registerâ€æˆ–â€œDemand registerâ€å¯¹è±¡ç»„ï¼Œå¯¹ä¸åŒç±»å‹çš„é‡ï¼ˆä¾‹å¦‚`æœ‰åŠŸç”µé‡`ã€`æœ‰åŠŸéœ€é‡`ã€`æ— åŠŸç”µé‡`ç­‰ï¼‰è¿›è¡Œå»ºæ¨¡ã€‚ ç”±æ¿€æ´»æ ‡è®°å®šä¹‰çš„è¿™äº›å¯„å­˜å™¨çš„å­ç»„å®šä¹‰äº†ä¸åŒçš„`æ”¶è´¹ç»“æ„`ï¼ˆä¾‹å¦‚ï¼Œ`ç™½å¤©`æ”¶è´¹ã€`å¤œé—´`æ”¶è´¹ï¼‰ã€‚ è¿™äº›æ¿€æ´»æ ‡è®°ä¹‹ä¸€ï¼Œactive_maskï¼Œå®šä¹‰äº†åˆ†é…ç»™â€œRegister activationâ€å¯¹è±¡å®ä¾‹çš„å¯„å­˜å™¨å­é›†æ˜¯æ´»åŠ¨çš„ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœªåŒ…å«åœ¨ä»»ä½•â€œRegister activationâ€å¯¹è±¡çš„ register_assignment å±æ€§ä¸­çš„å¯„å­˜å™¨å§‹ç»ˆå¤„äºå¯ç”¨çŠ¶æ€ã€‚

- register_assignment `å¯„å­˜å™¨åˆ—è¡¨`ï¼ŒåŒ…æ‹¬Registerâ€,â€œExtended registerâ€ or â€œDemand registerâ€ç­‰çš„ç±»idå’ŒOBIS
- mask_list `æ ‡è®°åˆ—è¡¨`ï¼Œæœ‰å¤šä¸ªregister_act_maskï¼Œæ¯ä¸ªregister_act_maskåŒ…å«å”¯ä¸€çš„mask_nameï¼Œæ¯ä¸ªregister_act_maskä¸­çš„index_listä¸­çš„å€¼é¡ºåºä¸register_assignmentä¸­çš„å¯¹è±¡é¡ºåºä¸€ä¸€å¯¹åº”ï¼ŒTODO:ç¤ºä¾‹
- active_mask æ¿€æ´»çš„æ ‡è®°ï¼Œ`mask_list`ä¸­çš„`æŸä¸ªæ ‡è®°`ï¼Œä½¿ç”¨mask_nameå†³å®šï¼Œç”¨äºè¡¨ç¤ºå½“å‰`å¯ç”¨`çš„maskï¼Œè¿›ä¸€æ­¥è¡¨ç¤º`å¯ç”¨`çš„register

æ–¹æ³•ï¼š

- add_register (data) å‘register_assignmentä¸­æ·»åŠ ä¸€ä¸ªé¡¹ï¼Œæ·»åŠ åœ¨æ•°ç»„å°¾éƒ¨
- add_mask (data) æ·»åŠ æˆ–æ›´æ–°mask_list
- delete_mask (data) ä»mask_liståˆ é™¤ä¸€ä¸ªmaskï¼Œä½¿ç”¨mask_name

### s4.3.6 Profile generic (class_id = 7, version = 1)

å…è®¸`å­˜å‚¨ã€æ’åºå’Œè®¿é—®`ç§°ä¸º`æ•è·å¯¹è±¡`çš„æ•°æ®ç»„æˆ–æ•°æ®ç³»åˆ—ã€‚æ•è·å¯¹è±¡æ˜¯å‡ ä¸ª`COSEMå¯¹è±¡`çš„å‡ ä¸ªé€‚å½“`å±æ€§`æˆ–å‡ ä¸ªå±æ€§çš„å‡ ä¸ª`å…ƒç´ `çš„ç»„åˆã€‚æ•è·å¯¹è±¡`å®šæœŸæˆ–ä¸å®šæœŸæ”¶é›†`ã€‚

æ›²çº¿åŒ…å«`æ•è·å¯¹è±¡`ï¼Œå¯é€šè¿‡å€¼çš„èŒƒå›´æˆ–è¾“å…¥èŒƒå›´`æ£€ç´¢èŒƒå›´`å†…æ‰€æœ‰è®°å½•

`æ•è·å¯¹è±¡åˆ—è¡¨`å®šä¹‰äº†è¦ä¿å­˜åœ¨bufferä¸­çš„å€¼ï¼Œåˆ—è¡¨æ˜¯é™æ€çš„ï¼Œä¿è¯`æ¯ä¸ªè®°å½•`éƒ½æ‹¥æœ‰`ç›¸åŒçš„é•¿åº¦å’Œç»“æ„`

ä¿®æ”¹æ•è·åˆ—è¡¨å¿…é¡»æ¸…ç©ºbufferä¸­æ‰€æœ‰è®°å½•ï¼Œbufferè¢«å…¶ä»–profileä½¿ç”¨ä¹Ÿå¿…é¡»æ¸…ç©ºbufferã€‚ä»¥ä¿è¯å®ƒä»¬çš„ç¼“å†²åŒºæ¡ç›®çš„åŒè´¨æ€§

è®°å½•å¯ä»¥æŒ‰`æŸä¸ªå­—æ®µ`è¿›è¡Œ`æ’åº`ï¼Œå¦‚`æ—¶é—´`ï¼Œæˆ–æ˜¯æŒ‰å…ˆè¿›åå‡ºçš„æ ˆçš„æ–¹å¼æ’åºã€‚ä¾‹ï¼ŒæŒ‰ç…§Demand registerä¸­çš„last_average_valueå€¼æ¥ä»å°åˆ°å¤§æ’åºè·å¾—æœ€å¤§éœ€é‡register

#### sæ›²çº¿æ•°æ®å¤§å°é™åˆ¶å‚æ•°

- è®°å½•æ•°entries_in_use
- æœ€å¤§ä¿ç•™æ¡æ•°ã€‚å½“è®°å½•æ•°æ»¡æ—¶ï¼Œæ–°æ•è·æ•°æ®ä¼šè¦†ç›–`æœ€ä¸é‡è¦`çš„ä¸€æ¡æ•°æ®ï¼Œé‡è¦åº¦æ ¹æ®`æ’åºæ–¹å¼`è·å¾—ï¼Œå¦‚æ ¹æ®æ—¶é—´æ’åºï¼Œæœ€ä¸é‡è¦çš„æ•°æ®å°±æ˜¯æ—¶é—´æœ€æ—©çš„æ•°æ®
- ç¼“å†²åŒºç‰©ç†é™åˆ¶

#### sé€‰æ‹©æ€§è®¿é—®

- æŒ‰ç…§å€¼çš„èŒƒå›´ï¼š

    å€¼å¯ä»¥æ˜¯æ—¶é—´ï¼Œæˆ–æ˜¯æŸä¸ª**æ•è·å¯¹è±¡**çš„å€¼ï¼Œä»…å…è®¸ç®€å•ç±»å‹ã€‚

- æŒ‰ç…§æ’åºåè®°å½•å­˜å‚¨çš„é¡ºåºèŒƒå›´ï¼š

    å¦‚ä»ç¬¬ä¸€æ¡è®°å½•ï¼ˆ`é‡è¦æ€§`æœ€é«˜ï¼‰åˆ°ç¬¬ä¸‰æ¡

    å¦‚ä»æŸä¸ªå€¼æœ€å¤§çš„è®°å½•åˆ°ç¬¬ä¸‰å¤§çš„è®°å½•ï¼Œéœ€è¦é‡æ–°ä¸´æ—¶æ’åº

#### så±æ€§

- buffer åŒ…å«è®°å½•åºåˆ—ï¼Œæ¯ä¸ªè®°å½•åŒ…å«è‹¥å¹²æ•è·å¯¹è±¡
- capture_objects æ•è·å¯¹è±¡åˆ—è¡¨ï¼Œæ•°ç»„å½¢å¼
- capture_period è‡ªåŠ¨æ•è·å‘¨æœŸï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œå¤§äº1è¡¨ç¤ºè¾¾åˆ°å‘¨æœŸæ•è·ï¼Œç­‰äº0è¡¨ç¤ºä¸è‡ªåŠ¨æ•è·ï¼Œéœ€è¦æ‰‹åŠ¨è§¦å‘
- sort_method `æ’åºæ–¹å¼`ï¼Œé»˜è®¤ä¸º`å…ˆè¿›å…ˆå‡º`æ’åºã€‚å¦‚æœprofileå·²ç»æ’åºï¼Œæ’å…¥æ–°çš„è®°å½•æ—¶ï¼Œå°†è®°å½•æ’å…¥é€‚å½“ä½ç½®ï¼Œç§»åŠ¨è¯¥ä½ç½®ä¹‹åæ‰€æœ‰è®°å½•ï¼Œæœ€ä¸é‡è¦è®°å½•å¯èƒ½åœ¨bufferæ»¡åä¸¢å¤±ã€‚å¦‚æœæ–°è®°å½•çš„é‡è¦åº¦æœ€ä½ä¸”bufferå·²æ»¡ï¼Œåˆ™è¯¥è®°å½•ä¸æ’å…¥
- sort_object æ’åºä¾æ®ï¼ˆå¯¹è±¡ï¼‰,æ­¤å±æ€§æŒ‡å®šæ’åºæ‰€åŸºäºçš„å¯„å­˜å™¨æˆ–æ—¶é’Ÿ
- entries_in_use å½“å‰è®°å½•æ€»æ•°
- profile_entries è®°å½•ä¸Šé™

#### sæ–¹æ³•

- reset (data) æ¸…ç©ºbufferï¼Œentries_in_useæ¸…é›¶ï¼Œå…¶ä»–é…ç½®ä¸å˜
- capture (data) æ‰‹åŠ¨è§¦å‘æ•è·ï¼Œ`è¯»å–`æ¯ä¸ªæ•è·å¯¹è±¡çš„`å€¼`ï¼Œ`ç”Ÿæˆè®°å½•æ’å…¥buffer`,åŒæ ·ä¸ä¼šæ”¹å˜æ•è·å¯¹è±¡åˆ—è¡¨

#### sä¿®æ”¹æ•è·å¯¹è±¡åˆ—è¡¨åè¡Œä¸º

`è°ƒç”¨`ä½¿ç”¨äº†è¯¥æ•è·å¯¹è±¡åˆ—è¡¨çš„profileçš„`resetæ“ä½œ`ï¼Œéœ€è¦æ¸…ç©ºbuffer

#### sé™åˆ¶

å®šä¹‰æ•è·å¯¹è±¡åˆ—è¡¨æ—¶ï¼Œé¿å…`ç›¸äº’æˆ–å¾ªç¯å¼•ç”¨`ã€‚ï¼ˆå®ç°æ—¶å¯ä»¥é™æ€æ£€æŸ¥å‡ºæ¥ï¼‰

### s4.3.7 Utility tables (class_id = 26, version = 0)

å…è®¸å°è£… ANSI C12.19:2012 table æ•°æ®

ANSI C12.19 æ˜¯ä¸€ä¸ªæ ‡å‡†ï¼Œå®ƒå®šä¹‰äº†ç”¨äºç”µè¡¨å’Œå…¶ä»–è®¾å¤‡çš„æ•°æ®ä¼ è¾“çš„è¡¨æ ¼ï¼ˆtablesï¼‰æ ¼å¼ã€‚è¿™äº›è¡¨æ ¼æ ¼å¼å…è®¸ç”µåŠ›å…¬å¸å’Œå…¶ä»–æœºæ„æ ‡å‡†åŒ–è®¾å¤‡ä¹‹é—´çš„æ•°æ®äº¤æ¢ã€‚ANSI C12.19 ä¸»è¦ç”¨äºæ™ºèƒ½ç”µè¡¨ï¼ˆsmart metersï¼‰å’Œå…ˆè¿›çš„è®¡é‡åŸºç¡€è®¾æ–½ï¼ˆAdvanced Metering Infrastructureï¼ŒAMIï¼‰ç³»ç»Ÿä¸­ã€‚

å…¶å®å’Œ COSEM éå¸¸åƒï¼Œä¸è¿‡å®ƒæ˜¯æ ¹æ®è¡¨æ ¼æ¥è¡¨ç¤ºå’Œä¼ é€’æ•°æ®ã€‚æ‰€ä»¥è¯¥ç±»çš„åŠŸèƒ½å°±æ˜¯æä¾›ä¸¤ç§æ•°æ®æ ¼å¼æ ‡å‡†ä¹‹é—´çš„è½¬æ¢ã€‚

#### è¡¨æ ¼ 0ï¼ˆTable 0ï¼‰ï¼šåˆ¶é€ å•†ä¿¡æ¯è¡¨

| å­—æ®µåç§°         | æ•°æ®ç±»å‹ | é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰ | æè¿°         |
| ---------------- | -------- | ------------ | ------------ |
| Manufacturer ID  | String   | 4            | åˆ¶é€ å•†æ ‡è¯†ç¬¦ |
| Model Number     | String   | 8            | å‹å·ç¼–å·     |
| Firmware Version | String   | 4            | å›ºä»¶ç‰ˆæœ¬     |

#### è¡¨æ ¼ 1ï¼ˆTable 1ï¼‰ï¼šé…ç½®è¡¨

| å­—æ®µåç§°          | æ•°æ®ç±»å‹ | é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰ | æè¿°       |
| ----------------- | -------- | ------------ | ---------- |
| Meter ID          | String   | 8            | ç”µè¡¨æ ‡è¯†ç¬¦ |
| Installation Date | Date     | 4            | å®‰è£…æ—¥æœŸ   |
| Meter Type        | String   | 2            | ç”µè¡¨ç±»å‹   |

#### è¡¨æ ¼ 2ï¼ˆTable 2ï¼‰ï¼šç”µèƒ½æ•°æ®è¡¨

| å­—æ®µåç§°        | æ•°æ®ç±»å‹ | é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰ | æè¿°            |
| --------------- | -------- | ------------ | --------------- |
| Reading Date    | Date     | 4            | è¯»å–æ—¥æœŸ        |
| Energy Consumed | Float    | 4            | æ¶ˆè€—ç”µèƒ½ï¼ˆkWhï¼‰ |
| Peak Demand     | Float    | 4            | æœ€å¤§éœ€é‡ï¼ˆkWï¼‰  |

### s4.3.8 Register table (class_id = 61, version = 0)

å¯¹`åŒæ„`æ¡ç›®ã€å¤šä¸ªå¯¹è±¡çš„`ç›¸åŒå±æ€§`è¿›è¡Œ`åˆ†ç»„`ï¼Œè¿™äº›å¯¹è±¡éƒ½æ˜¯`ç›¸åŒIC`çš„å®ä¾‹,å¹¶ä¸”åœ¨å®ƒä»¬çš„logical_name (OBISä»£ç )ä¸­ï¼Œå€¼ç»„`Aåˆ°D`å’Œ`F`ä¸­çš„å€¼æ˜¯`ç›¸åŒ`çš„ã€‚

ç”¨å¤„å°±æ˜¯ä¸éœ€è¦å®šä¹‰ä¸€å¤§å †çš„ç›¸ä¼¼çš„ Register å¯¹è±¡ã€‚ä¸è¿‡æœ¬ç±»ä»…ç”¨äºä¿å­˜è¿™äº›å€¼ï¼Œè®¿é—®è¿™äº›å€¼ä¾ç„¶æ˜¯é€šè¿‡å…·ä½“å¯¹è±¡çš„ logical_nameï¼Œä¸€èˆ¬ä¸ä¼šç›´æ¥è¯»å–æœ¬ç±»å¯¹è±¡ã€‚

å±æ€§ï¼š

- logical_name å½“é€»è¾‘åä¸ºA.B.C.D.255.Fæ—¶ï¼Œåªèƒ½æ•è·`ä¸€ä¸ªå±æ€§`ï¼Œå¦‚valueï¼ˆè§table_cell_definitionï¼Œæ­¤æ—¶å…¶ä¸­çš„logical_nameå°±å’Œæœ¬å€¼ç›¸åŒï¼‰ã€‚å½“é€»è¾‘åä¸ºA.B.98.10.X.255æ—¶ï¼Œå¯ä»¥æ•è·æœ‰å…³å¯¹è±¡çš„ä¸åŒå±æ€§
- table_cell_values ä¿å­˜æ•è·å±æ€§çš„å€¼ï¼ˆå¯é€‰CHOICEç§ç±»å°±æ˜¯registerå¯¹è±¡çš„valueå±æ€§çš„ç±»å‹ï¼Œå› ä¸ºä¿å­˜çš„æ˜¯å¤šä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼‰ï¼Œå¯å‹ç¼©

  å‹ç¼©æ¡ä»¶ï¼š

  å¦‚æœæ•è·çš„å±æ€§æ˜¯attribute_0ï¼ˆindex 0,è¡¨ç¤ºæ•è·æ‰€æœ‰å±æ€§ï¼‰ï¼Œå¦‚æœå®ƒä»¬çš„å€¼æ˜¯ç›¸åŒçš„(ä¾‹å¦‚`scaler_unit`)ï¼Œåˆ™è¿™äº›`å†—ä½™å€¼`å¯ä»¥è¢«â€œ`null-data`â€æ›¿æ¢ï¼Œåç»­å¯ä»¥æ— æŸæ¢å¤ã€‚
- table_cell_definition
  - class_idå®šä¹‰æ•è·å±æ€§çš„å¯¹è±¡çš„å…¬å…±Class_id;
  - logical_nameåŒ…å«å¯¹è±¡çš„é€šç”¨é€»è¾‘åï¼ŒE = 255(é€šé…ç¬¦);
  - group_E_valuesåŒ…å«å•å…ƒæ ‡è¯†ç¬¦åˆ—è¡¨ï¼Œç±»å‹ä¸ºunsignedï¼Œåœ¨DLMS UA 1000-1 Ed 15 Part 1:2021çš„ç›¸åº”è¡¨ä¸­å®šä¹‰;
  - attribute_indexæ˜¯æŒ‡å‘å¯¹è±¡å†…å±æ€§çš„æŒ‡é’ˆã€‚Attribute_index 0è¡¨ç¤ºæ‰€æœ‰å…¬å…±å±æ€§ã€‚ï¼ˆæŒ‰ç…§æœ¬ç±»ä¸­çš„ logical_name çš„æè¿°ï¼Œå½“æ ¼å¼ä¸º A.B.C.D.255.F ï¼Œå¼ºåˆ¶ä»…èƒ½æ•è·ä¸€ä¸ªå±æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶ä¸èƒ½ä¸º 0ï¼‰

  ç‰¹æ®Šæƒ…å†µï¼šå½“æœ¬ç±»çš„ logical_name æ ¼å¼ä¸º A.B.C.D.255.F æ—¶ï¼Œæœ¬å±æ€§çš„å€¼ä¼šè¢«å¼ºåˆ¶ï¼š

  - class_id å¿…é¡»ä¸º  1 â€œDataâ€, 3 â€œRegisterâ€ or 4 â€œExtended registerâ€
  - logical_name å¿…é¡»å’Œæœ¬ç±»çš„ logical_name ç›¸åŒ
  - attribute_index å¿…é¡»ä¸º 2(ä»…æ•è· value å±æ€§)
- scaler_unit é‡çº²ï¼Œå½“â€œRegisterâ€æˆ–â€œExtended Registerâ€å¯¹è±¡çš„â€œvalueâ€å±æ€§è¢«æ•è·æ—¶ï¼Œscaler_unitåº”ä¸ºæ‰€æœ‰å¯¹è±¡çš„`å…¬å…±å±æ€§`ã€‚å¦‚æœæ˜¯å…¶ä»–å±æ€§æˆ–æ˜¯å…¶ä»–ICï¼Œåˆ™`è¯¥å±æ€§æ— ç”¨ä¸”ç¦æ­¢è®¿é—®`

æ–¹æ³•ï¼š

- reset (data) æ¸…ç©ºtable_cell_values
- capture (data) æ•è·ï¼Œå°†åŸICå¯¹è±¡ä¸­çš„å€¼æ‹·è´åˆ°table_cell_valuesä¸­ï¼Œå¦‚æœtable_cell_definitionä¸­çš„attribute_indexä¸º0ï¼Œåˆ™æ•è·æ‰€æœ‰å±æ€§

table_cell_definitionè¢«å†™å…¥æ—¶çš„åŠ¨ä½œï¼š

è‡ªåŠ¨è°ƒç”¨resetæ–¹æ³•æ¸…ç©ºåŸæ•°æ®ï¼Œå¦‚æœéœ€è¦æ•è·çš„å±æ€§çš„å ç”¨ç©ºé—´è¿‡å¤§ï¼Œtable_cell_definitionçš„å†™å…¥ä¼šè¢«æ‹’ç»

### s4.3.9 Status mapping (class_id = 63, version = 0)

è¯¥ICå…è®¸å°†`çŠ¶æ€å­—(status_word)ä¸­çš„ä½`æ˜ å°„åˆ°`å¼•ç”¨è¡¨`ä¸­çš„`é¡¹`ã€‚

- status_word çŠ¶æ€å­—ï¼Œn*8æ¯”ç‰¹ï¼Œæœ€å¤§65536æ¯”ç‰¹
- mapping_table åŒ…å«status_wordåˆ°å¼•ç”¨è¡¨ä¸­ä½ç½®çš„æ˜ å°„ã€‚
  - ref_table_id è¡¨ç¤ºå¼•ç”¨è¡¨çš„id
  - ref_table_mappingï¼ˆchoiceï¼šlong-unsignedæˆ–long-unsignedæ•°ç»„ï¼‰ï¼šè¯¥å€¼å¯¹åº”`å¼•ç”¨è¡¨`(reference tableï¼Œè§ 6.2.46, 6.2.49, 6.2.50, 6.2.55 and 6.3.7)ä¸­çš„`ä¸€æ¡è®°å½•`ï¼Œè¯¥è®°å½•å¯¹åº”status_wordä¸­çš„ç¬¬ä¸€ä½ï¼Œè¯¥è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•å¯¹åº”status_wordä¸­çš„ç¬¬äºŒä½ï¼Œç›´åˆ°status_wordçš„æœ€åä¸€ä½

    - å¦‚æœè¯¥å€¼é€‰æ‹©`long-unsigned`ï¼Œåˆ™è¡¨ç¤ºå¯¹äºå¼•ç”¨è¡¨çš„å¼•ç”¨èµ·å§‹ç´¢å¼•(index)

      å‡è®¾status_wordä¸º10000001ï¼Œref_table_mappingçš„long-unsignedå€¼ä¸º3ï¼Œå¯¹äºå¼•ç”¨è¡¨çš„ç¬¬3æ¡è®°å½•

      |status_wordä½å€¼|å¼•ç”¨è¡¨ç´¢å¼•|
      |:---:|:---:|
      |1|3|
      |0|4|
      |0|5|
      |...|...|
      |1|10|

    - å¦‚æœè¯¥å€¼é€‰æ‹©`array`ï¼šarrayä¸­çš„æ¯ä¸ªå€¼éƒ½æ˜¯å¼•ç”¨è¡¨çš„ä¸€ä¸ªç´¢å¼•(index)ï¼Œå¯¹åº”å¼•ç”¨è¡¨ä¸­çš„ä¸€æ¡è®°å½•ï¼Œå¦‚arrayç¬¬ä¸€ä¸ªå€¼ä¸º8ï¼Œè¡¨ç¤ºå¼•ç”¨è¡¨çš„ç¬¬9æ¡è®°å½•å¯¹åº”statusä¸­çš„ç¬¬1ä½ã€‚

### s4.3.10 Compact data (class_id: 62, version = 1)

ç´§å‡‘æ•°æ®

Compact data IC çš„å®ä¾‹å…è®¸æ•è·ç”±capture_objectså±æ€§ç¡®å®šçš„COSEMå¯¹è±¡å±æ€§å€¼ã€‚æ•è·å¯ä»¥å‘ç”Ÿåœ¨:

- åœ¨å¤–éƒ¨è§¦å‘å™¨ä¸Š(æ˜¾å¼æ•æ‰);
- åœ¨è¯»å–compact_bufferå±æ€§æ—¶(éšå¼æ•è·)ã€‚

ç”±capture_methodå±æ€§ç¡®å®š

å€¼ä¿å­˜åœ¨compact_buffer attributeä¸­ï¼Œä»¥octet-stringå½¢å¼

è¿™ç»„æ•°æ®ç±»å‹ç”±template_idå±æ€§æ ‡è¯†ã€‚æ•è·çš„æ¯ä¸ªå±æ€§çš„æ•°æ®ç±»å‹ç”±template_descriptionå±æ€§ä¿å­˜ã€‚

å®¢æˆ·ç«¯å¯ä»¥ç”¨æœªå‹ç¼©çš„å½¢å¼é‡æ–°æ„é€ æ•°æ®(è§£å‹)ï¼Œå³åŒ…æ‹¬COSEMå±æ€§æè¿°ç¬¦ã€æ•°æ®ç±»å‹å’Œä½¿ç”¨capture_objectsã€template_idå’Œtemplate_descriptionå±æ€§çš„æ•°æ®å€¼ã€‚

å±æ€§ï¼š

- compact_buffer æ•è·çš„å±æ€§çš„å€¼ï¼Œoctet-stringå½¢å¼ï¼Œå½“ç±»å‹ä¸ºoctet-string, bit-string, visible-string, utf8-string or arrayæ—¶ï¼Œé•¿åº¦ä¹ŸåŒ…å«åœ¨å†…ã€‚ï¼ˆä¸åŒäºprofileï¼Œè¿™ä¸ªç±»ä¸­çš„compact_bufferå°±æ˜¯ä¸ªoctet-stringï¼Œä¸æ˜¯arrayï¼Œä¹Ÿå°±æ˜¯åªæœ‰ä¸€æ¡ï¼‰
- capture_objects æŒ‡å®šåˆ†é…ç»™â€œCompact dataâ€å¯¹è±¡å®ä¾‹çš„`COSEMå¯¹è±¡å±æ€§åˆ—è¡¨`ï¼Œä¸¤ç§é€‰æ‹©æ€§è®¿é—®æ–¹å¼ï¼š
  - `ç›¸å¯¹é€‰æ‹©æ€§è®¿é—®`ï¼šç›¸å¯¹å½“å‰çš„æ—¥æœŸæˆ–å½“å‰çš„è®°å½•è¿”å›è®°å½•ï¼Œç”±data_indexå…ƒç´ æ§åˆ¶
  - `ç»å¯¹é€‰æ‹©æ€§è®¿é—®`ï¼šæ ¹æ®æ˜ç¡®çš„æ—¶é—´èŒƒå›´æˆ–è®°å½•èŒƒå›´è¿”å›è®°å½•ï¼Œç”±restriction_elementæ§åˆ¶ï¼Œåˆ—ï¼ˆcolumnsï¼‰æ˜¯ç”±data_indexçš„MS byte(Most Significant byte,æ„ä¸ºæœ€é«˜æœ‰æ•ˆå­—èŠ‚)çš„ä½åŠå­—èŠ‚ï¼ˆå³è¾¹4ä½ï¼‰å†³å®šçš„

  - data_index:æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒ`é€‰æ‹©`å…·æœ‰å¤æ‚æ•°æ®ç±»å‹(ç»“æ„æˆ–æ•°ç»„)çš„å±æ€§çš„ä¸€ä¸ªæˆ–å‡ ä¸ª`ç‰¹å®šå…ƒç´ `:
    - å¦‚æœå±æ€§çš„æ•°æ®ç±»å‹æ˜¯ç®€å•ç±»å‹ï¼Œåˆ™è¯¥å€¼æ— æ„ä¹‰
    - å¦‚æœå±æ€§çš„æ•°æ®ç±»å‹æ˜¯ç»“æ„ä½“æˆ–æ•°ç»„ï¼ˆéprofile genericå¯¹è±¡çš„bufferï¼‰ï¼Œåˆ™è¯¥å€¼æŒ‡å‘è¯¥ç»“æ„ä½“æˆ–æ•°ç»„ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å®šå…ƒç´ 
    - å¦‚æœå±æ€§çš„æ•°æ®ç±»å‹æ˜¯profile genericå¯¹è±¡çš„bufferï¼Œè¯¥å€¼åŒ…å«ç›¸å¯¹é€‰æ‹©æ€§è®¿é—®çš„å‚æ•°ï¼Œå¦‚å½“å‰æ—¥æœŸæˆ–è®°å½•
  
    |data-index:|MS-Byte|MS-Byte|LS-Byte|
    |:---:|:---:|:---:|:---:|
    ||Upper nibble|`Lower nibble`||
    |ä¾‹å­:|0000|0000|00000000|
  
    - 0x0000: æ ‡è¯†æ•´ä¸ªå±æ€§;
    - 0x0001åˆ°0x0FFF: æ ‡è¯†å¤æ‚å±æ€§ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚å¤æ‚å±æ€§ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ç”±data_index 1(0x0001)æ ‡è¯†;
    - 0x1000åˆ°0xFFFF: å¯¹ä¿å­˜Profile genericå¯¹è±¡çš„bufferçš„æ•°ç»„è¿›è¡Œç›¸å¯¹é€‰æ‹©æ€§è®¿é—®ã€‚æ•°æ®ç´¢å¼•é€‰æ‹©æœ€è¿‘(æœ€è¿‘)æ—¶é—´æ®µå†…çš„æ¡ç›®ï¼Œæˆ–æœ€è¿‘(æœ€è¿‘)æ¡ç›®å†…çš„æ¡ç›®ï¼Œä»¥åŠæ•°ç»„ä¸­çš„åˆ—ã€‚
      - å‚è€ƒTable 9 â€“ Encoding of selective access parameters with data_indexã€‚ä¾‹ï¼Œ0x830Cï¼ŒMS-Byteä¸­çš„é«˜4ä½ä¸º0x8ï¼Œè¡¨ç¤ºåŒ…æ‹¬å½“å‰å°æ—¶åœ¨å†…çš„æœ€åä¸€ä¸ªå®Œæ•´å°æ—¶æ•°ï¼Œä½4ä½ä¸º0x3ï¼Œè¡¨ç¤ºå‰3åˆ—ï¼ŒLS-Byteä¸º0x0C,è¡¨ç¤º12å°æ—¶ï¼Œç»¼ä¸Šï¼Œè¯¥å€¼è¡¨ç¤ºé€‰æ‹©æœ€å12ä¸ªå°æ—¶å†…çš„å‰3åˆ—æ•°æ®
  - restriction_elementï¼šå½“å±æ€§çš„æ•°æ®ç±»å‹æ˜¯profile genericå¯¹è±¡æ—¶ï¼Œè¯¥å€¼ç”¨äºè¡¨ç¤º`ç»å¯¹é€‰æ‹©æ€§è®¿é—®`çš„å‚æ•°ï¼Œæ—¶é—´èŒƒå›´ï¼Œè®°å½•åºå·èŒƒå›´ï¼Œ
    - æ­¤æ—¶çš„data_indexæ¡ä»¶ï¼š
      - MS Byteé«˜4ä½ä¸º0ï¼ˆä¸º1çš„è¯è¡¨ç¤ºç›¸å¯¹é€‰æ‹©æ€§è®¿é—®ï¼‰
      - MS Byteä½4ä½ä¸º0x0åˆ°0xF
      - Lower byteä¸º0
    - restriction_typeè¡¨ç¤ºé€‰æ‹©æ€§è®¿é—®çš„æ–¹å¼
    - restriction_valueè¡¨ç¤ºé€‰æ‹©æ€§è®¿é—®èŒƒå›´

- template_id åŒ…å«æ¨¡æ¿çš„`æ ‡è¯†ç¬¦`ã€‚å®ƒåº”å”¯ä¸€æ ‡è¯†â€œCompact dataâ€ICçš„å®ä¾‹å’Œ template_descriptionã€‚
- template_description æ¯ä¸ªè¢«æ•è·çš„å±æ€§çš„`æ•°æ®ç±»å‹`ï¼Œç”±æœåŠ¡ç«¯è‡ªåŠ¨ç”Ÿæˆï¼Œæ˜¯ä¸€ä¸ªç±»ä¼¼äº AXDR ç¼–ç åçš„ OCTET-STRINGï¼Œæ ¹æ®capture_objectsï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
  - ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯0x02ç»“æ„ä½“tag
  - åé¢æ˜¯æ•°é‡ï¼Œå˜é•¿ï¼Œå’Œcapture_objectsæ•°é‡ç›¸åŒ
  - åé¢æ˜¯æ¯ä¸ªå±æ€§çš„æ•°æ®ç±»å‹ï¼Œä¸capture_objectsä¸€ä¸€å¯¹åº”:
    - å¯¹äºå…·æœ‰ç®€å•æ•°æ®ç±»å‹çš„å±æ€§ï¼Œè¯¥å€¼ä¸€ä¸ªå­—èŠ‚ï¼ŒåŒ…å«ç±»å‹tagï¼Œå¦‚`bit-string[4]`(ä¸å«é•¿åº¦ï¼Œé•¿åº¦åœ¨ compact_buffer ä¸­(æœ¬ç±»çš„è®¾è®¡æ€è·¯å°±æ˜¯æŠŠå˜åŒ–çš„æ•°æ®æ”¾åœ¨ compact_buffer ä¸­ï¼Œå¦‚é•¿åº¦ã€valueï¼›ä¸å˜çš„æ•°æ®ï¼Œå¦‚ç±»å‹ç­‰ï¼Œæ”¾åœ¨ template_description ä½œä¸ºå…±äº«çš„å¸¸é‡))
    - å¯¹äº`array[1]`ï¼Œè¯¥å€¼ä¸º0x01ï¼Œåé¢æ˜¯å…ƒç´ çš„ç±»å‹ï¼ˆæ•°ç»„å†…æ‰€æœ‰å…ƒç´ éƒ½ç›¸åŒï¼Œæ‰€ä»¥å°±ä¸€ä¸ªï¼‰ã€‚æ•°ç»„é•¿åº¦ä¹Ÿæ˜¯æ”¾åœ¨ compact_buffer ä¸­
    - å¯¹äº`structure[2]`ï¼Œè¯¥å€¼ä¸º0x02,åé¢æ˜¯å…ƒç´ æ•°ç›®ï¼Œåé¢æ˜¯æ¯ä¸ªå…ƒç´ çš„ç±»å‹
- capture_method å®šä¹‰compact_bufferæ›´æ–°çš„æ–¹å¼ï¼š
  - 0ï¼šåœ¨è°ƒç”¨Capture (data)æ–¹æ³•æ—¶æ•è·ã€‚è¿™å¯èƒ½å‘ç”Ÿåœ¨è¿œç¨‹æˆ–æœ¬åœ°(æ˜¾å¼æ•è·)
  - 1ï¼šè¯»å–compact_bufferå±æ€§æ—¶æ•è·(éšå¼æ•è·)

æ–¹æ³•ï¼š

- reset(data) ä»…æ¸…ç©ºcompact_buffer
- capture(data) å°†æ•è·å¯¹è±¡çš„å€¼å¡«å……è‡³compact_bufferä¸­ï¼Œ**ä¸ä¼šè§¦å‘æ•è·å¯¹è±¡å†…çš„ä»»ä½•å…¶ä»–æ“ä½œ**ï¼Œå¦‚capture()æˆ–reset()

å¯¹capture_objectsçš„ä»»ä½•ä¿®æ”¹ï¼Œå¿…é¡»`é‡ç½®`compact_bufferä»¥åŠ`è‡ªåŠ¨æ›´æ–°`template_description

### s4.3.11 Measurement data monitoring objects (class_id = 66, version = 0) (æ–°å¢)

> æœ¬ç±»ä¸­æåˆ°çš„è§¦å‘(trigger)å°±æ˜¯æŒ‡è°ƒç”¨æœ¬ç±»çš„ trigger(data) æ–¹æ³•

ç”¨äºé‡‡æ ·æ•°æ®ï¼Œä½¿ç”¨ç¯å½¢ç¼“å†²åˆ†åˆ«ä¿å­˜è§¦å‘å‰çš„å‡ æ¬¡é‡‡æ ·ç»“æœå’Œè§¦å‘åçš„å‡ æ¬¡é‡‡æ ·ç»“æœï¼Œæœ¬ç±»å‹çš„å‚æ•°åŒ…å«é‡‡æ ·å‘¨æœŸå’Œé‡‡æ ·ä¿ç•™æ¡æ•°ã€‚

- waveform_data ä¿å­˜çš„é‡‡æ ·æ•°æ®ï¼Œä½¿ç”¨ compact-arrayï¼Œæ•°ç»„å…ƒç´ ç±»å‹ä¸ºç®€å•ç±»å‹(åªèƒ½é‡‡æ ·ç®€å•ç±»å‹)ã€‚ä¸€æ—¦å¯¹è±¡å®ä¾‹åŒ–ï¼Œç±»å‹ä¾¿ç¡®å®šï¼Œæ— æ³•æ”¹å˜ã€‚ä¿å­˜äº†è§¦å‘å‰å’Œè§¦å‘åçš„æ•°æ®ï¼Œæ‰€ä»¥æ€»æ¡æ•°ä¸ºè¿™ä¸¤è€…ä¹‹å’Œ(å±æ€§7+å±æ€§8, number_of_samples_before_trigger+number_of_samples_after_trigger)ã€‚
- trigger_time è°ƒç”¨è§¦å‘æ–¹æ³•çš„æ—¶é—´ï¼Œå•ä½ä¸ºå¾®ç§’ã€‚é€šè¿‡è¯¥å±æ€§å°±èƒ½åŒºåˆ†ä¿å­˜åœ¨ waveform_data å†…çš„æ•°æ®å“ªäº›å±äºè§¦å‘å‰ï¼Œå“ªäº›å±äºè§¦å‘åã€‚
- trigger_source è§¦å‘æºå’ŒåŸå› ï¼Œè§¦å‘æºåˆ†ä¸ºæœ¬åœ° script å’Œè¿œç¨‹è°ƒç”¨ã€‚ä»…ä¸ºæœ¬åœ° script æ—¶æ‰éœ€è¦è§¦å‘åŸå› ã€‚
- status æä¾›æœ‰å…³æ³¢å½¢æµ‹é‡çŠ¶æ€çš„ä¿¡æ¯ã€‚å®ƒå¯æŒ‡ç¤ºä»¥ä¸‹æƒ…å†µï¼šæ³¢å½¢é˜µåˆ—ä¸­æ•°æ®ç¼ºå¤±ã€æµ‹é‡é”™è¯¯ã€æµ‹é‡è¿›è¡Œä¸­ã€‚
- sampling_rate é‡‡æ ·é¢‘ç‡ï¼ˆå»ºè®®å‡ºå‚å°±é…ç½®ï¼Œä¹‹åä¸å†ä¿®æ”¹ï¼‰ã€‚å€¼ä¸ºä¸€ä¸ªå‘¨æœŸå†…çš„é‡‡æ ·æ¬¡æ•°ã€‚TODOï¼šå‘¨æœŸæ˜¯ä»€ä¹ˆ
- number_of_samples_before_trigger è§¦å‘å‰çš„é‡‡æ ·æ•°æ®çš„ä¿ç•™æ¡æ•°
- number_of_samples_after_trigger è§¦å‘åçš„é‡‡æ ·æ•°æ®çš„ä¿ç•™æ¡æ•°
- scaler_uint é‡çº²

æ–¹æ³•ï¼š

- reset(data) ç»ˆæ­¢é‡‡æ ·è¿‡ç¨‹
- trigger(data) å°†è°ƒç”¨è¯¥æ–¹æ³•çš„æ—¶é—´ç‚¹å‰å’Œåçš„å¯¹åº”æ¡æ•°çš„é‡‡æ ·æ•°æ®ä¿å­˜åˆ° waveform_data ä¸­ï¼ŒåŒæ—¶æ›´æ–°å…¶ä»–ç›¸å…³å±æ€§ã€‚ä¸ºäº†ä¿å­˜è°ƒç”¨è¯¥æ–¹æ³•åä¸€å®šæ¡æ•°çš„é‡‡æ ·æ•°æ®ï¼Œè¯¥è°ƒç”¨å°†ä¼šæŒç»­ä¸€å®šæ—¶é—´(æ–¹æ³•åº”è¯¥æ˜¯ç«‹å³è¿”å›ï¼Œæ‰§è¡Œä¼šæŒç»­ä¸€æ®µæ—¶é—´)ï¼Œç›´åˆ°è¾¾åˆ°æ‰€éœ€çš„é‡‡æ ·æ¡æ•°ã€‚å½“ä¸€ä¸ª trigger åœ¨è¿›è¡Œä¸­æ—¶ï¼Œæœ¬å¯¹è±¡å°†ä¼šé”å®š(å†…éƒ¨å®šæ—¶å™¨)ï¼Œæ­¤æ—¶æ— æ³•å†æ¬¡è°ƒç”¨è¯¥æ–¹æ³•ã€‚æ‰€ä»¥å¦‚æœè¦å¼ºåˆ¶å¼€å§‹æ–°çš„é‡‡æ ·ï¼Œå¿…é¡»å…ˆè°ƒç”¨ reset(data) ç»“æŸé‡‡æ ·è¿‡ç¨‹ï¼Œå†è°ƒç”¨ trigger(data)

## s4.4 ç”¨äºè®¿é—®æ§åˆ¶å’Œç®¡ç†çš„æ¥å£ç±»Interface classes for access control and management

æŒ‰ç…§ 4.4.8.2 Push setup æ‰€è¿°ï¼ŒPush setup å¯¹è±¡å’Œ Association å¯¹è±¡é€šè¿‡ client_sap ç»‘å®šï¼Œæ˜¯å¦æ„å‘³ç€ client_sap æ˜¯ä¸»é”®ï¼Œä¸€ä¸ªé€»è¾‘è®¾å¤‡ä¸­å¯¹äºæ¯ä¸ª client åªèƒ½åŒæ—¶å­˜åœ¨ä¸€ä¸ª AAã€‚

### s4.4.3 Association SN (class_id = 12, version = 4)

COSEM logical devicesèƒ½å¤Ÿåœ¨COSEM contextä¸­`ä½¿ç”¨SNå¼•ç”¨å»ºç«‹AAs`ï¼Œä½¿ç”¨â€œAssociation SNâ€ICçš„å®ä¾‹å»ºæ¨¡AAsã€‚ä¸€ä¸ªCOSEM logical deviceså¯ä»¥å¯¹`æ¯ä¸ª`è®¾å¤‡èƒ½å¤Ÿæ”¯æŒçš„`AA`æ‹¥æœ‰`ä¸€ä¸ª`è¯¥ICçš„`å®ä¾‹`ã€‚

å±æ€§ï¼š

- object_list å¯¹è±¡åˆ—è¡¨ï¼Œæ•°ç»„å½¢å¼ï¼ŒåŒ…å«base_name,class_id,version,logical_nameï¼Œbase_nameå®šä¹‰è§*æ–‡ç« å¼€å¤´*
  >å®é™…è¿™é‡Œbase_nameå’Œlogical_nameçš„å«ä¹‰é‡å¤äº†ï¼Œä¸è¿‡base_nameæ˜¯æ˜¯ç”¨æ¥ä½œä¸ºå’Œaccess_rights_listå…³è”çš„å¤–é”®çš„

  TODO:logical_nameå’Œbase_nameé‡å¤äº†
- access_rights_list åŒ…å«å¯¹å±æ€§å’Œæ–¹æ³•çš„`æƒé™`ï¼Œæ•°ç»„å½¢å¼ï¼Œå’Œobject_listé—´é€šè¿‡`base_name`ç®¡ç†ï¼Œç›¸å½“äºå¤–é”®ï¼Œå…ƒç´ æ•°é‡éœ€è¦ç›¸åŒï¼Œå…ƒç´ é¡ºåºæœ€å¥½ä¹Ÿç›¸åŒã€‚åŒ…å«base_nameï¼Œattribute_access(å¯é€‰)ï¼Œmethod_access(å¯é€‰)
  >object_listæ”¯æŒä»¥class_idï¼Œlogical_nameæˆ–base_nameä¸ºæ¡ä»¶é€‰æ‹©æ€§è®¿é—®ï¼Œaccess_rights_listæ”¯æŒä»¥base_nameä¸ºæ¡ä»¶é€‰æ‹©æ€§è®¿é—®
- security_setup_reference å¼•ç”¨`Security setup`çš„logical_nameï¼Œè¢«å¼•ç”¨çš„å¯¹è±¡ç®¡ç†ç»™å®šçš„"Association SN"å¯¹è±¡å®ä¾‹çš„å®‰å…¨æ€§
- user_list `å…è®¸ä½¿ç”¨`æœ¬å¯¹è±¡ç®¡ç†çš„`AA`çš„ç”¨æˆ·åˆ—è¡¨
  - user_idè¡¨ç¤ºuserçš„idï¼ˆ`AARQ`ä¸­çš„`calling-AE-invocation-id`æºå¸¦ï¼‰
  - user_nameæ˜¯ç”¨æˆ·çš„åå­—

  >å¦‚æœæ•°ç»„`ä¸ºç©º`ï¼Œåˆ™`ä»»ä½•ç”¨æˆ·`éƒ½èƒ½ä½¿ç”¨AAï¼›å¦‚æœæ•°ç»„ä¸ä¸ºç©ºï¼Œåˆ™ä»…æœ‰åˆ—è¡¨å†…ç”¨æˆ·å¯ä»¥å»ºç«‹AAï¼Œä¹Ÿå°±æ˜¯AARQä¸­çš„calling-AE-invocation-idå­—æ®µå¿…é¡»åŒ¹é…åˆ—è¡¨ä¸­çš„user_idã€‚

  ```asn1
    array user_list_entry
    user_list_entry ::= structure
    {
        user_id:    unsigned,
        user_name   CHOICE {
                    visible-string  [10],
                    UTF-8-string    [12]
                    }
    }
  ```

- current_user å½“å‰ç”¨æˆ·ï¼Œè‹¥user_listä¸ºç©ºï¼Œè¯¥å€¼çš„user_idå’Œuser_nameéƒ½ä¸º0ï¼ˆç©ºï¼‰

æ–¹æ³•ï¼š

- read_by_logicalname (data) è¯»å–æŒ‡å®šå¯¹è±¡çš„å±æ€§å€¼ï¼Œå¯¹è±¡ç”±class_idå’Œlogical_nameæŒ‡å®šï¼Œattribute_indexè¡¨ç¤ºç´¢å¼•ï¼Œ0è¡¨ç¤ºå…¨éƒ¨å±æ€§ï¼Œ1è¡¨ç¤ºç¬¬ä¸€ä¸ªå±æ€§ã€‚å›å¤çš„æ•°æ®ç”±å±æ€§ç±»å‹å†³å®š
- change_secret (data) ä¿®æ”¹LLSå¯†ç æˆ–HLSå¯†é’¥ï¼ˆä¸åŒ…æ‹¬è®¤è¯ï¼‰ï¼Œå¯èƒ½åŒ…å«æ ¡éªŒä¿¡æ¯æˆ–æœ¬èº«è¢«åŠ å¯†ï¼ŒHLS with GMACè®¤è¯çš„å¯†é’¥ç”±Security setupç®¡ç†ã€‚
- reply_to_HLS_authentication (data) æ­¤æ–¹æ³•çš„`è¿œç¨‹è°ƒç”¨`å°†`æœåŠ¡ç«¯å¯¹å®¢æˆ·ç«¯`çš„`è´¨è¯¢`(change) f(`StoC`) çš„å®¢æˆ·ç«¯`secret å¤„ç†çš„ç»“æœ`ä¼ é€’å›æœåŠ¡ç«¯ï¼Œä½œä¸ºé€šè¿‡å‚æ•°åŒ–è®¿é—®è°ƒç”¨çš„ Read.request åŸè¯­çš„æ•°æ®æœåŠ¡å‚æ•°

  |æœåŠ¡ç«¯S|å®¢æˆ·ç«¯C|
  |:---:|:---:|
  |StoC->||
  ||<-f(StoC)åŠ å¯†å¤„ç†åçš„ç»“æœ|

  dataæ•°æ®æ˜¯å®¢æˆ·ç«¯å¯¹æœåŠ¡ç«¯çš„å›å¤

  TODOï¼šè¯·æ±‚å’Œå›å¤çš„æ•°æ®æ˜¯ä»€ä¹ˆ

  å›åº”æ•°æ®ï¼š

  å¦‚æœè®¤è¯è¢«æ¥å—ï¼Œåˆ™å“åº”ï¼ˆRead.confirm åŸè¯­ï¼‰åŒ…å« Result == OK å’ŒæœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è´¨è¯¢æœåŠ¡å™¨çš„ secret å¤„ç†ç»“æœï¼Œåœ¨ Read çš„æ•°æ®æœåŠ¡å‚æ•°ä¸­ f(CtoS) å“åº”æœåŠ¡ã€‚

  dataæ•°æ®æ˜¯æœåŠ¡ç«¯å¯¹å®¢æˆ·çš„å›å¤

  å¦‚æœè®¤è¯ä¸è¢«æ¥å—ï¼Œåˆ™è¿”å›non-OKå€¼ï¼Œä¸”ä¸åŒ…æ‹¬data

- add_user (data) å‘user_listæ·»åŠ ä¸€ä¸ªç”¨æˆ·
- remove_user (data) ä»user_listç§»é™¤ä¸€ä¸ªç”¨æˆ·

### s4.4.4 Association LN (class_id = 15, version = 3)

COSEM logical devicesèƒ½å¤Ÿä½¿ç”¨ LN å¼•ç”¨åœ¨ COSEM contextä¸­å»ºç«‹ AAï¼Œé€šè¿‡â€œAssociation LNâ€IC çš„å®ä¾‹å¯¹ AA å»ºæ¨¡ã€‚ ä¸€ä¸ª COSEM logical devices å¯¹äºå…¶èƒ½å¤Ÿæ”¯æŒçš„æ¯ä¸ª AA éƒ½æœ‰ä¸€ä¸ªè¯¥ IC çš„å®ä¾‹ã€‚

å±æ€§ï¼š

- object_list åŒAssociation SNä¸­object_listå’Œaccess_rights_listçš„æ•´åˆ

  é€‰æ‹©æ€§è®¿é—®æ”¯æŒnull(æ‰€æœ‰),class_list,object_id_list,object_id(class_id+logical_name)
- associated_partners_id åŒ…å«COSEMå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯(é€»è¾‘è®¾å¤‡ï¼Œç‰©ç†è®¾å¤‡åŒ…å«è‹¥å¹²ä¸ªé€»è¾‘è®¾å¤‡)ï¼Œå±äºç”±Association LNå¯¹è±¡å»ºæ¨¡çš„AAã€‚å®¢æˆ·ç«¯èŒƒå›´ä¸º0x0-0x7F,æœåŠ¡ç«¯èŒƒå›´ä¸º0x0-0x3FFF
- application_context_name åœ¨COSEMç¯å¢ƒä¸­ï¼Œå¸Œæœ›é¢„å…ˆå­˜åœ¨ä¸€ä¸ª`application context`ï¼Œå¹¶åœ¨AAå»ºç«‹æœŸé—´é€šè¿‡å…¶åç§°å¼•ç”¨å®ƒã€‚æ­¤å±æ€§åŒ…å«è¯¥AAçš„application contextçš„åç§°ã€‚è§*Green Book 4.5.2 application context*ï¼Œ*9.4.2.2.2 The COSEM application context*ã€‚TODO:æŸ¥çœ‹æ–‡æ¡£
- xDLMS_context_info åŒ…å«å…³äºç»™å®šAAçš„`xDLMS context`çš„æ‰€æœ‰å¿…è¦ä¿¡æ¯
  - conformance element: åŒ…å«æœåŠ¡å™¨æ”¯æŒçš„xDLMSä¸€è‡´æ€§å—,TODO:ä¸€è‡´æ€§å—æ˜¯ä»€ä¹ˆ æ›´æ–°ï¼šè§Gp322 Table 85ï¼Œè¡¨ç¤ºåŒæ–¹æ”¯æŒçš„åŠŸèƒ½åˆ—è¡¨ï¼Œç”¨äºåå•†ã€‚ä½ä¸²çš„é•¿åº¦ä¸º24ä½;
  - max_receive_pdu_sizeï¼šåŒ…å«xDLMS APDUçš„`æœ€å¤§é•¿åº¦`ï¼Œå®¢æˆ·ç«¯å¯ä»¥å‘é€çš„å­—èŠ‚æ•°åœ¨AAè¿‡ç¨‹ä¸­åå•†ï¼Œå—xDLMS initiateResponse APDUçš„server-max-receive-pdu-sizeå‚æ•°çš„é™åˆ¶;
  - max_send_pdu_sizeï¼šåœ¨è¿™ä¸ªAAä¸­æœåŠ¡å™¨å¯ä»¥å‘é€çš„xDLMS APDUçš„`æœ€å¤§é•¿åº¦`ï¼Œä»¥å­—èŠ‚è¡¨ç¤ºã€‚å®ƒå—åˆ°xDLMS initiateRequest APDUçš„client-max-receive-pdu-sizeå‚æ•°çš„é™åˆ¶;
  - dlms_version_numberï¼šåŒ…å«æœåŠ¡ç«¯æ”¯æŒçš„DLMSç‰ˆæœ¬
  - quality_of_serviceï¼šæœªä½¿ç”¨
  - cyphering_infoï¼šåœ¨ä¸€ä¸ªæ´»åŠ¨çš„AAä¸­ï¼ŒåŒ…å«xDLMS initiateRequest APDUçš„ä¸“ç”¨å…³é”®å‚æ•°ï¼Œè§*GREEN BOOK 9.5*

- authentication_mechanism_name AAè®¤è¯æœºæ„åç§°
- secret LLSæˆ–HLSå¯†é’¥ï¼ŒåŒä¸ŠSN
- association_status AAå½“å‰çŠ¶æ€
- security_setup_reference å¼•ç”¨Security setupå¯¹è±¡çš„logical name.è¯¥å¯¹è±¡ç”¨äºè¡¨ç¤ºæœ¬å¯¹è±¡çš„é«˜çº§åŠ å¯†(HLS)å‚æ•°
- user_list åŒä¸ŠSN
- current_user åŒä¸ŠSN

æ–¹æ³•ï¼š

- reply_to_HLS_authentication (data) åŒä¸ŠSN
- change_HLS_secret (data) åŒä¸ŠSN
- add_object (data) åŒä¸ŠSN
- remove_object (data) åŒä¸ŠSN
- add_user (data) åŒä¸ŠSN
- remove_user (data) åŒä¸ŠSN

### s4.4.5 SAP assignment (class_id = 17, version = 0)

è¯¥ IC å…è®¸é€šè¿‡æä¾›æœ‰å…³å°†é€»è¾‘è®¾å¤‡åˆ†é…ç»™å…¶ SAP çš„ä¿¡æ¯æ¥å¯¹ç‰©ç†è®¾å¤‡çš„é€»è¾‘ç»“æ„è¿›è¡Œå»ºæ¨¡ã€‚ å‚è§ DLMS UA 1000-2 Ed.11:2021ï¼Œç¬¬ 10 æ¡ã€‚

ä¸€èˆ¬åœ¨ä¸€ä¸ªç‰©ç†è®¾å¤‡å†…ï¼Œä»…æœ‰ Management logical device æ‹¥æœ‰è¯¥å¯¹è±¡å®ä¾‹ï¼Œè§ 4.1.8.5 Management logical deviceã€‚

å±æ€§ï¼š

- SAP_assignment_list åŒ…å«ç‰©ç†è®¾å¤‡ä¸Šæ‰€æœ‰`é€»è¾‘è®¾å¤‡(çš„åç§°)`å’Œä»–ä»¬çš„`sap`
  - é€»è¾‘è®¾å¤‡(çš„åç§°)
  - sap

æ–¹æ³•ï¼š

- connect_logical_device (data) å°†`é€»è¾‘è®¾å¤‡`è¿æ¥åˆ°`SAP`ã€‚è¿æ¥åˆ°`SAP 0`è¡¨ç¤º`æ–­å¼€`è®¾å¤‡è¿æ¥ã€‚ä¸€ä¸ªSAPä¸èƒ½è¿æ¥å¤šä¸ªè®¾å¤‡(SAP 0é™¤å¤–)ã€‚

  é€»è¾‘è®¾å¤‡ï¼šç‰©ç†è®¾å¤‡ä¸­çš„`æŠ½è±¡å®ä½“`ï¼Œè¡¨ç¤ºç”¨COSEMå¯¹è±¡å»ºæ¨¡çš„`åŠŸèƒ½å­é›†`

### s4.4.6 Image transfer (class_id = 18, version = 0)

 Image ä¼ è¾“ IC æ¨¡å‹çš„å®ä¾‹æ˜¯å°†`äºŒè¿›åˆ¶æ–‡ä»¶`(ç§°ä¸ºimage)ä¼ è¾“åˆ°`COSEMæœåŠ¡å™¨`çš„è¿‡ç¨‹ã€‚

1. æ­¥éª¤1ï¼š(å¯é€‰)è·å–ImageBlockSize
2. æ­¥éª¤2ï¼šå®¢æˆ·ç«¯å¯åŠ¨imageä¼ è¾“
3. æ­¥éª¤3ï¼šå®¢æˆ·ç«¯ä¼ è¾“imageBlocks
4. æ­¥éª¤4ï¼šå®¢æˆ·ç«¯æ£€æŸ¥ç¡®è®¤ä¼ è¾“å®Œæˆ
5. æ­¥éª¤5ï¼šæœåŠ¡ç«¯æ ¡éªŒimageå®Œæ•´æ€§ï¼ˆå®¢æˆ·ç«¯å‘èµ·æˆ–æœåŠ¡ç«¯è‡ªè¡Œå®Œæˆï¼‰
6. æ­¥éª¤6ï¼šï¼ˆå¯é€‰ï¼‰å®¢æˆ·ç«¯æ£€æŸ¥è¦æ¿€æ´»çš„imageä¸Šçš„ä¿¡æ¯
7. æ­¥éª¤7ï¼šæœåŠ¡ç«¯æ¿€æ´»imageï¼ˆå®¢æˆ·ç«¯å‘èµ·æˆ–æœåŠ¡ç«¯è‡ªè¡Œå®Œæˆï¼‰

å±æ€§ï¼š

- image_block_size ä¿å­˜ImageBlockSizeï¼Œä¸€ä¸ª Image è¢«åˆ†ä¸ºè‹¥å¹²å—ï¼Œè¿™é‡Œæ˜¯æ¯ä¸ªå—å¤§å°ï¼Œç”¨å…«ä½å­—èŠ‚è¡¨ç¤ºï¼Œä¸èƒ½è¶…è¿‡åå•†çš„ServerMaxReceivePduSize
- image_transferred_blocks_status `ä½å›¾`ï¼Œæä¾›å…³äºæ¯ä¸ªImageBlockçš„ä¼ è¾“çŠ¶æ€çš„ä¿¡æ¯ã€‚bit-stringä¸­çš„æ¯ä¸€ä½æä¾›äº†ä¸€ä¸ªå•ç‹¬çš„ImageBlockçš„ä¿¡æ¯ï¼Œ0ä¸ºæœªä¼ è¾“ï¼Œ1ä¸ºå·²ä¼ è¾“ã€‚
- image_first_not_transferred_block_number ç¬¬ä¸€ä¸ª`æœªä¼ è¾“`çš„å—çš„ç¼–å·ï¼Œå¦‚æœä¼ è¾“å…¨éƒ¨å®Œæˆï¼Œè¯¥ç¼–å·åº”è¯¥ç­‰äºæˆ–å¤§äºimage_block_size
- image_transfer_enabled `æ§åˆ¶`æ˜¯å¦`å¯ç”¨` Image ä¼ è¾“`è¿‡ç¨‹`ï¼Œåªæœ‰ç½®ä¸ºtrueæ‰èƒ½æ‰§è¡Œimage transferç›¸å…³æ–¹æ³•ï¼Œä¸ºfalseæ˜¯ç¦ç”¨æ‰€æœ‰æ–¹æ³•çš„æ‰§è¡Œï¼Œè¿”å›é”™è¯¯
- image_transfer_status `ä¼ è¾“çŠ¶æ€`ï¼Œè¡¨ç¤ºä¼ è¾“è¿‡ç¨‹æ‰€åœ¨çš„é˜¶æ®µå’Œè¯¥é˜¶æ®µçš„æ‰§è¡Œç»“æœï¼ˆå¦‚ï¼Œæ ¡éªŒé˜¶æ®µæ ¡éªŒå¤±è´¥ Image verification failedï¼‰
- image_to_activate_info æä¾›æœ‰å…³å‡†å¤‡`æ¿€æ´»çš„æ˜ åƒçš„ä¿¡æ¯`ã€‚è¿™æ˜¯ä¸€ä¸ª`æ•°ç»„`ï¼Œæ¯ä¸ªå¾…æ¿€æ´»çš„ Image éƒ½æœ‰`ç‹¬ç«‹`ä¿¡æ¯ï¼Œå®ƒæ˜¯ä½œä¸º Image éªŒè¯è¿‡ç¨‹çš„ç»“æœç”Ÿæˆçš„ã€‚å®¢æˆ·ç«¯å¯ä»¥åœ¨æ¿€æ´»æ˜ åƒä¹‹å‰æ£€æŸ¥è¿™äº›ä¿¡æ¯ï¼ˆä»æœåŠ¡ç«¯çš„è¿™ä¸ªå±æ€§ä¸­è¯»å‡ºæ¥åæ£€æŸ¥ï¼‰ã€‚åŒ…æ‹¬`å¤§å°ã€æ ‡è¯†ï¼ˆidentificationï¼‰å’Œç­¾å`

æ–¹æ³•ï¼š

- image_transfer_initiate (data) `åˆå§‹åŒ–`ä¼ è¾“è¿‡ç¨‹ï¼Œå‚æ•°åŒ…æ‹¬identifierå’ŒImageSizeï¼ˆä¸æ˜¯image block sizeï¼‰ã€‚åœ¨æ­¤ä¹‹åï¼Œå°†image_transfer_statusï¼ˆä¼ è¾“çŠ¶æ€ï¼‰å±æ€§ç½®ä¸º1ï¼Œimage_first_not_transferred_block_numberç½®ä¸º0ï¼Œå¯¹äºè¯¥æ–¹æ³•çš„è°ƒç”¨ä¼šé‡ç½®æ•´ä¸ªä¼ è¾“æµç¨‹
- image_block_transfer (data) ä¼ è¾“`ä¸€ä¸ªå—`åˆ°æœåŠ¡ç«¯ï¼ŒåŒ…æ‹¬å—åºå·å’Œå—å†…å®¹ï¼Œä¹‹åå°†image_transferred_blocks_statuså¯¹åº”ä½ç½®1ï¼Œimage_first_not_transferred_block_numberæ›´æ–°
- image_verify (data) åœ¨æ¿€æ´»ä¹‹å‰éªŒè¯æ˜ åƒçš„å®Œæ•´æ€§(è§¦å‘æœåŠ¡ç«¯è‡ªæ ¡éªŒ)ã€‚

  è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„ç»“æœå¯èƒ½æ˜¯`successã€temporary_failure`æˆ–`other_reason`ã€‚å¦‚æœ`ä¸æˆåŠŸ`ï¼Œåˆ™å¯ä»¥é€šè¿‡æ£€ç´¢`image_transfer_status`å±æ€§çš„å€¼æ¥æ‰¾åˆ°éªŒè¯çš„ç»“æœã€‚

  å¦‚æœ`æˆåŠŸ`ï¼Œimage_to_activate_infoå±æ€§å°†ä¿å­˜è¦æ¿€æ´»çš„ Image çš„ä¿¡æ¯ã€‚
- image_activate (data) `æ¿€æ´» Image`ã€‚

  å¦‚æœä¼ è¾“çš„Imageä¹‹å‰æ²¡æœ‰ç»è¿‡`éªŒè¯`ï¼ˆæ²¡æ‰§è¡Œimage_verifyï¼‰ï¼Œé‚£ä¹ˆè¿™å°†ä½œä¸ºImage_activateçš„ä¸€éƒ¨åˆ†å®Œæˆã€‚
  è°ƒç”¨æ­¤æ–¹æ³•çš„ç»“æœå¯èƒ½æ˜¯`successã€temporary_failure`æˆ–`other_reason`ã€‚å¦‚æœä¸æ˜¯æˆåŠŸï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡æ£€ç´¢`image_transfer_status`å±æ€§çš„å€¼æ¥äº†è§£æ¿€æ´»çš„ç»“æœã€‚

å¦‚æœå®¢æˆ·ç«¯ä¸çŸ¥é“ Image ä¼ è¾“ç›®æ ‡æœåŠ¡å™¨å¯ä»¥å¤„ç†çš„ Image å—çš„å¤§å°ï¼Œé‚£ä¹ˆåœ¨å¼€å§‹å¤„ç†ä¹‹å‰ï¼Œå®¢æˆ·ç«¯éœ€è¦è¯»å– Image ä¼ è¾“åˆ°çš„æ¯ä¸ªæœåŠ¡å™¨çš„ç›¸å…³â€œimage transferâ€å¯¹è±¡çš„`image_block_size`å±æ€§ã€‚å®¢æˆ·ç«¯å¯ä»¥ä¼ è¾“`åˆé€‚å¤§å°`çš„ImageBlocksã€‚

å¦‚æœ Image å—é€šè¿‡`å¹¿æ’­`å‘é€ç»™ä¸€ç»„COSEMæœåŠ¡ç«¯ï¼Œ Image å—å¤§å°åœ¨ç»„ä¸­çš„æ¯ä¸ªæˆå‘˜ä¸­åº”è¯¥æ˜¯ç›¸åŒçš„ã€‚

`æ ¡éªŒä¸´æ—¶å¤±è´¥`ä¸æ˜¯çœŸæ­£å¤±è´¥ï¼Œå¯èƒ½æ˜¯æ ¡éªŒè¿˜æœªå®Œæˆï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è·å–image_transfer_statuså±æ€§çš„å€¼æ¥æ£€æŸ¥ImageéªŒè¯çš„ç»“æœã€‚

æœåŠ¡ç«¯å†…å¯ä»¥ä¿å­˜å¤šä¸ªå¾…æ¿€æ´»çš„ Image

#### sImage transfer for M-Bus devices

TODO

### s4.4.7 Security setup (class_id = 64, version = 1)

â€œSecurity setupâ€ICçš„å®ä¾‹åŒ…å«æœ‰å…³å½“å‰æ­£åœ¨ä½¿ç”¨çš„`å®‰å…¨å¥—ä»¶(security suite)`çš„å¿…è¦ä¿¡æ¯ï¼Œä»¥åŠåœ¨å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¹‹é—´é€‚ç”¨çš„`å®‰å…¨ç­–ç•¥(security policy)`(ç”±å®ƒä»¬å„è‡ªçš„ç³»ç»Ÿæ ‡é¢˜æ ‡è¯†)ã€‚å®ƒä»¬è¿˜æä¾›äº†æé«˜å®‰å…¨æ€§çº§åˆ«å’Œç®¡ç†`å¯¹ç§°å¯†é’¥`ã€`éå¯¹ç§°å¯†é’¥å¯¹`å’Œ`è¯ä¹¦`çš„æ–¹æ³•

å±æ€§ï¼š

- security_policy `å®‰å…¨ç­–ç•¥`ï¼Œæ ‡è¯†æ˜¯å¦ä½¿ç”¨å®‰å…¨å¥—ä»¶ä¸­å¯ç”¨çš„å®‰å…¨ç®—æ³•æ‰§è¡Œ**èº«ä»½éªŒè¯(authenticate)**å’Œ/æˆ–**åŠ å¯†(encrypt)**å’Œ/æˆ–**æ•°å­—ç­¾å(digitally sign)**ã€‚å®ƒç‹¬ç«‹åœ°åº”ç”¨äºè¯·æ±‚å’Œå“åº”ã€‚
- security_suite å®‰å…¨å¥—ä»¶ï¼Œæ˜ç¡®å®‰å…¨ç®—æ³•(è®¤è¯ã€åŠ å¯†ã€æ•°å­—ç­¾åã€å¯†é’¥åå•†ã€å“ˆå¸Œã€å‹ç¼©ã€key wrap)ï¼Œå‚è€ƒ[NSA Suite B å’Œ CNSA](https://en.wikipedia.org/wiki/NSA_Suite_B_Cryptography)
  
  - (0) AES-GCM-128 authenticated encryption and AES-128 key wrap
  - (1) AES-GCM-128 authenticated encryption, ECDSA P-256 digital signature, ECDH P-256 key agreement, SHA-256 hash, V.44 compression and AES-128 key wrap
  - (2) AES-GCM-256 authenticated encryption, ECDSA P-384 digital signature, ECDH P-384 key agreement, SHA-384 hash, V.44 compression and AES-256 key wrap
  - (3) â€¦ (15) reserved
- client_system_title æºå¸¦ï¼ˆå½“å‰ï¼‰`å®¢æˆ·ç«¯`system titleï¼Œåœ¨å·²ç¡®è®¤æˆ–æœªç¡®è®¤çš„AAå»ºç«‹è¿‡ç¨‹ä¸­ï¼Œç”±AARQ APDUçš„calling-AP-titleå­—æ®µæ‰¿è½½;
- server_system_title æºå¸¦`æœåŠ¡ç«¯`çš„system_titleï¼Œåœ¨ç¡®è®¤AAå»ºç«‹æ—¶ï¼Œç”±AARE APDUçš„response-AP-titleå­—æ®µè¿›è¡Œ
- certificates æºå¸¦å¯ç”¨çš„X.509 v3`è¯ä¹¦ä¿¡æ¯`ï¼Œå¹¶å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­ã€‚æœåŠ¡ç«¯å¯ä»¥ä¿å­˜æœåŠ¡ç«¯è¯ä¹¦ã€æ¯ä¸ªå®¢æˆ·ç«¯çš„è¯ä¹¦ã€CAè¯ä¹¦ã€‚

æ–¹æ³•ï¼š

- security_activate (data) æ¿€æ´»å’Œ`åŠ å¼ºå®‰å…¨ç­–ç•¥`security_policyï¼Œæ–°çš„å€¼å®‰å…¨æ€§å¿…é¡»é«˜äºæˆ–ç­‰äºåŸå€¼ï¼Œä¹Ÿå°±æ˜¯åªèƒ½åŠ å¼ºï¼Œä¸èƒ½å‡å¼±
- key_transfer (data) ç”¨äº`ä¼ è¾“`ä¸€ä¸ªæˆ–å¤šä¸ª`å¯†é’¥`(EK,AK,BK,MK),åŒ…æ‹¬å¯†é’¥æ ‡è¯†å’Œå°è£…åçš„å¯†é’¥ï¼ˆkey wrappedï¼‰ã€‚å¯ä»¥æ˜¯æ•°ç»„ï¼Œä¸€æ¬¡å¤šä¸ªå¯†é’¥ã€‚`key wrap`ç®—æ³•ç”±åŠ å¯†å¥—ä»¶æŒ‡å®š
- key_agreement (data) ç”¨äºä½¿ç”¨å®‰å…¨å¥—ä»¶æŒ‡å®šçš„`å¯†é’¥åå•†ç®—æ³•`å¯¹ä¸€ä¸ªæˆ–å¤šä¸ª`å¯¹ç§°å¯†é’¥`è¾¾æˆä¸€è‡´ã€‚åœ¨å¥—ä»¶1å’Œå¥—ä»¶2çš„æƒ…å†µä¸‹ï¼ŒECDHå¯†é’¥åå•†ç®—æ³•ä¸ä¸´æ—¶ç»Ÿä¸€æ¨¡å‹(Ephemeral Unified Model) C(2e, 0s, ECC CDH)æ–¹æ¡ˆä¸€èµ·ä½¿ç”¨ã€‚
- generate_key_pair (data) æ ¹æ®`å®‰å…¨å¥—ä»¶`çš„è¦æ±‚ç”Ÿæˆ`éå¯¹ç§°å¯†é’¥å¯¹`ã€‚data`å‚æ•°`æ ‡è¯†è¦ç”Ÿæˆçš„å¯†é’¥å¯¹çš„`ç”¨æ³•`:
  - digital signature key pair æ•°å­—ç­¾å
  - key agreement key pair å¯†é’¥åå•†
  - TLS key pair TLSé€šä¿¡

  ä»¥ä¸Šæ¯ä¸ªç”¨æ³•çš„å¯†é’¥å¯¹`æœ€å¤šåŒæ—¶`åªèƒ½æœ‰`ä¸€ä¸ª`ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šæœ‰ä¸‰ä¸ªå¯†é’¥å¯¹
- generate_certificate_request (data) å½“è°ƒç”¨æ­¤æ–¹æ³•æ—¶ï¼ŒæœåŠ¡å™¨å‘é€`è¯ä¹¦ç­¾åè¯·æ±‚`(`CSR`)æ•°æ®ï¼Œè¿™æ˜¯CAä¸ºæœåŠ¡å™¨å…¬é’¥ç”Ÿæˆè¯ä¹¦æ‰€å¿…éœ€çš„ã€‚dataå‚æ•°ä¸ºè¯·æ±‚è¯ä¹¦çš„å¯†é’¥å¯¹ç±»å‹

  å“åº”ä¸ºCSRæ•°æ®ï¼ŒPKCS #10æ ¼å¼DERç¼–ç çš„octet-string
- import_certificate (data) `å¯¼å…¥X.509 V3æ ¼å¼è¯ä¹¦`ï¼ŒDERç¼–ç octet-stringï¼Œæ— éœ€æŒ‡å®šç±»å‹ï¼ŒTODOï¼šå¦‚ä½•åŒºåˆ†è¯ä¹¦ç±»å‹,è‡ªåŠ¨è¯†åˆ«ï¼Ÿ
- export_certificate (data) `å¯¼å‡ºè¯ä¹¦`ï¼Œæ ¹æ®ç±»å‹æˆ–åºåˆ—å·
- remove_certificate (data) `ç§»é™¤è¯ä¹¦`ï¼Œå‚æ•°åŒä¸Šå¯¼å‡ºè¯ä¹¦

  TODO: æ–°ç‰ˆæœ¬è“çš®ä¹¦å†™äº†æœåŠ¡ç«¯çš„è¯ä¹¦åªèƒ½æ›´æ–°ï¼Œä¸èƒ½åˆ é™¤ã€‚æ„æ€æ˜¯ä¸æ˜¯ä¸èƒ½åœ¨æ²¡æœ‰è°ƒç”¨è¿‡ generate_certificate_request æˆ– import_certificate ç”Ÿæˆæˆ–å¯¼å…¥æ–°è¯ä¹¦çš„æƒ…å†µä¸‹ç›´æ¥è°ƒç”¨ remove_certificateï¼Ÿ

### s4.4.8 Push interface class

DLMSæ¶ˆæ¯å¯ä»¥åœ¨æœªç»æ˜ç¡®è¯·æ±‚çš„éƒ¨åˆ†æƒ…å†µä¸‹â€œ`æ¨é€`â€åˆ°ç›®çš„åœ°ï¼Œä¾‹å¦‚:

- è®¡åˆ’çš„æ—¶é—´åˆ°è¾¾
- æœ¬åœ°ç›‘æ§çš„å€¼`è¶…è¿‡é˜ˆå€¼`;
- ç”±`æœ¬åœ°äº‹ä»¶`è§¦å‘(å¦‚å¼€æœº/å…³æœºï¼ŒæŒ‰ä¸‹æŒ‰é’®ï¼Œè¡¨ç›–æ‰“å¼€)ã€‚

DLMS/COSEMæ¨é€æœºåˆ¶éµå¾ª`å‘å¸ƒ/è®¢é˜…(publish/subscribe)`æ¨¡å¼ã€‚

åœ¨DLMS/COSEMä¸­ï¼Œå‘å¸ƒæ˜¯ç”±â€œAssociationâ€å¯¹è±¡çš„object_listå±æ€§å»ºæ¨¡çš„ï¼Œè¯¥å±æ€§æä¾›äº†ç»™å®šAAä¸­å¯è®¿é—®çš„COSEMå¯¹è±¡åˆ—è¡¨å’Œå®ƒä»¬çš„å±æ€§ã€‚è®¢é˜…æ˜¯é€šè¿‡ç¼–å†™â€œPush setupâ€å¯¹è±¡çš„é€‚å½“å±æ€§æ¥å»ºæ¨¡çš„ã€‚ä½¿ç”¨xDLMS DataNotificationæœåŠ¡(åœ¨æŒ‡å®šçš„è§¦å‘å™¨ä¸Š)å‘é€æ‰€éœ€çš„æ•°æ®ã€‚

![push](/assets/img/2022-03-17-dlms-blue2/push.png)

### s4.4.8.2 Push setup (class_id = 40, version = 3)

"Push setup"ICåŒ…å«è¦æ¨é€çš„`COSEMå¯¹è±¡å±æ€§`çš„`å¼•ç”¨åˆ—è¡¨`ã€‚å®ƒè¿˜åŒ…å«æ¨é€`ç›®çš„åœ°`å’Œ`æ–¹æ³•`ï¼Œä»¥åŠ`é€šä¿¡æ—¶é—´çª—å£`å’Œ`é‡è¯•å¤„ç†`

Pushåœ¨*push*æ–¹æ³•è¢«è°ƒç”¨æ—¶å¯åŠ¨ï¼Œç”±`push: Single action scheduleå¯¹è±¡`ã€`alarm: Register monitorå¯¹è±¡`ã€`ä¸“ç”¨çš„å†…éƒ¨äº‹ä»¶`æˆ–`å¤–éƒ¨äº‹ä»¶`è§¦å‘ã€‚pushæ“ä½œè¢«`è§¦å‘`åï¼Œæ ¹æ®ç»™å®šçš„`push setup`å¯¹è±¡ä¸­çš„è®¾ç½®æ‰§è¡Œã€‚æ ¹æ®`é€šä¿¡çª—å£`çš„è®¾ç½®ï¼Œpushä¼šåœ¨`éšæœºå»¶è¿Ÿ`åç«‹å³æ‰§è¡Œï¼Œæˆ–è€…åœ¨é€šä¿¡çª—å£æ¿€æ´»åç«‹å³æ‰§è¡Œã€‚å¦‚æœpushä¸æˆåŠŸï¼Œåˆ™ä¼š`é‡è¯•`ã€‚é‡è¯•å¯èƒ½åœ¨æç¤ºæ”¯æŒåè®®å±‚å¤±è´¥æˆ–ç¼ºå°‘ç¡®è®¤æ—¶å‘ç”Ÿã€‚

å±æ€§ï¼š

- push_object_list å®šä¹‰è¦æ¨é€çš„`å±æ€§åˆ—è¡¨`ï¼Œåœ¨è°ƒç”¨`push (data)`æ–¹æ³•æ—¶ï¼Œå†…å®¹è¢«å‘é€åˆ°`send_destination_and_method`å±æ€§ä¸­å®šä¹‰çš„ç›®æ ‡ã€‚
  - class_id ç±»
  - logical_name å¯¹è±¡
  - attribute_index å±æ€§åºå·ï¼Œ0è¡¨ç¤ºå…¨éƒ¨ï¼Œå¦‚æœattribute_indexæ˜¯0ï¼Œåˆ™ä¸‹é¢çš„data_indexä¸º0ä¸”æ— æ„ä¹‰ï¼Œå…¶ä»–å€¼ä¹Ÿä¸ºç©ºæˆ–null
  - data_index å½“å±æ€§æ˜¯æ•°ç»„æˆ–ç»“æ„ä½“æ—¶(é™¤profile generic)ï¼Œ0è¡¨ç¤ºæ‰€æœ‰å…ƒç´ ï¼Œ0x0001-0x0FFFè¡¨ç¤ºå…ƒç´ åºå·ï¼Œå…¶ä»–å€¼ä¸ºç©ºæˆ–null
  - restriction,columns å½“å±æ€§æ˜¯profile genericå¯¹è±¡çš„æ—¶ï¼Œå’Œdata_indexä¸€èµ·è¡¨ç¤ºé€‰æ‹©æ€§è®¿é—®å‚æ•°

  æºå¸¦æ¨é€æ•°æ®çš„`DataNotification APDU`å—åˆ°*å®‰å…¨å¥—ä»¶suit*ã€*å®‰å…¨ç­–ç•¥policy*å’Œ*å®‰å…¨ææ–™material*çš„ä¿æŠ¤ï¼Œè¿™äº›å®‰å…¨é…ç½®åŒ…å«åœ¨"Security setup"å¯¹è±¡ä¸­ï¼Œç”±AAåº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„`Association SN/Association LN`å¯¹è±¡çš„`security_setup_reference`å±æ€§å¼•ç”¨ï¼Œ"Association"å¯¹è±¡å’Œæœ¬å¯¹è±¡é€šè¿‡`push_client_SAP`å±æ€§ç›¸å…³è”ï¼›ä»¥åŠpush_protection_parameterså±æ€§ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¯¹äºåœ¨è¯¥AAä¸­æ²¡æœ‰è¢«æˆäºˆ**è¯»å–è®¿é—®æƒ**çš„å±æ€§ï¼Œæˆ–è€…ç”±äºä»»ä½•å…¶ä»–åŸå› ä¸èƒ½è¢«è®¿é—®çš„å±æ€§ï¼Œåº”è¯¥è¿”å›ç©ºæ•°æ®ï¼ˆå¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰è¯»å–æƒé™ï¼ŒæœåŠ¡ç«¯å½“ç„¶ä¹Ÿä¸ä¼šæŠŠæ•°æ®æ¨é€ç»™å®ƒï¼‰ã€‚
- send_destination_and_method åŒ…å«`ç›®æ ‡åœ°å€`å’Œ`ä¼ è¾“æœåŠ¡`(ä¾‹å¦‚ç”µè¯å·ç ï¼Œç”µå­é‚®ä»¶åœ°å€ï¼ŒIPåœ°å€)ï¼Œç”¨äºå‘é€push_object_listæŒ‡å®šçš„æ•°æ®
  - transport_service ä¼ è¾“æœåŠ¡ç±»å‹ï¼Œå¦‚TCP,HDLC,Gatewayç­‰
  - destination ç›®çš„åœ°å€ï¼Œå–å†³äºtransport_serviceï¼Œæ¯”å¦‚CoAPåè®®çš„ç›®çš„åœ°å€æ—¶ä¸€ä¸ªCoAP URI,
  - message APDUç¼–ç ç±»å‹
    - (0) A-XDR encoded xDLMS APDU
    - (1) XML encoded xDLMS APDU
    - (128...255) manufacturer specific

  ä¸€ä¸ªPush setupå¯¹è±¡ä»…æ”¯æŒä¸€ä¸ªtransport_serviceå’Œdestinationï¼Œå¦‚æœåŒä¸€ä¸ªå†…å®¹éœ€è¦ä¸ŠæŠ¥ç»™å¤šä¸ªç›®çš„åœ°ï¼Œåˆ™éœ€è¦å¤šä¸ªä¸åŒå¯¹è±¡
- communication_window `é€šä¿¡çª—å£`ï¼ŒåŒ…å«å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´çš„åŒºé—´ï¼Œæ˜¯ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ ä¸ºä¸€ä¸ªåŒºé—´ã€‚å¦‚æœæ²¡æœ‰å…ƒç´ ï¼Œåˆ™ä¸é™åˆ¶çª—å£ï¼Œéšæ—¶å¯ä»¥æ¨é€
- randomisation_start_interval å‘é€ç¬¬ä¸€åŒ…å‰çš„`éšæœºç­‰å¾…`æ—¶é—´çš„`æœ€å¤§å€¼`ï¼Œä¸ºäº†é˜²æ­¢å¤§é‡ä½äºåŒä¸€ä¸ªç½‘ç»œä¸‹çš„è®¾å¤‡åŒæ—¶æ¨é€äº§ç”Ÿç¢°æ’ã€‚
  - éšæœºç­‰å¾…æ—¶é—´ä»0åˆ°æœ€å¤§å€¼éšæœº
  - ä»…åœ¨æ´»åŠ¨çª—å£å†…è°ƒç”¨pushç”Ÿæ•ˆï¼Œ`ä¸åœ¨é‡è¯•æ—¶ç”Ÿæ•ˆ`ï¼ˆpushå¤±è´¥åç­‰å¾…å›ºå®šå»¶è¿Ÿæ—¶é—´é‡è¯•ï¼Œä¸åº”ç”¨éšæœºç­‰å¾…æ—¶é—´ï¼‰
  - åœ¨æ´»åŠ¨çª—å£å¤–æ—¶pushï¼Œåˆ°è¾¾çª—å£å¼€å§‹æ—¶é—´æ—¶è®¡ç®—éšæœºå€¼
  - éšæœºå»¶è¿Ÿè¶…å‡ºçª—å£ç»“æŸæ—¶é—´ï¼Œé‚£è¦åˆ°ä¸‹ä¸€ä¸ªçª—å£æ‰èƒ½pushï¼Œè§ä¸Šä¸€èŠ‚çš„å›¾ç‰‡
  - æœªå®šä¹‰çª—å£æ—¶ï¼Œæ‰€æœ‰pushå’Œé‡è¯•éƒ½ä¼šåº”ç”¨éšæœºç­‰å¾…
- number_of_retries æœ€å¤§é‡è¯•æ¬¡æ•°
- repetition_delay é‡å‘å»¶è¿Ÿ
  - æœ€å°æ—¶é—´
  - æŒ‡æ•°ï¼Œç”¨äºè®¡ç®—ä¸‹æ¬¡å»¶è¿Ÿ
  - æœ€å¤§æ—¶é—´

  >ğ‘Ÿğ‘’ğ‘ğ‘’ğ‘¡ğ‘–ğ‘¡ğ‘–ğ‘œğ‘›_ğ‘‘ğ‘’ğ‘™ğ‘ğ‘¦ = ğ‘Ÿğ‘’ğ‘ğ‘’ğ‘¡ğ‘–ğ‘¡ğ‘–ğ‘œğ‘›_ğ‘‘ğ‘’ğ‘™ğ‘ğ‘¦_ğ‘šğ‘–ğ‘› Ã— (ğ‘Ÿğ‘’ğ‘ğ‘’ğ‘¡ğ‘–ğ‘¡ğ‘–ğ‘œğ‘›_ğ‘‘ğ‘’ğ‘™ğ‘ğ‘¦_ğ‘’ğ‘¥ğ‘ğ‘œğ‘›ğ‘’ğ‘›ğ‘¡ Ã— 0.01)^(ğ‘›âˆ’1)

  nè¡¨ç¤ºç¬¬å‡ æ¬¡ï¼Œn=1è¡¨ç¤ºç¬¬ä¸€æ¬¡é‡è¯•

  >**pushå†…å®¹æ²¡æœ‰ç¼“å­˜ï¼Œæ¯æ¬¡pushé‡è¯•ï¼Œå†…å®¹åº”è¯¥è¦é‡æ–°ç»„è£…ï¼Œå°±å¯èƒ½å’Œä¸Šæ¬¡çš„ä¸åŒ**

- port_reference é€šä¿¡ç«¯å£å¼•ç”¨ï¼Œå¼•ç”¨"communication port setup"å¯¹è±¡,TODO:æŸ¥çœ‹å¯¹åº”ç« èŠ‚
- push_client_SAP å®¢æˆ·ç«¯SAP,æ¨é€ç›®æ ‡ï¼Œç»‘å®šå¯¹åº”çš„AAã€‚å’Œ "Association"å¯¹è±¡å†…çš„ client SAP ç›¸å…³è”ã€‚å› ä¸ºä¸ŠæŠ¥æ—¶ä¸çŸ¥é“å½“å‰é€šä¿¡çš„ AAï¼Œæ‰€ä»¥å¿…é¡»é€šè¿‡è¿™ç§æ–¹å¼ç»‘å®šã€‚
- push_protection_parameters æ•°æ®ä¿æŠ¤å‚æ•°ï¼Œè§Data Protection IC
- push_operation_method å®šä¹‰æ˜¯å¦ä½¿ç”¨ `Service_Class` == `Unconfirmed` æˆ– `Confirmed` è°ƒç”¨ DataNotification.request æœåŠ¡åŸè¯­ä»¥åŠæ¨é€`é‡è¯•`çš„æ“ä½œ`æ–¹å¼`ã€‚

  - (0) unconfirmed, retry on `supporting protocol layer failure`ã€‚ALå±‚æ— éœ€ç¡®è®¤ï¼ˆå‘é€ç»“æœä¸ç”¨ç»™ALå±‚ï¼‰ï¼Œä¹Ÿä¸ä¼šè¶…æ—¶é‡å‘ï¼Œåªåœ¨æ”¯æŒå±‚å›å¤±è´¥æ—¶é‡å‘ï¼Œæ¡ä»¶æœ€å®½æ¾
  - (1) unconfirmed, retry on `missing supporting protocol layer confirmation`ã€‚ALå±‚æ— éœ€ç¡®è®¤ï¼ˆå‘é€ç»“æœä¸ç”¨ç»™ALå±‚ï¼‰ï¼Œä½†ä¼šåœ¨æ”¯æŒå±‚è¶…æ—¶æœªå›confirmåŸè¯­æ—¶é‡å‘ï¼ŒåŒ…å«0çš„æƒ…å†µï¼Œå¤±è´¥ä¹Ÿé‡å‘
  - (2) confirmed, retry on `missing confirmation`ã€‚å¿…é¡»ç”±ALå±‚ç¡®è®¤ï¼Œå¦åˆ™éƒ½ä¼šè¶…æ—¶é‡å‘ï¼ˆå³ä½¿æ”¯æŒå±‚å›äº†æˆåŠŸä¹Ÿä¸€æ ·ï¼‰ï¼ŒåŒ…å«0å’Œ1çš„æƒ…å†µ

- confirmation_parameters å½“ä¸ŠæŠ¥å¯¹è±¡æ˜¯ä¸€ä¸ªæ•°ç»„æ—¶ï¼Œæœ¬å‚æ•°ç”¨äºé€‰æ‹©å…¶ä¸­éƒ¨åˆ†å·²ç»è¢«ä¸ŠæŠ¥å¹¶ç¡®è®¤çš„æ¡ç›®ï¼Œé¿å…è¿™äº›æ¡ç›®ä¹Ÿè¢«ä¸ŠæŠ¥ã€‚ç›¸å¯¹é€‰æ‹©æ€§è®¿é—®æ—¶ï¼ˆè§æœ¬èŠ‚push_object_listä¸­çš„data_indexå’Œrestrictionï¼‰ï¼Œè¯¥å€¼å®šä¹‰é€‰æ‹©çš„æ¡ä»¶ï¼ˆå³å·²ç»è¢«ç¡®è®¤çš„æ¡ç›®ï¼Œå·²ç»è¢«ç¡®è®¤çš„ä¸å†æ¨é€ï¼‰ã€‚å¦‚æœæ²¡æœ‰æ¡ç›®è¢«æœ¬å±æ€§è¡¨ç¤ºçš„èŒƒå›´åŒ…å«åˆ™æ‰€æœ‰æ¡ç›®éƒ½ä¼šè¢«é€‰æ‹©ï¼Œå…¨éƒ¨æ¨é€ï¼š
  - å¼€å§‹æ—¶é—´ï¼šèŒƒå›´çš„èµ·ç‚¹
  - åç§»æ—¶é—´(ç§’)ã€‚TODO:æŒ‰æˆ‘ç†è§£è¿™é‡Œçš„ "current date" åº”è¯¥æ˜¯æŒ‡ç›¸è¾ƒäºå¼€å§‹æ—¶é—´çš„å‘ååç§»(è€Œä¸æ˜¯å½“å‰æ—¶é—´çš„æ„æ€)ï¼Œè¿™æ ·æ‰èƒ½è¡¨ç¤ºä¸€ä¸ªèŒƒå›´ã€‚
- last_confirmation_date_time ä¿å­˜ `AL` æœ€è¿‘è°ƒç”¨ `DataNotification.confirm æœåŠ¡åŸè¯­`å¹¶æ”¶åˆ° `Result == CONFIRMED` çš„æ—¥æœŸå’Œæ—¶é—´ã€‚å½“ALæ”¶åˆ°æ”¯æŒå±‚å‘æ¥çš„ç¡®è®¤æ—¶ï¼Œä¼šå°†æ ¹æ®Service_Classä»¥åŠæœ¬åœ°è¿˜æ˜¯è¿œç¨‹ç¡®è®¤æ¥è°ƒç”¨ DataNotification.confirm é€šçŸ¥ APï¼ŒResult == CONFIRMED çš„æƒ…å†µä¸º (Service_Class == Unconfirmed ä¸”æœ¬åœ°ç¡®è®¤) ä»¥åŠ (Service_Class == Confirmed ä¸”è¿œç¨‹ç¡®è®¤) ã€‚è§ Green Book 9.4.6.7 Protocol of the DataNotification service

æ–¹æ³•ï¼š

- push (data) æ¿€æ´»ä¸€æ¬¡æ¨é€ï¼Œå‘é€æºå¸¦æ¨é€æ•°æ®çš„DataNotification APDU
- reset (data) é‡ç½®ä¸ºåˆå§‹çŠ¶æ€

### s4.4.9 COSEM data protection (class_id = 30, version = 0)

è¯¥ IC çš„å®ä¾‹å…è®¸å¯¹`COSEM æ•°æ®`ï¼Œå³`å±æ€§å€¼`ã€`æ–¹æ³•`è°ƒç”¨å’Œ`è¿”å›å‚æ•°`åº”ç”¨`åŠ å¯†ä¿æŠ¤`ã€‚è¿™æ˜¯é€šè¿‡æœ¬æ¥å£ç±»çš„å®ä¾‹é—´æ¥è®¿é—®(è®¿é—®å¯ä»¥æŒ‡è¯»/å†™/æ•è·/æ¨é€ä»¥åŠå¯¹ method çš„è°ƒç”¨ç­‰)å…¶ä»– COSEM å¯¹è±¡çš„å±æ€§å’Œ/æˆ–æ–¹æ³•æ¥å®ç°çš„ï¼Œæœ¬æ¥å£ç±»æä¾›å¿…è¦çš„æœºåˆ¶å’Œå‚æ•°æ¥åº”ç”¨/éªŒè¯/ç§»é™¤å¯¹COSEMæ•°æ®çš„ä¿æŠ¤ã€‚

ä¿æŠ¤å¯åŒ…æ‹¬è®¤è¯ã€åŠ å¯†å’Œæ•°å­—ç­¾åçš„ä»»ä½•ç»„åˆï¼Œå¹¶å¯ä»¥åˆ†å±‚æ–¹å¼åº”ç”¨ã€‚åº”ç”¨å’Œç§»é™¤ä¿æŠ¤çš„åŒæ–¹æ˜¯ DLMS æœåŠ¡å™¨å’Œå¦ä¸€æ–¹ï¼ˆå¯ä»¥æ˜¯ DLMS å®¢æˆ·ç«¯æˆ–ç¬¬ä¸‰æ–¹ï¼‰ã€‚åœ¨ DLMS æœåŠ¡å™¨å’Œç¬¬ä¸‰æ–¹ä¹‹é—´åº”ç”¨æ•°æ®ä¿æŠ¤ï¼Œå¯ä»¥å¯¹ç”¨äºä¸­ç»§çš„å®¢æˆ·ç«¯(ç¬¬ä¸‰æ–¹->å®¢æˆ·ç«¯->æœåŠ¡å™¨)ä¿æŒå…³é”®/æ•æ„Ÿæ•°æ®çš„æœºå¯†æ€§ã€‚ç”±ç¬¬ä¸‰æ–¹ç­¾åçš„ COSEM æ•°æ®å¯æ”¯æŒä¸å¯æŠµèµ–æ€§(non-repudiationï¼Œè¯¥æ¶ˆæ¯ç”±ç§é’¥æŒæœ‰è€…ç­¾åï¼Œå…¶ä¸å¯å¦è®¤ï¼ŒåŒæ—¶ä¹Ÿä¿è¯æœªè¢«å…¶ä»–äººç¯¡æ”¹)ã€‚

`ä¿æŠ¤å‚æ•°`æ€»æ˜¯ç”±`å®¢æˆ·ç«¯`æ§åˆ¶ï¼Œä¸€äº›å…ƒç´ ç”±æœåŠ¡å™¨é€‚å½“åœ°å¡«å……ã€‚`å®‰å…¨å¥—ä»¶`ç”±â€œ`Security setup`â€å¯¹è±¡å†³å®šï¼Œè¯¥å¯¹è±¡æ¥è‡ªå½“å‰çš„â€œAssociation SNâ€/â€œAssociation LNâ€å¯¹è±¡ã€‚

![dataprotection](/assets/img/2022-03-17-dlms-blue2/dataprotection.jpg)

å¯èƒ½çš„ä½¿ç”¨åœºæ™¯ï¼š

- å½“ protection_buffer å±æ€§è¢«è¯»å–/æ•è·(Profileå¯¹è±¡)/æ¨é€æ—¶ï¼š
  1. protection_object_list å†…å®šä¹‰çš„å†…å®¹è¢«æ•è·(æš‚å­˜åœ¨å†…å­˜ä¸­)
  2. æ ¹æ® protection_parameters_get å±æ€§æè¿°çš„ä¿æŠ¤æ–¹å¼å¯¹ä¸Šä¸€æ­¥çš„å†…å®¹è¿›è¡Œä¿æŠ¤ï¼Œç„¶åå†™å…¥ protection_buffer å†…ã€‚
  3. å°† protection_buffer å†…çš„å†…å®¹è¿”å›ç»™éœ€è¦çš„æº(getè°ƒç”¨è€…/profileå¯¹è±¡/push setupå¯¹è±¡)
  ![dataprotection2](/assets/img/2022-03-17-dlms-blue2/dataprotection2.jpg)
  å›¾ä¸­åº”ç”¨äº†ä¸¤å±‚ä¿æŠ¤ï¼ŒåŠ å¯†å’Œæ•°å­—ç­¾åã€‚
- å½“ protection_buffer è¢«å†™å…¥æ—¶ï¼š
  1. æ­¤æ—¶ protection_buffer å†…çš„æ•°æ®åº”è¯¥æ˜¯è¢«ä¿æŠ¤åçš„æ•°æ®
  2. æ ¹æ® protection_parameters_set å±æ€§æè¿°çš„ä¿æŠ¤æ–¹å¼è§£é™¤ä¿æŠ¤ï¼Œç„¶åå°†ç»“æœ(ç»“æœåº”è¯¥åœ¨å†…å­˜é‡Œ)å†™å…¥ protection_object_list æè¿°çš„ä½ç½®ã€‚
- å½“ get_protected_attributes æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼š
  1. å‚æ•° get_protected_attributes_request å†…çš„ object_list å†…æè¿°çš„å±æ€§è¢«æ•è·
  2. å‚æ•° get_protected_attributes_request å†…çš„ protection_parameters æè¿°çš„ä¿æŠ¤æ–¹å¼è¢«åº”ç”¨åˆ°ä¸Šä¸€æ­¥æ•è·åˆ°çš„å†…å®¹ä¸­(TODO: åŸæ–‡å†™çš„æ˜¯ response çš„ protection_parametersï¼Œåº”è¯¥æ˜¯é”™è¯¯çš„)ã€‚æ³¨æ„å¦‚æœ protection_parameters å’Œæœ¬å¯¹è±¡çš„ required_protection å±æ€§æè¿°ä¸ä¸€è‡´ï¼Œæœ¬æ–¹æ³•å°†è°ƒç”¨å¤±è´¥ã€‚
  3. è¿”å›è¢«ä¿æŠ¤åçš„å†…å®¹(æ³¨æ„æ•´ä¸ªè¿‡ç¨‹éƒ½æ²¡æœ‰ç”¨åˆ° protection_buffer)
- å½“ set_protected_attributes æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼š
  1. å‚æ•° set_protected_attributes_request ä¸­çš„ protected_attributes æ‰€æ·»åŠ çš„ä¿æŠ¤å°†é€šè¿‡ä½¿ç”¨ protection_parameters è¢«éªŒè¯å¹¶ç§»é™¤ã€‚æ³¨æ„ä¹Ÿå¿…é¡»å’Œæœ¬å¯¹è±¡çš„ required_protection å±æ€§æè¿°ä¸€è‡´ï¼Œå¦åˆ™è°ƒç”¨å°†å¤±è´¥ã€‚
  2. å°†ä¸Šä¸€æ­¥å†…å®¹å†™å…¥ object_list æè¿°çš„å¯¹è±¡ä¸­ã€‚
- å½“ invoke_protected_method è¢«è°ƒç”¨æ—¶ï¼š
  1. æ ¹æ®è¯¥æ–¹æ³•çš„è¯·æ±‚å‚æ•°ä¸­çš„ protection_parameters éªŒè¯å¹¶ç§»é™¤è¦è°ƒç”¨çš„æ–¹æ³•çš„è¢«ä¿æŠ¤çš„å‚æ•°ã€‚æ³¨æ„ä¹Ÿå¿…é¡»å’Œæœ¬å¯¹è±¡çš„ required_protection å±æ€§æè¿°ä¸€è‡´ï¼Œå¦åˆ™è°ƒç”¨å°†å¤±è´¥ã€‚
  2. è¯·æ±‚å‚æ•°ä¸­çš„ object_method å¯¹åº”çš„æ–¹æ³•å°†è¢«è°ƒç”¨ï¼Œå‚æ•°ä¸ºä¸Šä¸€æ­¥ä¸­è§£é™¤ä¿æŠ¤åçš„å‚æ•°ã€‚
  3. æ ¹æ® response protection parameters ä¿æŠ¤è¿”å›å€¼ã€‚æ³¨æ„ä¹Ÿå¿…é¡»å’Œæœ¬å¯¹è±¡çš„ required_protection å±æ€§æè¿°ä¸€è‡´ï¼Œå¦åˆ™è°ƒç”¨å°†å¤±è´¥ã€‚
  4. å°†ä¿æŠ¤åçš„è¿”å›å€¼è¿”å›ã€‚

å±æ€§ï¼š

- protection_buffer åŒ…å«`å—ä¿æŠ¤çš„æ•°æ®`ã€‚è¯»å–æ—¶ï¼Œæ•è·ç”±protection_object_listæŒ‡å®šçš„å±æ€§ï¼Œç„¶åæ ¹æ®protection_parameters_getåº”ç”¨ä¿æŠ¤ã€‚å†™å…¥æ—¶ï¼Œå—ä¿æŠ¤çš„æ•°æ®è¢«æ”¾å…¥protection_bufferä¸­ï¼Œç„¶åæ ¹æ®protection_parameters_setéªŒè¯/åˆ é™¤ä¿æŠ¤ï¼Œå¹¶è®¾ç½®ç”±protection_object_listæŒ‡å®šçš„å±æ€§ã€‚
- protection_object_list å®šä¹‰åœ¨`è¯»å–`protection_bufferæ—¶è¦`æ•è·`çš„å±æ€§åˆ—è¡¨ï¼Œæˆ–è€…åœ¨`å†™å…¥`protection_bufferæ—¶è¦`è®¾ç½®`çš„å±æ€§åˆ—è¡¨ã€‚
  
  å…³äºé€‰æ‹©æ€§è®¿é—®çš„æè¿°è§Compact data
- protection_parameters_get åŒ…å«æ‰€æœ‰å¿…è¦çš„`å‚æ•°`ï¼Œç”¨äºæŒ‡å®š`è¯»å–`protection_bufferæ—¶åº”ç”¨çš„`ä¿æŠ¤`ã€‚è¿™ä¸ªå±æ€§é¦–å…ˆç”±`å®¢æˆ·ç«¯`å†™å…¥ã€‚æœåŠ¡å™¨å¯èƒ½éœ€è¦å¡«å†™ä¸€äº›é¢å¤–çš„å…ƒç´ ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å¿…é¡»è¯»å›è¿™ä¸ªå±æ€§â€”â€”å¦‚æœéœ€è¦çš„è¯ï¼Œè½¬å‘ç»™ç¬¬ä¸‰æ–¹â€”â€”ä»¥ä¾¿ä»–ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›å‚æ•°æ¥éªŒè¯/åˆ é™¤ä¿æŠ¤
- protection_parameters_set åŒ…å«æ‰€æœ‰`å¿…è¦çš„å‚æ•°`ï¼Œç”¨äºåœ¨`å†™å…¥`protection_bufferæ—¶`éªŒè¯/åˆ é™¤`åº”ç”¨çš„ä¿æŠ¤ã€‚å‚æ•°ä¸getç›¸åŒã€‚æ­¤å±æ€§ç”±å®¢æˆ·ç«¯ç¼–å†™ï¼Œå¹¶ç”±æœåŠ¡å™¨ä½¿ç”¨å®ƒæ¥éªŒè¯å’Œåˆ é™¤ä¿æŠ¤ã€‚
- required_protection è§„å®šäº†é€šè¿‡â€œData protectionâ€å¯¹è±¡è®¿é—®çš„`å±æ€§å€¼/è°ƒç”¨`å’Œ`æ–¹æ³•çš„è¿”å›å‚æ•°`æ‰€éœ€çš„ä¿æŠ¤ã€‚

  å¯¹äºrequestå’Œresponseçš„ä¿æŠ¤æ–¹å¼

æ–¹æ³•ï¼š

- get_protected_attributes (data) è·å– protection_object_list å…ƒç´ æŒ‡å®šçš„å±æ€§çš„å€¼ï¼Œå¹¶åº”ç”¨get_protected_attributes_responseä¸­æ ¹æ®protection_parametersè®¾ç½®çš„ä¿æŠ¤

  get_protected_attributes_responseä¸­çš„protection_parameterså€¼æ˜¯æ ¹æ®è¯·æ±‚å‚æ•°get_protected_attributes_requestä¸­çš„åŒåå…ƒç´ å¾—åˆ°çš„ï¼ŒæœåŠ¡ç«¯å¯èƒ½ä¼šæœ‰ä¿®æ”¹ï¼Œæ‰€ä»¥ä¸åªæ˜¯æ‹·è´ï¼Œå¯èƒ½ä¼šæœ‰ä¸åŒ
- set_protected_attributes (data) æ ¹æ®protection_parameterså…ƒç´ ï¼Œåœ¨éªŒè¯å¹¶ç§»é™¤protected_attributeså…ƒç´ ä¸Šçš„ä¿æŠ¤ä¹‹åï¼Œè®¾ç½® protection_object_list å…ƒç´ æŒ‡å®šçš„å±æ€§å€¼ã€‚
- invoke_protected_method (data) ä»¥ä¿æŠ¤æ–¹å¼æ‰§è¡Œç‰¹å®šæ–¹æ³•ï¼Œæ–¹æ³•çš„å‚æ•°å’Œè¿”å›å€¼è¢«ä¿æŠ¤ã€‚åœ¨æ ¹æ®invoke_protected_method_requestä¸­çš„protection_parameterséªŒè¯å¹¶ç§»é™¤protected_method_invocation_parametersä¸Šçš„`ä¿æŠ¤å`ï¼Œ`è°ƒç”¨`object_methodå…ƒç´ `æŒ‡å®šçš„æ–¹æ³•`ã€‚

  åœ¨è°ƒç”¨ç”± object_method å…ƒç´ æŒ‡å®šçš„æ–¹æ³•åï¼Œæ ¹æ® invoke_protected_method_response ä¸­çš„ protection_parameters çš„ä¿æŠ¤ï¼ˆå¿…é¡»æ»¡è¶³ required_protectionï¼‰åº”ç”¨äºè¿”å›å‚æ•°ï¼Œå¹¶ä¸”ç”± protection_parameters å’Œ protected_method_return_parameters ç»„æˆçš„ invoke_protected_method_response è¿”å›ã€‚
  
  ```asn.1
  invoke_protected_method_request ::= structure {
    object_method è¦æ‰§è¡Œçš„æ–¹æ³•
    protection_parameters: ä¿æŠ¤å‚æ•°
    object_method_definitionï¼š è¢«ä¿æŠ¤çš„å‚æ•°
    }

  invoke_protected_method_response ::= structure {
    protection_parameters: ä¿æŠ¤å‚æ•°
    protected_method_return_parameters: è¢«ä¿æŠ¤çš„è¿”å›å€¼ï¼ˆå‚æ•°ï¼‰
    }
  ```

æ³¨æ„ï¼šä¸Šé¢ä¸‰ä¸ªæ–¹æ³•ä¸­çš„ protection_parameters éƒ½å¿…é¡»æ»¡è¶³ required_protectionï¼Œå¦åˆ™è§†ä¸ºè°ƒç”¨å¤±è´¥ã€‚

### s4.4.10 Function control (class_id: 122, version: 0)

ICâ€œFunction controlâ€çš„å®ä¾‹å…è®¸å¯ç”¨å’Œç¦ç”¨æœåŠ¡ç«¯ä¸­çš„`åŠŸèƒ½`ï¼ˆFunctionï¼‰ã€‚æ¯ä¸ªå¯ä»¥å¯ç”¨/ç¦ç”¨çš„åŠŸèƒ½éƒ½ç”±ä¸€ä¸ªåç§°æ ‡è¯†ï¼Œå¹¶ç”±å¼•ç”¨çš„ä¸€ç»„ç‰¹å®šå¯¹è±¡æ ‡è¯†ç¬¦å®šä¹‰ã€‚

å¯ä»¥å€ŸåŠ©â€œSingle action scheduleâ€å’Œâ€œScript tableâ€å¯¹è±¡æ¥å®ç°æŒ‰æ—¶é—´æ§åˆ¶åŠŸèƒ½çš„ç¦ç”¨å’Œå¯ç”¨

å±æ€§ï¼š

- activation_status æ˜¾ç¤ºfunction_listå±æ€§ä¸­å®šä¹‰çš„æ¯ä¸ªåŠŸèƒ½å—çš„`å½“å‰çŠ¶æ€`(å¯ç”¨æˆ–ç¦ç”¨)
- function_list å®šä¹‰ä¸€ä¸ª`åŠŸèƒ½åˆ—è¡¨`ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨set_function_statusæ–¹æ³•å¯ç”¨æˆ–ç¦ç”¨è¿™äº›åŠŸèƒ½ã€‚é€šè¿‡class_idå’Œlogical_nameæŒ‡å®šï¼Œå½“åŠŸèƒ½ä¸èƒ½å¯¹åº”ç‰¹å®šçš„COSEMå¯¹è±¡æ—¶ï¼Œclass_idä¸º0ï¼Œlogical_nameä¸ºç‰¹å®šæè¿°æ–‡æœ¬ã€‚

  è¿™é‡Œçš„`åŠŸèƒ½`åŒ…å«äº†è‹¥å¹²ä¸ªå…·ä½“çš„`å…³è”å¯¹è±¡`ï¼Œä¹Ÿå°±æ˜¯æ˜¯ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œç”±ä¸åŒçš„å¯¹è±¡çš„åˆä½œå®ç°çš„ä¸€ä¸ª`åŠŸèƒ½`

æ–¹æ³•ï¼š

- set_function_status (data) å¯ç”¨æˆ–ç¦ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªåŠŸèƒ½
- add_function (data) æ·»åŠ ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œå¿…é¡»æ˜¯æœåŠ¡ç«¯æ”¯æŒçš„
- remove_function (data) ç§»é™¤ä¸€ä¸ªæ–°åŠŸèƒ½

### s4.4.11 Array manager (class_id = 123, version = 0)

"Array manager"ICçš„å®ä¾‹å…è®¸ç®¡ç†`å…¶ä»–`æ¥å£å¯¹è±¡çš„å…·æœ‰`æ•°ç»„ç±»å‹`çš„`å±æ€§`ï¼š

- æ£€ç´¢æ¡ç›®çš„æ•°é‡;
- é€‰æ‹©æ€§åœ°è¯»å–ä¸€å®šèŒƒå›´å†…çš„æ¡ç›®;
- æ’å…¥æ–°æ¡ç›®æˆ–æ›´æ–°ç°æœ‰æ¡ç›®;
- åˆ é™¤ä¸€ä¸ªèŒƒå›´çš„æ¡ç›®

`æ¯ä¸ª`å®ä¾‹å…è®¸ç®¡ç†åˆ†é…ç»™å®ƒçš„æ•°ç»„ç±»å‹çš„`å‡ ä¸ª`å±æ€§

TODOï¼šè¯¥å¯¹è±¡æœ‰æƒé™è®¿é—®ä¿®æ”¹å…¶ä»–å¯¹è±¡çš„å±æ€§ï¼Ÿ

å±æ€§ï¼š

- array_object_list å®šä¹‰å¯ç”±è¯¥ICçš„å®ä¾‹ç®¡ç†çš„æ•°ç»„ç±»å‹çš„å±æ€§åˆ—è¡¨

æ–¹æ³•ï¼š

- retrieve_number_of_entries(data) è¿”å›ä¸€ä¸ªæ•°ç»„ä¸­å·²æ ‡è¯†çš„æ¡ç›®`æ€»æ•°`

- retrieve_entries (data) æ£€ç´¢array_object_listæ•°ç»„ä¸­çš„ä¸€ä¸ªæ•°ç»„é¡¹çš„`èŒƒå›´`æ•°æ®ã€‚

  mè¡¨ç¤ºè®°å½•æ€»æ•°ï¼Œfrom_entryå’Œto_entryè¡¨ç¤ºæ•°ç»„åºå·ï¼Œåºå·ä¸º1åˆ°m

  - from_entry < to_entry < mï¼Œè¿”å›from_entry åˆ° to_entryè®°å½•
  - from_entry < to_entryï¼Œto_entry > mï¼Œè¿”å›from_entryåˆ°mçš„è®°å½•
  - from_entry < to_entryï¼Œfrom_entry>mï¼Œè¿”å›å…ƒç´ ä¸ªæ•°ä¸º0çš„ç©ºæ•°ç»„
  - from_entry > to_entryï¼Œè¿”å›é”™è¯¯
- insert_entry (data) å‘ä¸€ä¸ªæ•°ç»„æ’å…¥ä¸€æ¡æ–°è®°å½•,æ’å…¥åˆ°å‚æ•°idæ ‡è¯†çš„åºå·ä¹‹åï¼Œä¹‹åæ‰€æœ‰è®°å½•é¡ºä½åå»¶ï¼Œå¦‚æœå·²æ»¡åˆ™æ’å…¥å¤±è´¥ã€‚å…¶ä¸­ï¼š
  - idä¸º0è¡¨ç¤ºæ’å…¥åå˜ä¸ºç¬¬ä¸€ä¸ªï¼Œå…¶ä»–æ‰€æœ‰è®°å½•é¡ºä½åå»¶
  - idå¤§äºmè¡¨ç¤ºåœ¨æœ«å°¾è¿½åŠ 
- update_entry (data) æ›´æ–°ä¸€ä¸ªæ•°ç»„ä¸­çš„ä¸€æ¡è®°å½•
- remove_entries (data) æŒ‰èŒƒå›´åˆ é™¤æ•°ç»„ï¼ŒåŒretrieve_entries

å½“å·²å­˜åœ¨çš„è®°å½•çš„é¡ºä½å˜åŒ–æ—¶ï¼Œæ¯”å¦‚ insert å’Œ remove éƒ½ä¼šå¯èƒ½å¯¼è‡´éƒ¨åˆ†æ¡ç›®çš„åºå·çš„å˜åŒ–ï¼Œæ‰€æœ‰æŒ‰åºå·å¯¹å®ƒä»¬çš„å¼•ç”¨éƒ½å¿…é¡»æ›´æ–°(æ¯”å¦‚æœ‰äº›å¯¹è±¡å±æ€§é€šè¿‡ data_index å¼•ç”¨äº†æŸæ¡è®°å½•)ã€‚

### s4.4.12 Communication port protection (class_id = 124, version = 0)

`ä¿æŠ¤é€šä¿¡ç«¯å£`ï¼Œé˜²æ­¢æ¶æ„é€šä¿¡ï¼Œå¦‚æš´åŠ›ç ´è§£

å±æ€§ï¼š

- protection_mode `ä¿æŠ¤æ¨¡å¼`ï¼Œ

  - é”å®š
  - å¤±è´¥å°è¯•åé”å®š
  - æ— é”å®š
- allowed_failed_attempts è§¦å‘é”å®šæœºåˆ¶ä¹‹å‰å…è®¸çš„å¤±è´¥é€šä¿¡`å°è¯•æ¬¡æ•°`ã€‚
- initial_lockout_time ç¬¬ä¸€æ¬¡è§¦å‘é”å®šçš„`é”å®šæ—¶é—´`
- steepness_factor é”å®šæ—¶é—´`é€’å¢æ­¥é•¿`

  NCA=failed_attempts-allowed_failed_attempts
  
  CLT=initial_lockout_time x (steepness_factor^(NCA-1))

- max_lockout_time `æœ€å¤§é”å®šæ—¶é—´`,é¿å…æ‹’ç»æœåŠ¡æ”»å‡»(DDoS)
- port_reference è¢«ä¿æŠ¤ç«¯å£å¯¹è±¡çš„é€»è¾‘å
- protection_status å½“å‰ä¿æŠ¤çŠ¶æ€ï¼Œæœªé”å®šã€ä¸´æ—¶é”å®šã€å·²é”å®š
- failed_attempts å¤±è´¥æ€»æ•°ï¼Œä¸ä¿æŠ¤æœºåˆ¶è§¦å‘æ— å…³ï¼Œä¼šè¢«reseté‡ç½®
- cumulative_failed_attempts `å¤±è´¥æ€»æ•°`ï¼Œä¸ä¿æŠ¤æœºåˆ¶è§¦å‘æ— å…³ï¼Œä¸ä¼šè¢«é‡ç½®

æ–¹æ³•ï¼š

- reset (data) é‡ç½®failed_attemptsã€current lockout timeã€protection_status

## s4.5 æ—¶é—´å’Œäº‹ä»¶ç»‘å®šæ§ä»¶çš„æ¥å£ç±»Interface classes for time- and event bound control

### s4.5.1 Clock (class_id = 8, version = 0)

è¯¥ICä¸ºè®¾å¤‡æ—¶é’Ÿå»ºæ¨¡ï¼Œç®¡ç†æ‰€æœ‰ä¸`æ—¥æœŸå’Œæ—¶é—´`ç›¸å…³çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”±äºæ—¶åŒºå’Œ`å¤ä»¤æ—¶`æ–¹æ¡ˆè€Œå¯¼è‡´çš„æœ¬åœ°æ—¶é—´ä¸é€šç”¨æ—¶é—´å‚è€ƒ(UTC)çš„åå·®ã€‚ICè¿˜æä¾›äº†å„ç§è°ƒæ•´æ—¶é’Ÿçš„æ–¹æ³•

æ—¥æœŸä¿¡æ¯åŒ…æ‹¬`â€œå¹´â€ã€â€œæœˆâ€ã€â€œæ—¥â€ã€â€œå‘¨â€`ã€‚æ—¶é—´ä¿¡æ¯åŒ…æ‹¬`å°æ—¶ã€åˆ†é’Ÿã€ç§’ã€ç™¾åˆ†ä¹‹ä¸€ç§’`ä»¥åŠæœ¬åœ°æ—¶é—´ä¸UTCçš„`åå·®`ã€‚å¤ä»¤æ—¶åŠŸèƒ½æ ¹æ®å±æ€§ä¿®æ”¹æœ¬åœ°æ—¶é—´ä¸UTCçš„åå·®;å‚è§å›¾20æ‰€ç¤ºã€‚è¯¥å‡½æ•°çš„èµ·å§‹ç‚¹å’Œç»“æŸç‚¹é€šå¸¸è®¾ç½®ä¸€æ¬¡ã€‚å†…éƒ¨ç®—æ³•æ ¹æ®è¿™äº›è®¾ç½®è®¡ç®—å‡ºçœŸæ­£çš„å¼€å…³ç‚¹

å±æ€§ï¼š

- time åŒ…å«ä»ªè¡¨çš„æœ¬åœ°æ—¥æœŸå’Œæ—¶é—´ã€ä¸UTCçš„åå·®(æ—¶åŒºï¼Ÿ)ã€çŠ¶æ€ã€‚æ ¼å¼ä¸ºdate-timeã€‚å¯åªä¿®æ”¹éƒ¨åˆ†å­—æ®µï¼Œå¦‚åªä¿®æ”¹dateç›¸å…³å­—èŠ‚ã€‚
  å¦‚æœåªä¿®æ”¹dateï¼Œæ­¤æ—¶å‚æ•°ä¸­ä¿å­˜timeçš„å­—èŠ‚éœ€æ ‡è®°ä¸º"not specified"ã€‚æ¯”å¦‚ 0x07DE081302FFFFFFFF ä¸­è¡¨ç¤º time çš„åå››ä¸ªå­—èŠ‚ä¸º 0xFF(not specified)ï¼Œè¿™æ®µæ•°æ®å†™å…¥æœ¬å±æ€§æ—¶å°±ä¸ä¼šä¿®æ”¹åŸæ¥çš„ time éƒ¨åˆ†ã€‚
- time_zone æ—¶åŒº
- status çŠ¶æ€
- daylight_savings_begin å¤ä»¤æ—¶å¼€å§‹æ—¥æœŸæ—¶é—´
- daylight_savings_end å¤ä»¤æ—¶ç»“æŸæ—¥æœŸæ—¶é—´
- daylight_savings_deviation å¤ä»¤æ—¶åç§»ï¼ˆåˆ†é’Ÿï¼‰
- daylight_savings_enabled å¤ä»¤æ—¶åŠŸèƒ½æ˜¯å¦å¯ç”¨ï¼ˆæ³¨æ„æ˜¯è¯¥åŠŸèƒ½æ˜¯å¦å¯ç”¨ï¼Œä¸æ˜¯è¡¨ç¤ºæ˜¯å¦å¤„äºå¤ä»¤æ—¶ï¼‰
- clock_base æ—¶é’Ÿä¿¡æ¯ä¾æ®
  - æ— 
  - å†…éƒ¨æ™¶æŒ¯
  - å¸‚ç”µé¢‘ç‡50Hz
  - å¸‚ç”µé¢‘ç‡60Hz
  - GPS
  - æ— çº¿ç”µæ§åˆ¶

æ–¹æ³•ï¼š

- adjust_to_quarter (data) å°†æ—¶é—´è°ƒæ•´ä¸ºæœ€è¿‘(+/-)çš„æ•´åˆ»é’Ÿ(\*:00,\*:15,\*:30,\*:45)
- adjust_to_measuring_period (data) å°†æ—¶é—´è°ƒæ•´ä¸ºæœ€è¿‘(+/-)`æµ‹é‡å‘¨æœŸ`çš„èµ·ç‚¹
- adjust_to_minute (data) å°†æ—¶é—´è°ƒæ•´ä¸ºæœ€è¿‘(+/-)æ•´åˆ†é’Ÿ
- adjust_to_preset_time (data) å’Œpreset_adjusting_timeé…åˆï¼Œæ¿€æ´»preset_timeï¼Œæ‰§è¡Œæ—¶çš„æ—¶é—´å¿…é¡»æ˜¯æ—¶é—´èŒƒå›´å†…çš„
- preset_adjusting_time (data) å®šä¹‰ä¸€ä¸ªé¢„è®¾æ—¶é—´preset_timeå’Œä¸€ä¸ªå…è®¸æ‰§è¡Œç”Ÿæ•ˆæ—¶é—´èŒƒå›´
- shift_time (data) å°†æ—¶é—´ç§»åŠ¨ n (-900 <= n <= 900) ç§’ã€‚nä¸ºlongç±»å‹

### s4.5.2 Script table (class_id = 9, version = 0)

é€šè¿‡è„šæœ¬æ‰§è¡Œä¸€ç³»åˆ—åŠ¨ä½œ

è„šæœ¬å¯ç”±åŒä¸€ä¸ªé€»è¾‘è®¾å¤‡å†…å…¶ä»–COSEMå¯¹è±¡æˆ–ä»å¤–éƒ¨æ¿€æ´»

åŒæ—¶æ‰§è¡Œæ—¶ç´¢å¼•å°çš„ä¼˜å…ˆæ‰§è¡Œ

å±æ€§ï¼š

- scripts è„šæœ¬ï¼Œæ“ä½œåˆ—è¡¨ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„
  - action_specificationæŒ‡å‘å¼•ç”¨å¯¹è±¡çš„åŠ¨ä½œï¼ˆé™åˆ¶ä¸º`ä¸äº§ç”Ÿå“åº”`çš„åŠ¨ä½œï¼‰
    - service_idï¼Œè¡¨ç¤ºæ‰§è¡Œçš„åŠ¨ä½œçš„ç±»å‹ï¼Œç›®å‰æœ‰ä¸¤ç§ï¼š
      - å†™å±æ€§
      - æ‰§è¡Œæ–¹æ³•ï¼ˆä»…é™æ— éœ€å“åº”çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯æ–¹æ³•ï¼Œè¿™ç±»æ–¹æ³•éƒ½æ˜¯è¢«å®¢æˆ·ç«¯è°ƒç”¨ï¼Œè€Œä¸æ˜¯ä¸»åŠ¨å‘èµ·ï¼ŒTODO:æœ‰éœ€è¦å“åº”çš„æ–¹æ³•å—ï¼Ÿï¼‰

æ–¹æ³•ï¼š

- execute (data) æ‰§è¡Œå¯¹åº”çš„è„šæœ¬ï¼Œå‚æ•°ä¸º script_identifier

### s4.5.3 Schedule (class_id = 10, version = 0)

è®¡åˆ’æ—¶é—´è¡¨ï¼Œå¯ä»¥é…åˆ Special days å’Œ Script table å¯¹è±¡ï¼Œå®ç°æ—¥æœŸé©±åŠ¨çš„å®šæ—¶ä»»åŠ¡æ‰§è¡Œï¼Œç±»ä¼¼äº Linux ä¸­çš„ crontab

å±æ€§ï¼š

- entries ç»™å®šæ—¶é—´æ‰§è¡Œçš„è„šæœ¬
  - schedule_table_entry
    - index:æœ¬æ¡ç›®çš„ç´¢å¼•
    - enable:æœ¬æ¡ç›®æ˜¯å¦å¯ç”¨
    - script_logical_name `Script table`å¯¹è±¡çš„é€»è¾‘å
    - script_selector é€‰æ‹©`Script table`å¯¹è±¡ä¸­çš„script_identifierï¼Œè¡¨ç¤ºè¦æ‰§è¡Œçš„è„šæœ¬
    - switch_time æ‰§è¡Œæ—¶é—´ï¼Œæ”¯æŒé€šé…ç¬¦ï¼Œtimeæ ¼å¼ï¼Œä¸å« date ä¿¡æ¯
    - Validity_window æœ‰æ•ˆçª—å£ï¼ˆæ‰§è¡Œå®½å®¹æ—¶é—´ï¼‰ï¼Œä¸€ä¸ªä»¥åˆ†é’Ÿä¸ºå•ä½çš„`æ—¶é—´æ®µ`ï¼Œç”¨äºæ‰§è¡Œæ—¶é—´åœ¨æ‰ç”µæœŸé—´æ— æ³•æ‰§è¡Œæ—¶ï¼Œå…è®¸çš„å»¶åæ‰§è¡Œæ—¶é—´ï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…ä¸Šç”µï¼Œå°±ä¾ç„¶å…è®¸æ‰§è¡Œã€‚(**è§¦å‘æ—¶é—´switch_timeåˆ°è¾¾ååœ¨è¿™ä¸ªæ—¶é—´èŒƒå›´å†…å¿…é¡»æ‰§è¡Œï¼Œå¦‚æœæœªåŠæ—¶ä¸Šç”µå¯¼è‡´æ‰§è¡Œä¸äº†ï¼Œåˆ™ä¸æ‰§è¡Œ**)ã€‚0xFFFF:æ— é™å®½å®¹æ—¶é—´ï¼Œè„šæœ¬æ— è®ºè¢«å»¶åå¤šé•¿æ—¶é—´ï¼Œéƒ½å¿…é¡»è¢«å¤„ç†;
    - exec_weekdays å®šä¹‰æ¯å‘¨ä¸­å“ªäº›å¤©æœ‰æ•ˆï¼ˆæ¯”å¦‚ä»…å®šä¹‰å‘¨å››æœ‰æ•ˆï¼Œè„šæœ¬å°±åªèƒ½åœ¨å‘¨å››æ‰§è¡Œï¼‰
    - exec_specdays è§èŠ‚æ—¥è¡¨â€œSpecial days tableâ€, day_id
    - Begin_dateå’Œend_date å®šä¹‰äº†æ¡ç›®æœ‰æ•ˆçš„æ—¥æœŸèŒƒå›´(å…è®¸é€šé…ç¬¦)

æ–¹æ³•ï¼š

- enable/disable (data) å‚æ•°æœ‰Aå’ŒBä¸¤ä¸ªèŒƒå›´ï¼ŒAèŒƒå›´å†…çš„æ¡ç›®ç¦ç”¨ï¼ŒBèŒƒå›´å†…çš„å¯ç”¨
- insert (data) æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼Œå·²å­˜åœ¨æ—¶è¦†ç›–
- delete (data) æŒ‰ç´¢å¼•èŒƒå›´åˆ é™¤è®°å½•

ç›¸åŒçš„è„šæœ¬åŒæ—¶æ‰§è¡Œæ—¶ï¼Œè§„åˆ™ä¸ºä»…æ‰§è¡Œå…¶ä¸­ä¸€æ¡ã€‚

æ—¶é—´è°ƒæ•´å¤„ç†ï¼š

- Time setting `forward`ï¼šå‘åè°ƒæ•´æ—¶é—´ï¼Œè°ƒæ•´è‡³æ›´æ™šçš„æ—¶é—´ï¼Œæ­¤æ—¶æ“ä½œå’Œæ‰ç”µç›¸åŒï¼Œæ ¹æ®Validity_windowè¡¥æ‰§è¡Œ
- Time setting `backward`ï¼šå‘å‰è°ƒæ•´æ—¶é—´ï¼Œè°ƒæ•´è‡³æ›´æ—©æ—¶é—´ï¼Œä¼šå‡ºç°é‡å¤æ‰§è¡Œçš„æƒ…å†µ
- Time synchronizationï¼šæ—¶é—´æ ¡å‡†æ“ä½œæ˜¯å¯¹æ—¶é—´çš„ä¸€ç§è‡ªåŠ¨å¾®è°ƒï¼ˆå‘å‰æˆ–å‘åè°ƒæ•´ä¸€ä¸ªå¾ˆçŸ­çš„æ—¶é—´ï¼‰ï¼Œå®ƒå› ä¿è¯æ‰€æœ‰åº”è¯¥æ‰§è¡Œä¸€æ¬¡çš„è„šæœ¬éƒ½ä»…æ‰§è¡Œä¸€æ¬¡ï¼Œä¸ä¼šå‡ºç°é—æ¼æˆ–é‡å¤æ‰§è¡Œã€‚å’Œä¸Šé¢ä¸¤ç§æƒ…å†µç›¸æ¯”æ›´åŠ ä¸¥æ ¼ã€‚
- å¤ä»¤æ—¶å‘åè°ƒæ•´æ—¶é—´åˆ™æ‰§è¡Œæ‰€æœ‰å› æ­¤é”™è¿‡çš„è„šæœ¬(æ— è§† switch_time)ï¼Œå‘å‰åˆ™ä¸æ‰§è¡Œé‡å¤çš„è„šæœ¬

### s4.5.4 Special days table (class_id = 11, version = 0)

å®šä¹‰ç‰¹æ®Šæ—¥æœŸï¼Œç‰¹æ®Šæ—¥æœŸè¡Œä¸ºä¼šè¦†ç›–é€šå¸¸çš„ï¼Œä¸â€œSchedule" æˆ– "Activity calendar"(é€šå¸¸æ—¥å†è¡¨) åŒæ—¶æ‰§è¡Œ

ä¸ºç»™å®šæ—¥æœŸæŒ‡å®šç‰¹æ®Šçš„æ—¥æœŸæ ‡è¯†ç¬¦ã€‚æ—¥æœŸå¯èƒ½å…·æœ‰é‡å¤ç‰¹æ®Šæ—¥å­çš„é€šé…ç¬¦ï¼Œå¦‚åœ£è¯èŠ‚(åœ£è¯èŠ‚æ¯å¹´éƒ½æœ‰ï¼Œæ‰€ä»¥å¹´ä»½å°±æ˜¯é€šé…ç¬¦)ã€‚

å±æ€§ï¼š

- entries æ•°ç»„ï¼Œæ¯ä¸ªæ¡ç›®è¡¨ç¤ºä¸€ä¸ªç‰¹æ®Šæ—¥æœŸï¼Œå¦‚åœ£è¯èŠ‚
  - spec_day_entry
    - index æ¡ç›®åºå·
    - specialday_date èŠ‚æ—¥çš„æ—¥æœŸ
    - day_id æ ‡è¯†èŠ‚æ—¥ï¼ˆæ¯”å¦‚æœ‰çš„èŠ‚æ—¥æ¯å¹´çš„æ—¶é—´ä¸åŒï¼Œåˆä¸èƒ½ç”¨é€šé…ç¬¦è¡¨ç¤ºï¼Œå°±ä¼šå‡ºç°å¤šæ¡spec_day_entryçš„day_idç›¸åŒçš„æƒ…å†µï¼Œæ¯å¹´éƒ½æœ‰ä¸€æ¡ï¼‰ï¼Œç”¨æ¥å’Œ Schedule ç±»çš„ exec_specdays å…³è”ã€‚

æ–¹æ³•ï¼š

insert (data) å‘entiresæ’å…¥ä¸€æ¡è®°å½•ï¼Œindex å’Œ specialday_date éƒ½æ˜¯å”¯ä¸€é”®ï¼Œä»»æ„ä¸€ä¸ªé‡å¤éƒ½ä¼šè¦†ç›–
delete (data) åˆ é™¤ä¸€æ¡ï¼Œç”¨ index ç´¢å¼•

### s4.5.5 Activity calendar (class_id = 20, version = 0)

æŒ‰è®¡åˆ’æ‰§è¡Œè„šæœ¬ï¼Œéµå¾ªæ—¥å†æ—¶é—´è¡¨æ–¹å¼ï¼Œï¼ˆå’Œè´¹ç‡ç›¸å…³ï¼Ÿï¼‰TODOï¼šå’ŒScheduleçš„åŒºåˆ«

å¯ä¸`Schedule`å¯¹è±¡`å…±å­˜`ï¼Œé‡å æ—¶`Schedule`å¯¹è±¡`ä¼˜å…ˆæ‰§è¡Œ`ã€‚ä¸Šç”µæ—¶ï¼Œå’Œ Schedule æ“ä½œä¸å¤ªä¸€æ ·ï¼Œä»…æ‰§è¡Œé”™è¿‡çš„æœ€åä¸€ä¸ªåŠ¨ä½œ(Scheduleçš„è¯åªè¦åœ¨çª—å£æ—¶é—´å†…å…¨éƒ¨éƒ½è¦æ¢å¤æ‰§è¡Œ)ï¼ŒåŒæ—¶æœ¬æ¬¡æ‰§è¡Œæ—¶è¦å’Œ Schedule çš„æ‰§è¡Œåºåˆ—é…åˆï¼ˆæŒ‰æœŸæœ›è§¦å‘æ—¶é—´æ’åºï¼‰ã€‚

è¢«Special days tableè¦†ç›–

å±æ€§ï¼š

- calendar_name_active æ ‡è¯†ç¬¦ï¼Œè¡¨ç¤ºå½“å‰æ—¥å†è¡¨æ–¹æ¡ˆçš„åç§°ï¼Œ*_active* åç¼€è¡¨ç¤ºå½“å‰å¯ç”¨çš„æ–¹æ¡ˆã€‚
- season_profile_active å­£èŠ‚æ–¹æ¡ˆï¼ŒåŒ…å«å­£èŠ‚å¼€å§‹æ—¶é—´å’Œå¯¹åº”çš„ week æ–¹æ¡ˆï¼ˆweek_name é€‰æ‹© week_profile_table æ•°ç»„ä¸­çš„æ¡ç›®ï¼‰
- week_profile_table_active å‘¨æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ä¸€å‘¨ä¸­æ¯å¤©(æ˜ŸæœŸä¸€åˆ°æ˜ŸæœŸä¸ƒ)çš„æ–¹æ¡ˆï¼ˆday_id é€‰æ‹© day_profile_table æ•°ç»„ä¸­çš„æ¡ç›®ï¼‰
- day_profile_table_active æ—¥æ–¹æ¡ˆï¼ŒåŒ…å«ä¸€å¤©å†…æ‰€æœ‰è„šæœ¬çš„æ‰§è¡Œæ—¶é—´ã€Script table å¯¹è±¡å†…è„šæœ¬çš„å¼•ç”¨
- calendar_name_passive å¤‡ç”¨æ–¹æ¡ˆï¼Œ*_passive* åç¼€è¡¨ç¤ºå¤‡ç”¨çš„æ–¹æ¡ˆã€‚
- season_profile_passive å¤‡ç”¨æ–¹æ¡ˆ
- week_profile_table_passive å¤‡ç”¨æ–¹æ¡ˆ
- day_profile_table_passive å¤‡ç”¨æ–¹æ¡ˆ
- activate_passive_calendar_time è°ƒç”¨activate_passive_calendarçš„æ—¶é—´

TODO:ä¸€ä¸ªå­£èŠ‚åªèƒ½å¯ç”¨ä¸€ä¸ªå‘¨è¡¨ï¼Ÿæ˜¯ä¸æ˜¯æ„å‘³ç€ä¸€ä¸ªå­£èŠ‚å†…ï¼Œæ¯å‘¨çš„åŠ¨ä½œéƒ½æ˜¯ç›¸åŒçš„ã€‚

æ–¹æ³•ï¼š

- activate_passive_calendar (data) `æ¿€æ´»å¤‡ç”¨æ–¹æ¡ˆ`ï¼Œå°†passiveå±æ€§å¤åˆ¶åˆ°activeä¸­

### s4.5.6 Register monitor (class_id = 21, version = 0)

è¿™ä¸ªICå…è®¸å¯¹ â€œDataâ€ , â€œRegisterâ€, â€œExtended registerâ€ or â€œDemand registerâ€å¯¹è±¡çš„å€¼è¿›è¡Œå»ºæ¨¡`ç›‘æ§`ã€‚

å®ƒå…è®¸æŒ‡å®šé˜ˆå€¼ã€è¢«ç›‘æµ‹çš„å€¼å’Œä¸€ç»„è„šæœ¬ï¼Œå½“ç›‘æµ‹çš„å€¼è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œè¿™äº›è„šæœ¬å°†è¢«æ‰§è¡Œã€‚

ä¾èµ–äºåŒä¸€é€»è¾‘è®¾å¤‡å†…çš„ Script table å¯¹è±¡

å±æ€§ï¼š

- thresholds æä¾›å°†å¼•ç”¨å¯„å­˜å™¨çš„å±æ€§ä¸ä¹‹æ¯”è¾ƒçš„`é˜ˆå€¼`ã€‚
- monitored_value å®šä¹‰ç›‘è§†å¯¹è±¡çš„å“ªä¸ª`å±æ€§`ã€‚åªå…è®¸å…·æœ‰`ç®€å•æ•°æ®ç±»å‹`çš„å€¼
- actions å®šä¹‰è¢«å¼•ç”¨å¯¹è±¡çš„ç›‘è§†å±æ€§`è¶…è¿‡`æˆ–`ä½äº`ç›¸åº”`é˜ˆå€¼`æ—¶è¦æ‰§è¡Œçš„`è„šæœ¬`ã€‚å±æ€§æ“ä½œå…·æœ‰ä¸ thresholds å±æ€§å®Œå…¨`ç›¸åŒ`çš„`å…ƒç´ æ•°é‡`ã€‚action_itemsçš„é¡ºåºä¸é˜ˆå€¼çš„`é¡ºåºå¯¹åº”`

### s4.5.7 Single action schedule (class_id = 22, version = 0)

æ‰§è¡Œå‘¨æœŸæ€§çš„å•ä¸ªå®šæ—¶ä»»åŠ¡ã€‚å’Œscheduleçš„åŒºåˆ«æ˜¯ä¸€ä¸ªå¯¹è±¡ä»…å¯¹åº”ä¸€ä¸ªè„šæœ¬ï¼Œå¯èƒ½çš„ç”¨é€”åº”è¯¥æ˜¯ä¸´æ—¶æ·»åŠ ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå°±ä¸ç”¨å»ä¿®æ”¹ schedule å¯¹è±¡äº†ã€‚

- executed_script Script tableå¯¹è±¡çš„å¼•ç”¨
- type execution_time çš„ç±»å‹ã€‚å®šä¹‰æ—¶é—´æ˜¯å¦ç›¸åŒï¼Œæ˜¯å¦å…è®¸é€šé…ç¬¦
- execution_time è„šæœ¬æ‰§è¡Œæ—¥æœŸå’Œæ—¶é—´

### s4.5.8 Disconnect control (class_id = 70, version = 1)

æ‹‰åˆé—¸æ§åˆ¶ï¼Œç®¡ç†ç”µè¡¨çš„å†…éƒ¨æˆ–å¤–éƒ¨`æ–­å¼€è£…ç½®`ï¼ˆä¾‹å¦‚ç»§ç”µå™¨ã€ç‡ƒæ°”é˜€é—¨ï¼‰ï¼Œä»¥ä¾¿éƒ¨åˆ†æˆ–å…¨éƒ¨åœ°è¿æ¥æˆ–æ–­å¼€ç”¨æˆ·çš„ç”µæºã€‚

ä¸‰ç§æ§åˆ¶æ–¹å¼ï¼š

  1. `è¿œç¨‹`Remotelyï¼Œé€šè¿‡é€šä¿¡ç«¯å£
  2. `æ‰‹åŠ¨`Manuallyï¼Œå¦‚æŒ‰æŒ‰é’®
  3. `æœ¬åœ°`Locallyï¼Œç”µè¡¨å†…éƒ¨åŠŸèƒ½è§¦å‘ï¼Œå¦‚limiterå¯¹è±¡

å±æ€§ï¼š

- output_state è®¾å¤‡supply(ä¾›ç»™å¼€å…³)å®é™…çš„ç‰©ç†è¿æ¥çŠ¶æ€ï¼šConnected å’Œ Disconnected
- control_state å†…éƒ¨æ§åˆ¶è¿æ¥çŠ¶æ€
  - (0) Disconnected
  - (1) Connected
  - (2) Ready_for_reconnection

- control_mode æ§åˆ¶æ¨¡å¼ï¼Œæ¯ä¸€æ¡å¯¹åº”3ç§æ§åˆ¶æ–¹å¼çš„æ§åˆ¶æƒé™

æ–¹æ³•ï¼š

- remote_disconnect (data) `è¿œç¨‹æ–­å¼€è¿æ¥`ï¼Œéœ€è¦æœ‰æƒé™
- remote_reconnect (data) `è¿œç¨‹æ¢å¤è¿æ¥`ï¼Œéœ€è¦æœ‰æƒé™

### s4.5.9 Limiter (class_id = 71, version = 0)

é™åˆ¶å™¨ï¼Œå½“â€œDataâ€, â€œRegisterâ€, â€œExtended Registerâ€,â€œDemand Registerâ€å¯¹è±¡è¶…è¿‡é˜ˆå€¼ä¸€å®šæ—¶é—´æ—¶æ‰§è¡ŒåŠ¨ä½œ

TODO:å’Œ4.5.6 Register monitorçš„åŒºåˆ«ï¼Œåº”è¯¥æ˜¯æ¯”åè€…æ›´åŠ è¯¦ç»†ï¼Œè¿™ä¸ªæ˜¯è¶…è¿‡ä¸€å®šæ—¶é—´åŠ ä¸Šæ›´å¤šç§é˜ˆå€¼ã€‚

é˜ˆå€¼åŒ…æ‹¬`æ­£å¸¸é˜ˆå€¼`å’Œ`ç´§æ€¥é˜ˆå€¼`ã€‚`ç´§æ€¥é˜ˆå€¼`é€šè¿‡emergency profile id, emergency activation time, and emergency durationå®šä¹‰çš„`emergency_profile`æ¿€æ´»ã€‚emergency profile idå…ƒç´ ä¸emergency profile group idåŒ¹é…:è¿™ç§æœºåˆ¶åªå…è®¸é’ˆå¯¹ç‰¹å®šçš„emergency groupæ¿€æ´»ç´§æ€¥é˜ˆå€¼ã€‚

- monitored_value å®šä¹‰`è¦ç›‘æ§`çš„å¯¹è±¡çš„`å±æ€§`ã€‚åªå…è®¸å…·æœ‰`ç®€å•æ•°æ®ç±»å‹`çš„å±æ€§ã€‚
- threshold_active å½“å‰ä½¿ç”¨çš„æ´»åŠ¨é˜ˆå€¼ï¼ˆå¯èƒ½æ˜¯æ­£å¸¸é˜ˆå€¼æˆ–ç´§æ€¥é˜ˆå€¼ï¼‰
- threshold_normal æ­£å¸¸é˜ˆå€¼ï¼Œå’Œè¢«ç›‘æ§çš„å±æ€§çš„ç±»å‹ç›¸åŒ
- threshold_emergency ç´§æ€¥é˜ˆå€¼
- min_over_threshold_duration è¶…è¿‡é˜ˆå€¼æœ€å°æŒç»­æ—¶é—´ï¼Œç§’
- min_under_threshold_duration ä½äºé˜ˆå€¼çš„æœ€å°æŒç»­æ—¶é—´
- emergency_profile ç´§æ€¥é…ç½®,ç”¨äºç´§æ€¥é˜ˆå€¼æ¿€æ´»ï¼Œå½“emergency_profile_idå’Œemergency_profile_group_id_listä¸­çš„åŒ¹é…ï¼Œä¸”å½“å‰æ—¶é—´åœ¨ä»emergency_activation_timeå¼€å§‹emergency_durationèŒƒå›´å†…æ—¶æ¿€æ´»
- emergency_profile_group_id_list emergency_profile_idåˆ—è¡¨
- emergency_profile_active emergency_profileæ¿€æ´»çŠ¶æ€
- actions è¶…è¿‡æˆ–ä½äºé˜ˆå€¼è¶…è¿‡æœ€å°æŒç»­æ—¶é—´æ—¶çš„`åŠ¨ä½œ(script)`

### s4.5.10 Parameter monitor (class_id = 65, version = 1)

æœ¬ IC ç”¨äºç›‘æ§å‚æ•°ä¿®æ”¹ï¼ˆæŸäº›COSEMå¯¹è±¡çš„å±æ€§ç”¨äºè¡¨ç¤ºé…ç½®å‚æ•°ï¼‰

æ¯ä¸ªå¯ä»¥è®¿é—®æœåŠ¡å™¨çš„å®¢æˆ·ç«¯éƒ½å¿…é¡»çŸ¥é“å½“å‰çš„å‚æ•°è®¾ç½®ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ­£ç¡®åœ°ä¸æœåŠ¡å™¨äº¤æ¢æ•°æ®ã€‚å‚æ•°å¯ä»¥åˆ†ç»„ï¼Œæ¯ä¸ªç»„å¯ä»¥æœ‰ä¸€ä¸ªåç§°ã€‚

å°½ç®¡æœ€åˆçš„å‚æ•°å¯èƒ½æ˜¯å·²çŸ¥çš„ï¼Œä½†åœ¨ç”µè¡¨çš„ç”Ÿå‘½å‘¨æœŸå†…å¯èƒ½ä¼š`å‘ç”Ÿå˜åŒ–`ï¼Œä¾‹å¦‚å®ƒå¯èƒ½`è¢«å¦ä¸€ä¸ªå®¢æˆ·ç«¯`ï¼ˆå¦‚ç°åœºæœåŠ¡è®¾å¤‡ï¼‰æ”¹å˜ã€‚

å½“å‰çš„é…ç½®å¯èƒ½æ€»æ˜¯é€šè¿‡åœ¨äº¤æ¢å¼€å§‹æ—¶`è¯»å–æ‰€æœ‰éœ€è¦çš„é…ç½®å‚æ•°`æ¥æ£€ç´¢ï¼Œè¿™å¹¶`ä¸é«˜æ•ˆ`ã€‚ä¹Ÿå¯ä»¥é€šè¿‡æ¨é€æ“ä½œï¼Œä½†è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªå¥½çš„æ–¹å¼ã€‚

éœ€è¦ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå…è®¸å®¢æˆ·éªŒè¯æœåŠ¡å™¨çš„é…ç½®æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œæˆ–`æ£€æµ‹æ˜¯å¦å‘ç”Ÿäº†ä»»ä½•å˜åŒ–`: å®¢æˆ·ç«¯é…ç½®æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥æ£€ç´¢æœ¬ç±»è¿™äº›å±æ€§å¹¶ä¸å…¶ä»–å®¢æˆ·ç«¯å…±äº«ã€‚å½“å®¢æˆ·ç«¯å¼€å§‹ä¸æœåŠ¡å™¨è¿›è¡Œæ•°æ®äº¤æ¢æ—¶ï¼Œå®ƒå¯ä»¥è¯»å– parameter_value_digest å±æ€§ï¼Œå¹¶å°†å…¶ä¸è‡ªå·±å­˜å‚¨çš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœä¸¤è€…åŒ¹é…ï¼Œåˆ™è¯´æ˜é…ç½®ç¬¦åˆé¢„æœŸï¼›å¦‚æœä¸åŒ¹é…ï¼Œå®¢æˆ·ç«¯å¯ä»¥è¯»å– parameter_values å±æ€§ï¼Œä»¥ç¡®å®šå“ªä¸ªå±æ€§å‘ç”Ÿäº†å˜åŒ–ã€‚è¿™äº›å±æ€§(parameter_values)ä¹Ÿå¯ä»¥æ•è·åˆ° Profile generic å¯¹è±¡ç¼“å†²åŒºå±æ€§ä¸­ï¼Œä»¥ç¡®ä¿æ•è·æ•°æ®çš„æœ‰æ•ˆæ€§ã€‚ä½¿ç”¨**ç©ºæ•°æ®ç¼–ç **å¯æœ€å¤§é™åº¦åœ°å‡å°‘ç”±æ­¤äº§ç”Ÿçš„å¼€é”€

å±æ€§ï¼š

- changed_parameter ä¿å­˜æœ€è¿‘æ›´æ–°çš„å‚æ•°åŠå…¶å€¼ï¼ˆä¸€ä¸ªå±æ€§å’Œä¸€ä¸ªå€¼ï¼‰
- capture_time æ•è·æ—¶é—´ï¼Œè®°å½•ä½•æ—¶æ•è·
- parameter_list æœ¬å¯¹è±¡ç®¡ç†çš„å‚æ•°åˆ—è¡¨
- parameter_list_name å‚æ•°åˆ—è¡¨å
- hash_algorithm_id æ‘˜è¦ç®—æ³•
- parameter_value_digest å‚æ•°`å€¼`æ‘˜è¦ï¼ˆæ•´ä¸ªparameter_listå†…å±æ€§çš„å€¼éœ€è¦å…ˆ`è½¬octet-string`ï¼ˆå¦‚æœä¸æ˜¯octet-stringï¼‰ï¼Œä½¿ç”¨ Green Book Data conversionä¸€èŠ‚æ–¹æ³•ï¼‰ã€‚å¯èƒ½çš„æ–¹å¼ï¼šæœ¬hashé€šè¿‡parameter_valueså‚æ•°è®¡ç®—
- parameter_values parameter_listå†…å±æ€§çš„å€¼,ä¸€ä¸ªç»“æ„ä½“ï¼ŒåŒ…å«A-XDRç¼–ç çš„æ¯ä¸ªå±æ€§å€¼

æ–¹æ³•ï¼š

- add_parameter (data) å‘parameter_listæ·»åŠ ä¸€ä¸ª
- delete_parameter (data) ä»parameter_liståˆ é™¤ä¸€ä¸ª

### s4.5.11 Sensor manager (class_id = 67, version = 0)

ä¼ æ„Ÿå™¨å’Œæµ‹é‡å€¼ç›‘æ§ï¼ˆé™¤äº†ç”µè¡¨ä¹‹å¤–çš„å…¶ä»–è®¡é‡è®¾å¤‡ç”¨å¾—æ¯”è¾ƒå¤šï¼‰

- ä¼ æ„Ÿå™¨è£…ç½®çš„è¯†åˆ«
- ä¼ æ„Ÿå™¨çš„è¿æ¥å’Œå¯†å°çŠ¶æ€
- ä¼ æ„Ÿå™¨çš„é…ç½®
- ç›‘æµ‹ä¼ æ„Ÿå™¨çš„è¿è¡Œæƒ…å†µ
- å¯¹å¤„ç†åçš„ç»“æœçš„ç›‘æ§

æœ¬ IC çš„å®ä¾‹ç®¡ç†ä¸ä¼ æ„Ÿå™¨ç›¸å…³çš„å¤æ‚ä¿¡æ¯ã€‚å®ƒä»¬è¿˜å¯ä»¥ç›‘æ§åŸå§‹æ•°æ®å’Œå¤„ç†åçš„å€¼ï¼Œè¿™äº›å€¼æ˜¯æ ¹æ®ç‰¹å®šåº”ç”¨çš„è¦æ±‚ä½¿ç”¨é€‚å½“ç®—æ³•å¤„ç†åŸå§‹æ•°æ®åå¾—å‡ºçš„ã€‚è¯¥é›†æˆç”µè·¯å…·æœ‰ä»¥ä¸‹åŠŸèƒ½:

- ä¼ æ„Ÿå™¨çš„é“­ç‰Œæ•°æ®ï¼ˆä¼ æ„Ÿå™¨ä¸Šé“­ç‰Œæ‰€åˆ—å‡ºçš„æ•°æ®å’Œä¿¡æ¯ã€‚è¿™äº›é€šå¸¸åŒ…æ‹¬åˆ¶é€ å•†ã€å‹å·ã€åºåˆ—å·ã€å·¥ä½œèŒƒå›´ã€é¢å®šç”µå‹ã€ç”µæµç­‰æŠ€æœ¯è§„æ ¼å’Œè¯†åˆ«ä¿¡æ¯ï¼‰å’Œç°åœºä¿¡æ¯ï¼ˆè¿™æ˜¯æŒ‡ä¼ æ„Ÿå™¨æ‰€åœ¨ä½ç½®çš„ç›¸å…³ä¿¡æ¯ã€‚è¿™å¯èƒ½åŒ…æ‹¬åœ°ç†ä½ç½®ã€å®‰è£…ç¯å¢ƒã€ä½¿ç”¨æ¡ä»¶ã€è®¾å¤‡é…ç½®ç­‰ã€‚ï¼‰ï¼ˆå±æ€§ 2 è‡³ 6ï¼‰ï¼›
- å¯¹äºåŸå§‹å€¼(ç›´æ¥é‡‡æ ·å€¼)çš„"Extened register"ä¸­çš„åŠŸèƒ½ï¼ˆå±æ€§ 7 è‡³ 10ï¼‰ï¼›
- å¯¹äºåŸå§‹å€¼(ç›´æ¥é‡‡æ ·å€¼)çš„"Register monitor"ä¸­çš„åŠŸèƒ½ï¼ˆå±æ€§ 11 è‡³ 12ï¼‰ï¼›
  > æ³¨ 1 å¹¶éæ¯ä¸ªåŸå§‹æ•°æ®ï¼ˆå¦‚å‹åŠ›ä¼ æ„Ÿå™¨çš„ç”µå‹è¾“å‡ºï¼‰éƒ½æœ‰è‡ªå·±çš„ OBIS ä»£ç /å¯¹è±¡ã€‚è¿™å°±æ˜¯åœ¨ä¼ æ„Ÿå™¨ç®¡ç†å™¨ç±»ä¸­åŒ…å«åŸå§‹æ•°æ®çš„åŸå› ã€‚
- å¯¹äºå¤„ç†å€¼(åŸå§‹å€¼å¤„ç†åçš„å€¼)çš„"Register monitor"ä¸­çš„åŠŸèƒ½ï¼ˆå±æ€§ 13 è‡³ 15ï¼‰

å±æ€§ï¼š

- serial_number åºåˆ—å·ï¼Œæ ‡è¯†ä¼ æ„Ÿå™¨è®¾å¤‡
- metrological_identification æè¿°ä¼ æ„Ÿå™¨çš„è®¡é‡ç›¸å…³ä¿¡æ¯ï¼Œå¦‚è®¡é‡æ ‡è¯†ç¬¦ã€æ ¡å‡†æ—¥æœŸã€‚
- output_type è¾“å‡ºç±»å‹
- adjustment_method è°ƒæ•´æ–¹æ³•
- sealing_method å¯†å°ï¼ˆä¿æŠ¤ï¼‰æ–¹å¼
  - ç‰©ç†æ–¹å¼ï¼ˆé“…å°ã€å¯†å°è´´çº¸ç­‰ï¼‰
  - ç”µæ°”æ–¹å¼ï¼ˆç”µå­æ£€æµ‹è£…ç½®ï¼Œæ¯”å¦‚å¼€ç›–æ£€æµ‹ç”¨çš„æŒ‰é’®ï¼‰
  - è½¯ä»¶æ–¹å¼ï¼ˆå¯†ç ï¼‰
- raw_value åŸå§‹è®°å½•å€¼
- scaler_unit åŸå§‹è®°å½•å€¼çš„å•ä½
- status çŠ¶æ€ï¼ˆå¤±è´¥/å¯ç”¨/ç¦ç”¨ï¼‰
- capture_time raw_valueæ•è·æ—¶é—´
- raw_value_thresholds raw_valueé˜ˆå€¼
- raw_value_actions è¶…è¿‡é˜ˆå€¼æ‰§è¡Œçš„è„šæœ¬ï¼Œå‚è€ƒRegister monitorç±»
- processed_value raw_valueå¤„ç†åçš„å€¼
- processed_value_thresholds processed_valueé˜ˆå€¼
- processed_value_actions è¶…è¿‡é˜ˆå€¼æ‰§è¡Œçš„è„šæœ¬(å¦‚å‘Šè­¦ä½ç½®ä½)

æ–¹æ³•ï¼š

- reset (data) é‡ç½®raw_value

### s4.5.12 Arbitrator (class_id = 68, version = 0)

ä»²è£è€…ï¼Œå…è®¸æ ¹æ®ç”±`æƒé™`å’Œ`æƒé‡`ç»„æˆçš„é¢„å…ˆé…ç½®çš„è§„åˆ™ï¼Œåœ¨`å¤šä¸ªå‚ä¸è€…`å¯èƒ½è¯·æ±‚å¯èƒ½`ç›¸äº’å†²çª`çš„æ“ä½œæ¥æ§åˆ¶`åŒä¸€èµ„æº`æ—¶ï¼Œæ‰§è¡Œç‰¹å®š`æ“ä½œ`ã€‚

- `é…ç½®`å¯èƒ½è¢«è¯·æ±‚çš„ã€æ½œåœ¨å†²çªçš„`åŠ¨ä½œ`;
- `é…ç½®`æ¯ä¸ªå‚ä¸è€…è¯·æ±‚å¯èƒ½æ“ä½œçš„`æƒé™`;
- ä¸ºæ¯ä¸ªå¯èƒ½çš„è¯·æ±‚`é…ç½®`æ¯ä¸ªå‚ä¸è€…çš„`æƒé‡`ã€‚

`èµ„æº`çš„`ä¾‹å­`æ˜¯`ä¾›åº”(supply)æ§åˆ¶å¼€å…³`æˆ–ä»ªè¡¨çš„`æ°”ä½“é˜€é—¨`ã€‚å¯èƒ½çš„`åŠ¨ä½œ`åŒ…æ‹¬`æ–­å¼€ç”µæº`ã€`ä½¿èƒ½é‡æ–°è¿æ¥`ã€é‡æ–°è¿æ¥ç”µæºã€é˜²æ­¢æ–­å¼€è¿æ¥ã€é˜²æ­¢é‡æ–°è¿æ¥ã€‚

æ¯ä¸ªéœ€è¦å¤„ç†**ç«äº‰**æ“ä½œè¯·æ±‚çš„èµ„æºéƒ½åº”è¯¥æœ‰ä¸€ä¸ª "Arbitrator" å¯¹è±¡å®ä¾‹ã€‚

TODO: actoråˆ°åº•æ˜¯ä»€ä¹ˆï¼Œæ˜¯å®¢æˆ·ç«¯å—ï¼Ÿ

å±æ€§ï¼š

- actions åŠ¨ä½œï¼Œæ˜¯ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªå…ƒç´ æ˜¯å¯¹`script table`å¯¹è±¡çš„æŸä¸€ä¸ªæ¡çš„å¼•ç”¨
- permissions_table æ¯ä¸ªå‚ä¸è€…`æƒé™`ï¼Œæ•°ç»„æ¯ä¸ªå…ƒç´ å¯¹åº”æ¯ä¸ªç”¨æˆ·çš„æƒé™ï¼Œç”¨æˆ·çš„æƒé™æ˜¯ä¸ªä½ä¸²ï¼Œå…¶ä¸­çš„ä½ä¸²ä¸­æ¯ä¸€ä½å¯¹åº”æ¯ä¸ªåŠ¨ä½œæƒé™ï¼ˆä¸actionså¯¹åº”ï¼‰
- weightings_table æ¯ä¸ªå‚ä¸è€…`æƒé‡`ï¼Œå’Œpermissions_tableç»“æ„é¡ºåºä¸€æ ·ï¼Œä¸è¿‡æŠŠ`ä½ä¸²æ¢æˆäº†æ•°ç»„`ï¼Œå…ƒç´ æ˜¯long-unsignedï¼ˆæœ€å¥½ä½¿ç”¨2çš„å¹‚ä½œä¸ºæƒé‡å€¼ï¼Œè€Œä¸”è¦ä¿è¯å¯¹äºåŒä¸€ä¸ªactionæ²¡æœ‰å¤šä¸ªç”¨æˆ·çš„æƒé‡æ˜¯ç›¸åŒçš„ï¼Œä¸ç„¶ä¸¤ä¸ªç”¨æˆ·åŒæ—¶è§¦å‘æ‰§è¡Œæ—¶å°±ä¸çŸ¥é“è¯¥è°æ‰§è¡Œäº†(æ­¤æ—¶æŒ‰è§„å®šå¤§å®¶éƒ½ä¸æ‰§è¡Œ)ï¼‰
- most_recent_requests_table è®°å½•æ¯ä¸ªç”¨æˆ·çš„æœ€è¿‘è¯·æ±‚ï¼Œä¸permissions_tableç»“æ„ç›¸åŒï¼Œä½ä¸²ä¸­å·²æ‰§è¡Œçš„ç½®ä½ï¼Œä¸ä¸€å®šåªæœ‰ä¸€ä¸ª(åº”è¯¥æ˜¯ä¸€æ¬¡request_actionæ—¶åŒæ—¶è§¦å‘ä¸¤ä¸ªä»¥ä¸ŠåŠ¨ä½œ)ã€‚ä½çš„æ¸…é™¤åœ¨ä¸‹ä¸€æ¬¡çš„request_actionå‘ç”Ÿ
- last_outcome æœ€è¿‘ä¸€æ¬¡è¯·æ±‚ç»“æœï¼Œæ ‡è¯†actionsä¸­çš„å…ƒç´ çš„åºå·ï¼Œåªé’ˆå¯¹actionsï¼Œä¸é’ˆå¯¹ç”¨æˆ·ã€‚è¿™æ„å‘³ç€ä¸€æ¬¡ request_action åªèƒ½æ‰§è¡Œä¸€ä¸ª action

æ–¹æ³•ï¼š

- request_action (data) `å°è£…åŠ¨ä½œæ‰§è¡Œè¯·æ±‚`ï¼Œrequest_actorè¡¨ç¤ºè¯·æ±‚ç”¨æˆ·(ä¸Šè¿°æ•°ç»„çš„åºå·ï¼Œ1è¡¨ç¤ºç¬¬ä¸€ä¸ªç”¨æˆ·)ï¼Œrequest_action_listè¡¨ç¤ºè¯·æ±‚åŠ¨ä½œåˆ—è¡¨ï¼Œä¸€æ¬¡å¯è¯·æ±‚å¤šä¸ªï¼Œä½†æœ€ç»ˆä¸€æ¬¡è¯·æ±‚åªèƒ½æœ‰ä¸€ä¸ª action(æœ€é«˜æƒé‡) æ‰§è¡Œã€‚

  TODO: ä¸ºä»€ä¹ˆå¯ä»¥ä¸€æ¬¡è¯·æ±‚å¤šä¸ªæ“ä½œ

- reset (data) é‡ç½®ä½ï¼ˆæƒé™ä½ï¼Œæƒé‡å…ƒç´ ï¼Œæœ€è¿‘æ‰§è¡Œä½ï¼Œæœ€è¿‘è¯·æ±‚ç»“æœï¼‰

  å½“æƒé™ä½éƒ½æ˜¯0æ—¶ï¼Œrequest_actionè°ƒç”¨æ€»æ˜¯ä¸ä¼šæˆåŠŸï¼Œå› ä¸ºéƒ½æ²¡æƒé™

å½“`request_action`æ–¹æ³•è¢«`actor`è°ƒç”¨æ—¶ï¼Œ`AP`æ‰§è¡Œä»¥ä¸‹æ´»åŠ¨:

  1. å®ƒæ£€æŸ¥ç»™å®šactorçš„`permissions_table`å±æ€§æ¡ç›®ï¼Œä»¥ç¡®å®šè¯·æ±‚çš„åŠ¨ä½œ`æ˜¯å¦å…è®¸`;
  2. å®ƒ`æ›´æ–°most_recent_requests_table`å±æ€§ï¼Œé€šè¿‡`è®¾ç½®æˆ–æ¸…é™¤`è¯¥actorçš„æ¯ä¸ªåŠ¨ä½œçš„ä½ä¸²ä¸­è¢«å…è®¸çš„`ä½`(ä½è®¾ç½®);æˆ–è€…æ²¡æœ‰è¯·æ±‚/ä¸å…è®¸(ä½è¢«æ¸…é™¤);*ç›¸å½“äºrequest_actionè¯·æ±‚å‚æ•°å’Œpermissions_tableçš„äº¤é›†ï¼Œæœ‰è¯·æ±‚ä¸”å…è®¸æ‰ç½®ä½*
  3. å®ƒä¸ºmost_recent_requests_tableåº”ç”¨`weightings_table`:å¯¹äºmost_recent_requests_tableä¸­è®¾ç½®çš„æ¯ä¸ªä½ï¼Œæ¯ä¸ªactorçš„ç›¸åº”æƒé‡è¢«åº”ç”¨;
  4. å¯¹äºæ¯ä¸ª actionï¼Œå„ä¸ªç”¨æˆ·çš„æƒé‡ç›¸åŠ ã€‚
  5. å¦‚æœæŸä¸ªåŠ¨ä½œæ‹¥æœ‰ä¸€ä¸ª`å”¯ä¸€`çš„`æœ€é«˜æƒé‡å€¼`ï¼Œè¿™ä¸ªå€¼ä¼šè¢«å†™å…¥`last_outcome`å±æ€§å¹¶æ‰§è¡Œç›¸åº”çš„è„šæœ¬ã€‚å¦‚æœæ²¡æœ‰æœ€é«˜çš„`å”¯ä¸€`æƒé‡ï¼Œé‚£ä¹ˆ`ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿ`ï¼ˆæœ€é«˜æƒé‡ä¸å”¯ä¸€ï¼Œå°±å…¨éƒ¨ä¸æ‰§è¡Œï¼‰ã€‚

## s4.6 æ”¯ä»˜è®¡é‡ç›¸å…³æ¥å£ç±»Payment metering related interface classes

### s4.6.2 Account (class_id = 111, version = 0)

ç”¨äºè®¡è´¹ï¼Œæ¯ä¸ªAccountå¯ä»¥å…³è”æ•°ä¸ªâ€œCreditâ€,â€œChargeâ€ and the â€œToken gatewayâ€å¯¹è±¡

æ¯”å¦‚å…¥å£æ¶ˆè€—ç”µç½‘çš„ç”µç”¨ä¸€ä¸ªè´¦æˆ·Accountï¼Œå®¶é‡Œæœ‰å‘ç”µå‡ºå£ç»™ç”µç½‘æ˜¯ç¬¬äºŒä¸ªè´¦æˆ·Accountï¼Œå•ç‹¬è®¡è´¹

`Credit`: `ä¿¡ç”¨é¢åº¦`ï¼Œæ¯”å¦‚ä¸€ä¸ªå¯¹è±¡ç”¨æ¥åštokené¢åº¦ï¼Œä¸€ä¸ªç”¨äºç´§æ€¥é¢åº¦

`Charge`ï¼š`è´¹ç”¨ç»Ÿè®¡`ï¼Œæ¯”å¦‚ä¸€ä¸ªç”¨äºèƒ½æºä½¿ç”¨ï¼Œä¸€ä¸ªç”¨äºå›ºå®šæ”¶è´¹ï¼ˆæœˆè´¹ï¼‰ï¼Œä¸€ä¸ªç”¨äºå®‰è£…è´¹ç”¨ã€‚

ç»Ÿè®¡æ–¹å¼ï¼š

1. åŸºäºèƒ½é‡æ¶ˆè€—é‡å’Œè´¹ç‡çš„
2. åŸºäºæ—¶é—´çš„ï¼Œå¦‚æœˆå›ºå®šè´¹ç”¨
3. æ‰‹ç»­è´¹ï¼Œæ¯æ¬¡å……å€¼æ—¶æ”¶å–

å±æ€§ï¼š

- account_mode_and_status `ä»˜è´¹æ¨¡å¼`ï¼ˆ`åä»˜è´¹`creditå’Œ`é¢„ä»˜è´¹`prepaymentï¼‰å’Œè´¦æˆ·çŠ¶æ€ï¼ˆæœªæ¿€æ´»ã€å·²æ¿€æ´»ã€å·²å…³é—­ï¼‰ï¼Œåªæœ‰è´¦æˆ·çŠ¶æ€ä¸ºå·²æ¿€æ´»æ—¶ï¼Œå…³è”çš„ credit å’Œ charge å¯¹è±¡æ‰ä¼šè¿è¡Œã€‚
- current_credit_in_use æ­£åœ¨ä½¿ç”¨ï¼ˆ`In use`ï¼‰çš„`creditå¯¹è±¡`çš„`å¼•ç”¨`
- current_credit_status æ­£åœ¨ä½¿ç”¨çš„`creditå¯¹è±¡çŠ¶æ€`
- available_credit `æ€»å¯ç”¨é¢åº¦`ï¼Œæœ¬å¯¹è±¡çš„ credit_reference_list å±æ€§å…³è”çš„ä¸”çŠ¶æ€ä¸ºå¯ç”¨çš„ Credit å¯¹è±¡(å±æ€§credit_statusä¸ºSelected/Invoked(2)æˆ–In use(3))ä¸­å±æ€§`current_credit_amount`(å¯ç”¨é¢åº¦)çš„æ€»å’Œï¼ˆåªè®¡ç®—`æ­£å€¼`ï¼‰
- amount_to_clear å’Œavailable_creditç±»ä¼¼ï¼Œæ˜¯è´Ÿå€¼çš„æ€»å’Œ

  - Creditå¯¹è±¡ä¸­çš„æ‰€æœ‰`current_credit_amountè´Ÿå€¼`ï¼ˆcredit_status = (4) Exhaustedä¸”credit_configuration bit 2(æ ‡å¿— credit æ˜¯å¦éœ€è¦å¿è¿˜)æœªç½®ä½ï¼‰
  - Creditå¯¹è±¡ä¸­çš„credit_configuration bit 2ç½®ä½ï¼ˆcredit éœ€è¦å¿è¿˜ï¼‰çš„`é¢åº¦çš„å·®å€¼`(preset_credit_amountå’Œcurrent_credit_amountçš„å·®å€¼)çš„è´Ÿå€¼ï¼ˆvalue * -1ï¼‰
  - `clearance_threshold`çš„è´Ÿå€¼ï¼ˆvalue * -1ï¼‰
- clearance_threshold amount_to_clearçš„é˜ˆå€¼
- aggregated_debt `åˆè®¡æ¬ æ¬¾`ï¼ŒChargeå¯¹è±¡çš„`total_amount_remaining`çš„ç®€å•åˆè®¡
- credit_reference_list creditå¯¹è±¡å…³è”åˆ—è¡¨
- charge_reference_list chargeå¯¹è±¡å…³è”åˆ—è¡¨
- credit_charge_configuration è¿™ä¸ªå±æ€§æ˜ å°„å‡ºå“ªäº›`Charge`å°†`ä»å“ªäº›Credits`ä¸­æ”¶å–ã€‚

  æ— æ¡ç›®è¡¨ç¤ºæ— é™åˆ¶

  Creditå¿…é¡»æ­é…ä¸€ä¸ªæˆ–å¤šä¸ªChargeé‡‡é›†ä½¿ç”¨ï¼Œå¦åˆ™ä¸ä¼šè¢«æ¶ˆè€—

  åŒ…å«creditå’Œchargeå¯¹è±¡çš„å¼•ç”¨

  collection_configuration è§„å®šäº†ç‰¹æ®Šæƒ…å†µä¸‹çš„è¡Œä¸ºï¼š

  - Bit 0 å…è®¸ç”µæºæ–­å¼€æ—¶é‡‡é›†
  - Bit 1 å…è®¸åœ¨è´Ÿè½½é™åˆ¶æœŸé—´é‡‡é›†
  - Bit 2 å…è®¸åœ¨å‹å¥½ä¿¡ç”¨æœŸå†…é‡‡é›†
- token_gateway_configuration æ­¤å±æ€§ç”¨äºé…ç½®å¦‚ä½•`åˆ†é…`æ¥è‡ªâ€œ`token_gateway`â€çš„æ–°çš„`å……å€¼token`ï¼Œä»¥ä¾¿å°†tokenæ•°é‡çš„`å¯é…ç½®ç™¾åˆ†æ¯”`åˆ†é…ç»™æ¯ä¸ªâ€œCreditâ€å¯¹è±¡ã€‚
- account_activation_time è°ƒç”¨activate_accountçš„æ—¶é—´
- account_closure_time è°ƒç”¨close_accountçš„æ—¶é—´
- currency æœ¬å¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•ä½¿ç”¨çš„å•ä½ï¼Œå¯ä»¥ä¸ºè´§å¸å•ä½ã€æ—¶é—´ã€è®¡é‡å•ä½ç­‰
- low_credit_threshold `ä½é¢åº¦é˜ˆå€¼`ï¼Œå¼•ç”¨creditçš„warning_thresholdå±æ€§ï¼Œå¯ä»¥ç”¨äºä½é¢åº¦æ—¶å‘Šè­¦
- next_credit_available_threshold `ä¸‹ä¸€ä¸ªä¼˜å…ˆçº§`(å¦‚æœæ˜¯ä¼˜å…ˆçº§é¡ºåº)creditå¯¹è±¡çš„available_credité˜ˆå€¼ TODOï¼šç­‰Creditçœ‹å®Œ
- max_provision æœ€å¤§è§„å®šï¼Œå½“Chargeä¸º(2) payment_event_based_collection TODOï¼šä»€ä¹ˆæ„æ€
- max_provision_period æœ€å¤§è§„å®šå‘¨æœŸ

æ–¹æ³•ï¼š

- activate_account (data) æ¿€æ´»è´¦æˆ·ï¼Œæœ¬å¯¹è±¡çš„account_mode_and_statuså’Œaccount_activation_timeä¿®æ”¹
- close_account (data) æœ¬å¯¹è±¡çš„account_mode_and_statuså’Œaccount_closure_timeä¿®æ”¹
- reset_account (data) account_statusä¸ºcloseçŠ¶æ€ä¸‹é‡ç½®æ‰€æœ‰å±æ€§,ä¸º1æˆ–2æ—¶ä¸æ“ä½œ

### s4.6.3 Credit (class_id = 112, version = 0)

å¯ç”¨é¢åº¦ï¼Œæ¿€æ´»æ—¶ç”¨äºæŠµæ‰£Charge

å±æ€§ï¼š

- current_credit_amount æœ¬å¯¹è±¡å½“å‰å¯ç”¨é¢åº¦
- credit_type ç±»å‹
  - (0) token_credit `é¢„ä»˜è´¹`æ–¹å¼`å……å€¼çš„ä½™é¢`ï¼Œä¸€èˆ¬æ˜¯`token`æ–¹å¼
  - (1) reserved_credit `ç‰¹å®šæƒ…å†µ`å¯ä½¿ç”¨çš„ä¿¡ç”¨é¢åº¦
  - (2) emergency_credit `ç´§æ€¥é¢åº¦`ï¼Œç´§æ€¥é¢åº¦ä½¿ç”¨ååœ¨ä¸‹æ¬¡é‡ç½®çš„æ—¶å€™æŠµæ‰£è¡¥å……
  - (3) time_based_credit `æŒ‰ç…§æ—¶é—´`äº§ç”Ÿçš„é¢åº¦
  - (4) consumption_based_credit `é¢„å®šä¹‰`ä¿¡ç”¨é¢åº¦
- priority `æ¿€æ´»ä¼˜å…ˆçº§`ï¼Œ1ä¸ºæœ€é«˜ï¼Œ255æœ€ä½ï¼Œ1-255ä¸å…è®¸é‡å¤ï¼Œ0è¡¨ç¤ºæ°¸ä¸æ¿€æ´»ï¼Œå¯é‡å¤ã€‚ä¼˜å…ˆçº§ä¸º0çš„ä¸ä¼šå‡ºç°åœ¨Accountå¯¹è±¡çš„credit_reference_listä¸­
- warning_threshold `è­¦å‘Šé˜ˆå€¼`ï¼Œç›‘æ§current_credit_amountï¼Œä¸Accountå¯¹è±¡ä¸­çš„low_credit_thesholdå…³è”
- limit `è€—å°½é˜ˆå€¼`ï¼Œå½“`current_credit_amount`å°äºé˜ˆå€¼æ—¶credit_statuså˜ä¸ºè€—å°½`Exhausted`
- credit_configuration é…ç½®æœ¬å¯¹è±¡è¡Œä¸º
  - Bit0 éœ€è¦`è§†è§‰æŒ‡ç¤º`(å¦‚æ¶²æ™¶å±)
  - Bit1 åœ¨credit_statusåˆ‡æ¢åˆ°Selected/Invokedä¹‹å‰`éœ€è¦ç¡®è®¤`ï¼ˆå¦‚æŒ‰é”®ï¼‰
  - Bit2 `éœ€è¦å¿è¿˜`çš„ä¿¡ç”¨é¢åº¦
  - Bit3 `å¯é‡ç½®`
  - Bit4 èƒ½å¤Ÿä»`token`æ¥æ”¶ä¿¡ç”¨é¢åº¦
- credit_status é¢„ä»˜è´¹åº”ç”¨ä½¿ç”¨ï¼ŒæŒ‡ç¤ºçŠ¶æ€
  - Enable: `å¯ç”¨`ï¼Œä½†è¿˜ä¸èƒ½ä½¿ç”¨ï¼Œä¼šåœ¨credit_reference_listä¸­
  - Selectable: `å¯é€‰æ‹©çš„`ï¼Œéœ€è¦å…¶ä»–`å‘½ä»¤`æ‰èƒ½`æ¿€æ´»`ï¼Œè¿˜ä¸èƒ½ä½¿ç”¨
  - Selected/Invokedï¼š`å·²é€‰æ‹©`ï¼Œ`å·²æ¿€æ´»`ï¼Œå¤„äºæ’é˜ŸçŠ¶æ€
  - In useï¼š`æ­£åœ¨ä½¿ç”¨ä¸­`
  - Exhaustedï¼šé¢åº¦å·²`è€—å°½`
  ![creditstate](/assets/img/2022-03-17-dlms-blue2/creditstate.jpg)
- preset_credit_amount `åˆå§‹é¢åº¦`

  ä¼š`ç´¯åŠ `åˆ°`current_credit_amount`å±æ€§çš„æƒ…å†µï¼š

  - credit_statusè½¬æ¢ä¸º(2)`Selected/Invoked`ï¼Œä¸”credit_configuration `bit 1`(åˆ‡æ¢éœ€ç¡®è®¤)ç½®ä½ï¼Œä¸”è¢«`ç¡®è®¤`
  - credit_statusä»ä¸ä¸º(4)`Exhausted`çŠ¶æ€è½¬æ¢ä¸º(3)`In use`ï¼Œä¸”credit_configuration `bit 1`ç½®ä½æœªç½®ä½
  - å½“è°ƒç”¨`invoke_credit`æ–¹æ³•æ—¶ï¼Œä¸”credit_configuration `bit 2`ç½®ä½
  - `period` é‡Œdate_timeå‘ç”Ÿæ—¶ï¼Œè¿™æ˜¯éšå¼çš„

  å¦‚æœ`ä¸éœ€è¦`åˆå§‹é¢åº¦å°±è®¾ç½®ä¸º0ï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥é€šè¿‡`tokenå……å€¼`æˆ–`è°ƒç”¨æ–¹æ³•`æ–¹å¼å¢åŠ `current_credit_amount`
  
  å¦‚æœcredit_typeæ˜¯`emergency_credit`ï¼š

  - è¯¥å€¼preset_credit_amountéœ€è¦è¢«ä½¿ç”¨
  - åªåœ¨ä»¥ä¸‹æƒ…å†µå¯ç”¨tokenå……å€¼

    - statusä¸º(3) `In use` or (4) `Exhausted`
    - ä¸”éƒ¨åˆ†æˆ–å…¨éƒ¨é¢åº¦`è¢«ä½¿ç”¨`
    - ä¸”credit_configuration `bit 2`(éœ€è¦å¿è¿˜)ç½®ä½
  
  > å½“`current_credit_amount`è¾¾åˆ°`limit`æ—¶ï¼Œ`credit_status`å±æ€§å°†å˜æˆ`ï¼ˆ4ï¼‰Exhausted`ã€‚å¦‚æœ`credit_configuration bit 2`ï¼ˆéœ€è¦å¿è¿˜ï¼‰è¢«`è®¾ç½®`ï¼Œé‚£ä¹ˆå®é™…å·²ç»ä½¿ç”¨äº†çš„ä¿¡ç”¨é¢åº¦æ˜¯`preset_credit_amount`å’Œ`current_credit_amount`ä¹‹é—´çš„`å·®å€¼`ï¼ˆæˆ‘ä»¬å¯ä»¥å‡è®¾ç”µè¡¨åˆå§‹preset_credit_amountæ˜¯10å—é’±,å¦‚æœæ­¤æ—¶current_credit_amountæ˜¯6å—é’±ï¼Œè¯´æ˜å·²ç»ä½¿ç”¨äº†4å—é’±ï¼Œéœ€è¦è¿˜4å—é’±ï¼Œæ„æ€åº”è¯¥å°±æ˜¯ä¿è¯é‡‘æ˜¯10å—é’±ï¼Œå¦‚æœpreset_credit_amountè¢«è®¾ç½®ä¸º0å—é’±ï¼Œè¯´æ˜æ²¡æœ‰ä¿è¯é‡‘ï¼‰ï¼Œé€šå¸¸æ˜¯é€šè¿‡å¢åŠ ä¸€ä¸ª`tokenå……å€¼`æˆ–é€šè¿‡`è°ƒç”¨ä¸€ä¸ªæ–¹æ³•`æ¥å¿è¿˜ã€‚åœ¨å¿è¿˜æ‰€æœ‰æ¬ æ¬¾åï¼Œ`current_credit_amount`å°†å˜`0`ï¼ˆä¸‹æ¬¡æ¿€æ´»å‰ä¼šåœ¨0çš„åŸºç¡€ä¸ŠåŠ ä¸Špreset_credit_amountï¼‰ï¼Œå½“amount_to_clear=0æ—¶`credit_status`å°†å˜`ï¼ˆ0ï¼‰Enabled`ï¼ˆè¿˜æ¸…äº†ï¼‰;å½“amount_to_clearå°äº0æ—¶ï¼Œ`credit_status`å°†å˜`ï¼ˆ4ï¼‰Exhausted`(æ²¡è¿˜æ¸…)
- credit_available_threshold ä¸â€œAccountâ€å¯¹è±¡`available_credit`ç›¸å…³è”çš„`é˜ˆå€¼`ã€‚

  å½“â€œAccountâ€å¯¹è±¡çš„`available_credit`ç¼©å‡åˆ°ä¸‹ä¸€ä¸ªä¼˜å…ˆçº§çš„Creditå¯¹è±¡çš„credit_available_thresholdæ—¶ï¼ˆæ­¤æ—¶è¯¥å¯¹è±¡è¿˜æ˜¯enableçŠ¶æ€ï¼Œä¸åœ¨credit_reference_listå±æ€§é‡Œï¼Œä¸è®¡å…¥available_creditï¼‰ï¼Œcredit_statusè®¾ç½®ä¸ºï¼š

  - Selectable (1) if the credit_configuration bit 1 (Requires confirmation) is set
  - Selected/Invoked (2) if the credit_configuration bit 1 (Requires confirmation) is cleared
- period åœ¨`credit_type = 3` (time_based_credit)æˆ–`credit_type = 4` (consumption_based_credit)æ—¶ï¼Œè¯¥å±æ€§`ä¿å­˜`å°†`current_credit_amount`è‡ªåŠ¨è®¾ç½®ä¸º`preset_credit_amount`çš„`æ—¶é—´`ã€‚æ¯”å¦‚åŒ…æœˆæ¨¡å¼æ¯æœˆ1å·è‡ªåŠ¨è·å¾—200å…ƒä½™é¢ã€‚

æ–¹æ³•ï¼š

- update_amount (data) è°ƒæ•´`current_credit_amount`å±æ€§çš„å€¼,`ä¸»è¦æ˜¯æ­£å€¼`(å……å€¼)ï¼Œè´Ÿå€¼ä¹Ÿå…è®¸
- set_amount_to_value (data) è®¾ç½®`current_credit_amount`å±æ€§çš„å€¼ï¼Œè¿”å›å€¼ä¸ºé…ç½®å‰çš„å€¼
- invoke_credit (data) å°†â€œCreditâ€å¯¹è±¡çš„credit_statusæ”¹ä¸º(2)Selected/Invokedæˆ–(1) Selectableï¼ˆå–å†³äºcredit_configuration bit 1ï¼‰

### s4.6.4 Charge (class_id = 113, version = 0)

- total_amount_paid æœ¬å¯¹è±¡`æ€»é‡‘é¢`ï¼Œä¸€èˆ¬ä¸é‡ç½®
- charge_type æ”¶è´¹ç±»å‹

  - (0) consumption_based_collection `æŒ‰é‡è®¡è´¹`
  - (1) time_based_collection `æ—¶é—´è®¡è´¹`
  - (2) payment_event_based_collection `æ”¯ä»˜äº‹ä»¶è®¡è´¹`ï¼ˆ`æ‰‹ç»­è´¹`ï¼Œæ¯”å¦‚ç”¨æ–°çš„tokenå……å€¼éœ€è¦æ‰‹ç»­è´¹ï¼‰
- priority ä¼˜å…ˆçº§å’ŒCreditç±»ç›¸åŒ,å¤§äº0çš„å¿…é¡»å‡ºç°åœ¨â€œAccountâ€å¯¹è±¡charge_reference_listä¸­
- unit_charge_active æ ¹æ®ç›¸å…³çš„â€œ`Account`â€å®ä¾‹çš„`è´§å¸`å±æ€§ï¼Œä»¥åŠç›¸å…³çš„ç”±`commodities _reference`ç»“æ„æ ‡è¯†çš„å¯¹è±¡çš„`scaler_unit`å±æ€§ï¼Œå®šä¹‰`æœ‰æ•ˆä»·æ ¼`ï¼Œå³æ¯`æ¶ˆè€—é‡`ã€æ¯`æ—¶é—´`æˆ–æ¯`æ”¶åˆ°çš„ä»˜æ¬¾`æ‰€æ”¶å–çš„é‡‘é¢ã€‚

  - charge_per_unit_scaling_type `æ¯å•ä½æ”¶è´¹ç¼©æ”¾`ï¼ŒåŒ…å«æ¶ˆè€—é‡å•ä½ç¼©æ”¾ï¼ˆ`10çš„æŒ‡æ•°`ï¼Œå¦‚10^3kWhä¸ºä¸€å•ä½ï¼‰ï¼Œ`å•ä½ä»·æ ¼ç¼©æ”¾`ï¼ˆå…³è”Accountä¸­çš„currency_scaleå±æ€§ä¸­currencyå…ƒç´ ï¼Œ10çš„æŒ‡æ•°ï¼‰
  - commodity_reference_type `æ¶ˆè€—é‡ä¾æ®`ï¼Œåªåœ¨charge_type = (0) consumption_based_collectionæ—¶ç”Ÿæ•ˆï¼Œæ ‡è¯†ä¸€ä¸ªRegisterå¯¹è±¡çš„scaler_unitï¼ˆé‡çº²ï¼‰å±æ€§çš„å¼•ç”¨ï¼Œå¦‚ç”µé‡
  - charge_table charge_per_unitæ˜¯åŸºäºcharge_per_unit_scaling_typeçš„ç¼©æ”¾ç”Ÿæˆçš„`æ¯å•ä½ä»·æ ¼å€¼`ï¼Œindexè¡¨ç¤ºåœ¨æŒ‰é‡è®¡è´¹æ¨¡å¼ä¸‹ä¸åŒçš„**è´¹ç‡æ¨¡å¼**ï¼Œå…¶ä»–æ¨¡å¼ä¸º0
- unit_charge_passive unit_chargeçš„`å¤‡ç”¨æ–¹æ¡ˆ`ï¼Œå’Œunit_charge_activeç»“æ„ç›¸åŒï¼Œæ¿€æ´»æ—¶æ‹·è´åˆ°unit_charge_activeä¸­
- unit_charge_activation_time è°ƒç”¨`æ¿€æ´»æ–¹æ³•`çš„`æ—¶é—´`
- period è¡¨ç¤ºCharge`é‡‡é›†å‘¨æœŸ`ï¼Œä»…å½“charge_type = (0) consumption_based_collection æˆ– (1) time_based_collection
- charge_configuration é‡‡é›†æ–¹å¼

  - bit 0: `æ¯”ä¾‹æ–¹å¼`ï¼Œç”¨äºcharge_type = (2) payment_event_based_collection
  - bit 1: `ä¸é—´æ–­é‡‡é›†æ–¹å¼`ï¼Œç½®ä½åtotal_amount_remainingä¸º0æ—¶ä¾æ—§é‡‡é›†ï¼Œå¦åˆ™ä¸é‡‡é›†
- last_collection_time `ä¸Šæ¬¡é‡‡é›†æ—¶é—´`
- last_collection_amount `ä¸Šæ¬¡æ”¶é›†é‡‘é¢`
- total_amount_remaining æ€»å‰©ä½™é‡‘é¢ TODO:ä»€ä¹ˆæ„æ€
- proportion æ‰‹ç»­è´¹`æ¯”ä¾‹`ï¼Œä»…å½“charge_type = (2) payment_event_based_collectionæœ‰æ•ˆ

æ–¹æ³•ï¼š

- update_unit_charge (data) æ›´æ–° unit_charge_passiveï¼ŒTODO:ä¸ºä»€ä¹ˆä¸ç›´æ¥SETè¯¥å±æ€§ï¼Œè€Œè¦é€šè¿‡æ–¹æ³•ã€‚
- activate_passive_unit_charge (data) å¯ç”¨å¤‡ç”¨æ–¹æ¡ˆ unit_charge_passive
- collect (data) charge_type ä¸ä¸º (0) consumption_based_collection æ—¶ç”Ÿæ•ˆï¼Œé‡‡é›†åœ¨ unit_charge_active å®šä¹‰çš„æ•°æ®
- update_total_amount_remaining (data) æ›´æ–° total_amount_remaining
- set_total_amount_remaining (data) è®¾ç½® total_amount_remaining

### s4.6.5 Token gateway (class_id = 115, version = 0)

å±æ€§ï¼š

- token åŒ…å«æœ€è¿‘æ¥æ”¶æˆ–æ ‡è®°çš„æœªå¤„ç† octet stringï¼Œä»¥ä¾¿åœ¨å†å² profile ä¸­æ•è·
- token_time æœ€è¿‘æ¥æ”¶å’Œå¤„ç†tokençš„æ—¶é—´
- token_description æœ€è¿‘æ¥æ”¶å’Œå¤„ç†çš„tokençš„æè¿°
- token_delivery_method æœ€è¿‘æ¥æ”¶çš„tokençš„æ¥æ”¶æ–¹å¼

  - è¿œç¨‹é€šä¿¡
  - æœ¬åœ°é€šä¿¡
  - æ‰‹åŠ¨è¾“å…¥
- token_status tokençŠ¶æ€ï¼ˆæ¥æ”¶ï¼Œå¤„ç†ï¼Œæ ¡éªŒï¼Œè®¤è¯ï¼‰

æ–¹æ³•ï¼š

- enter (data) ä»¥octet-stringæ ¼å¼ä¼ å…¥token

å¦å¤–æœ‰ä¸¤ä¸ª Data ç±»å‹çš„å¯¹è±¡è¡¨ç¤ºç›¸å…³çš„å‚æ•°ï¼Œå¦è§ 6.2.17 Payment metering related objectsï¼š

- Max credit limit: è¾¾åˆ°å¯ç”¨é¢åº¦ä¸Šé™ï¼Œä¸èƒ½å……å€¼token
- Max vend limit: è¾¾åˆ°å•æ¬¡å……å€¼ä¸Šé™ï¼Œä¸èƒ½å……å€¼token

### s4.6.6 IEC 62055-41 Attributes (class_id = 116, version =0)

`IEC 62055-41`æ•°æ®å…ƒç´ çš„é€‰æ‹©ï¼Œè¿™äº›å…ƒç´ æ˜¯ç®¡ç†åœ¨DLMSæœåŠ¡å™¨ä¸­å®ç°çš„`STS`åŠŸèƒ½æ‰€å¿…éœ€çš„ã€‚

- meter_pan MeterPrimaryAccountNumber
- commodity è®¡é‡ç”¨é€”åç§°ï¼Œâ€œELECTRICITYâ€, â€œWATERâ€, â€œGASâ€, or â€œTIMEâ€
- token_carrier_types
- encryption_algorithm
- supply_group_code
- tariff_index
- key_revision_number
- key_type
- key_expiry_number
- no_of_kct_supported
- sts_certificate_no

## s4.7 é€šè¿‡æœ¬åœ°ç«¯å£å’Œè°ƒåˆ¶è§£è°ƒå™¨å»ºç«‹æ•°æ®äº¤æ¢çš„æ¥å£ç±»Interface classes for setting up data exchange via local ports and modems

### s4.7.1 IEC local port setup (class_id = 19, version = 1)

- default_mode å®šä¹‰ç«¯å£ä¸Šä»ªè¡¨ä½¿ç”¨çš„åè®®

  - IEC 62056-21:2002 (modes Aâ€¦E)
  - IEC 62056-46:2002/AMD1:2006
  - åè®®æœªæŒ‡å®š
- default_baud èµ·å§‹æ³¢ç‰¹ç‡
- prop_baud å»ºè®®æ³¢ç‰¹ç‡
- response_time æ¥æ”¶åˆ°è¯·æ±‚åˆ°å‘é€å›å¤çš„æœ€å°æ—¶é—´
- device_addr IEC 62056-21:2002å®šä¹‰
- pass_p1 IEC 62056-21:2002å®šä¹‰
- pass_p2 IEC 62056-21:2002å®šä¹‰
- pass_w5 IEC 62056-21:2002å®šä¹‰

### s4.7.2 IEC HDLC setup (class_id = 23, version = 1)

- comm_speed å¯¹åº”ç«¯å£æ”¯æŒçš„é€šä¿¡é€Ÿåº¦

  (0) 300 baud, (1) 600 baud, (2) 1 200 baud, (3) 2 400 baud, (4) 4 800 baud, (5) 9 600 baud, (6) 19 200 baud, (7) 38 400 baud, (8) 57 600 baud, (9) 115 200 baud
- window_size_transmit å‘é€çª—å£å¤§å°
- window_size_receive æ¥æ”¶çª—å£å¤§å°
- max_info_field_length_transmit æœ€å¤§å‘é€é•¿åº¦
- max_info_field_length_receive æœ€å¤§æ¥å—é•¿åº¦
- inter_octet_time_out æ¥æ”¶è¶…æ—¶ï¼Œè¶…æ—¶æœªæ¥æ”¶åˆ°æ–°å­—ç¬¦æ—¶è§†ä¸ºå®Œæ•´æŠ¥æ–‡
- inactivity_time_out è¶…æ—¶æ–­å¼€
- device_address ç‰©ç†è®¾å¤‡åœ°å€

### s4.7.3 IEC twisted pair (1) setup (class_id = 24, version = 1)

å…è®¸é€šè¿‡IEC 62056-3-1:2021ä¸­è§„å®šçš„å¸¦æœ‰è½½æ³¢ä¿¡å·çš„ä¸­`ç»çº¿å¯¹`å»ºç«‹æ•°æ®äº¤æ¢ã€‚å¯é…ç½®å¤šä¸ªé€šä¿¡é€šé“

### s4.7.4 Modem configuration (class_id = 27, version = 1)

å’Œæ¨¡å—é—´çš„æ•°æ®ä¼ è¾“é…ç½®

- comm_speed é€šä¿¡é€Ÿåº¦ï¼Œæ³¢ç‰¹ç‡
- initialization_string åˆå§‹åŒ–å‘½ä»¤
- modem_profile æµ·æ–¯å‘½ä»¤é›†ï¼ˆHayes standard commandsï¼ŒATå‘½ä»¤ï¼‰æ˜ å°„

### s4.7.5 Auto answer (class_id = 28, version = 2)

è‡ªåŠ¨æ¥å¬

- mode è‡ªåŠ¨æ¥å¬å·¥ä½œæ¨¡å¼

  - (0) è®¾å¤‡ä¸“ç”¨çº¿è·¯
  - (1) å…±äº«çº¿è·¯ç®¡ç†ï¼Œå…è®¸æœ‰é™æ•°é‡çš„å‘¼å«ã€‚ä¸€æ—¦è¾¾åˆ°äº†`è°ƒç”¨çš„æ•°é‡`ï¼Œçª—å£çŠ¶æ€å°±å˜æˆä¸æ´»åŠ¨ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªå¼€å§‹æ—¥æœŸï¼Œæ— è®ºè°ƒç”¨çš„ç»“æœæ˜¯ä»€ä¹ˆ
  - (2) å…±äº«çº¿è·¯ç®¡ç†ï¼Œå…è®¸æœ‰é™æ•°é‡çš„æˆåŠŸå‘¼å«ã€‚ä¸€æ—¦è¾¾åˆ°äº†`æˆåŠŸé€šä¿¡çš„æ•°é‡`ï¼Œçª—å£çŠ¶æ€å°±ä¼šå˜å¾—ä¸æ´»åŠ¨ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªå¼€å§‹æ—¥æœŸ
  - (3) ç›®å‰æ²¡æœ‰è¿æ¥è°ƒåˆ¶è§£è°ƒå™¨
  - (200â€¦255) åˆ¶é€ å•†ç‰¹å®šçš„æ¨¡å¼
- listening_window å®šä¹‰`é€šä¿¡çª—å£`çš„`æ´»è·ƒ`(start_time)å’Œ`ä¸æ´»è·ƒ`(end_time)çš„æ—¶é—´ç‚¹ã€‚start_timeéšå¼åœ°å®šä¹‰å‘¨æœŸã€‚
  
  å…è®¸not specifiedï¼ˆ0xFFï¼‰è¡¨ç¤ºæ¯æœˆæ¯æ—¥é‡å¤
- status é€šä¿¡çª—å£çŠ¶æ€

  - (0)æœªæ¿€æ´»:è®¾å¤‡å°†ä¸ä¼šç®¡ç†æ–°çš„æ¥ç”µã€‚å½“ä¸‹ä¸€æ¬¡ç›‘å¬çª—å£å¯åŠ¨æ—¶ï¼Œè¯¥çŠ¶æ€å°†è‡ªåŠ¨é‡ç½®ä¸ºActive
  - (1)ä¸»åŠ¨:è®¾å¤‡å¯ä»¥æ¥å¬ä¸‹ä¸€ä¸ªæ¥ç”µ
  - (2)é”å®š:è¯¥å€¼å¯ä»¥ç”±è®¾å¤‡æˆ–ç‰¹å®šçš„å®¢æˆ·ç«¯è‡ªåŠ¨è®¾ç½®ï¼Œå½“è¯¥å®¢æˆ·ç«¯å®Œæˆå…¶è¯»å–ä¼šè¯ï¼Œå¹¶å¸Œæœ›åœ¨çª—å£æŒç»­æ—¶é—´ç»“æŸå‰å°†è¡Œè¿”å›ç»™å®¢æˆ·ã€‚å½“ä¸‹ä¸€æ¬¡ç›‘å¬çª—å£å¯åŠ¨æ—¶ï¼Œè¯¥çŠ¶æ€å°†è‡ªåŠ¨é‡ç½®ä¸ºActive
- number_of_calls modeä¸º1æˆ–2æ—¶ï¼Œæœ€å¤§å‘¼å«æ•°é‡
- number_of_rings TODO:ringæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿç¯æ•°ï¼Ÿå“å£°ï¼Ÿ
- list_of_allowed_callers ä¸€ä¸ªå¯é€‰çš„ä¸»å«å·ç åˆ—è¡¨ï¼ŒåŒ…æ‹¬å‘¼å«å’ŒSMSçŸ­ä¿¡

  - caller_id `å·ç `ï¼Œå…è®¸é€šé…ç¬¦
  - call_type å®šä¹‰äº†è°ƒç”¨çš„`ç›®çš„`ï¼Œä¾‹å¦‚ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ ‡å‡†çš„`CSDè°ƒç”¨`è¿˜æ˜¯ä¸€ä¸ª`å”¤é†’å‘¼å«/å”¤é†’æ¶ˆæ¯`ã€‚

    - (0) = normal CSD call:modemåªæœ‰åœ¨ä¸»å«å·ç ä¸åˆ—è¡¨ä¸­çš„æ¡ç›®`åŒ¹é…æ—¶`æ‰`è¿æ¥`ã€‚è¿™æ˜¯åœ¨æµ‹è¯•æ‰€æœ‰å…¶ä»–å±æ€§çš„åŒæ—¶è¿›è¡Œçš„ï¼Œä¾‹å¦‚number_of_rings, listening_windowsç­‰

      `ç”µè·¯äº¤æ¢æ•°æ®ï¼ˆCSDï¼‰`:å±äº2GæŠ€æœ¯,ç”¨äºä¼ è¾“æ•°æ®ï¼Œç±»ä¼¼GPRSï¼Œä½†æ›´åŠ è€æ—§
    - (1) = wake-up request:æ¥è‡ª`è¯¥ä¸»å«å·ç `çš„å‘¼å«æˆ–æ¶ˆæ¯å°†ä½œä¸º`å”¤é†’è¯·æ±‚`å¤„ç†ã€‚å”¤é†’è¯·æ±‚å°†ç«‹å³å¤„ç†ï¼Œè€Œä¸è€ƒè™‘number_of_ringså’Œlistening_windowç­‰æ‰€æœ‰å…¶ä»–å±æ€§(é™¤éä¸»å«å·ç ä¹Ÿå‡ºç°åœ¨æ™®é€šCSDè°ƒç”¨åˆ—è¡¨ä¸­ï¼Œè¯·å‚è§ä¸‹é¢)ã€‚

      éœ€è¦`ä¸ºç©º`ï¼Œå¦åˆ™ä¸è¢«æ˜¯ä¸º`å”¤é†’è¯·æ±‚`

      å¦‚æœ`ä¸ä¸ºç©º`ï¼Œä¸”åŒ…å«é¢„è¿æ¥AAå®¢æˆ·ç«¯çš„å¯ç”¨xDLMS APDUæ¶ˆæ¯,åˆ™è§†ä¸º`xDLMSæœåŠ¡æ¶ˆæ¯`è€Œéå”¤é†’è¯·æ±‚ï¼Œå¦åˆ™ä¸åšä»»ä½•ååº”

      TODOï¼šéœ€è¦è¡¥å……

### s4.7.6 Auto connect (class_id = 29, version = 2)

è‡ªåŠ¨è¿æ¥ï¼Œè‡ªåŠ¨æ‹¨å·ã€å‘é€æ¶ˆæ¯ç­‰

å±æ€§ï¼š

- mode è‡ªåŠ¨è¿æ¥æ¨¡å¼ï¼Œæ ¹æ®æ—¶é—´ã€æ¶ˆæ¯ç±»å‹å’Œè¦ä½¿ç”¨çš„åŸºç¡€è®¾æ–½æ¥æ§åˆ¶è‡ªåŠ¨è¿æ¥åŠŸèƒ½ã€‚
- repetitions è¿æ¥å¤±è´¥æœ€å¤§å°è¯•æ¬¡æ•°
- repetition_delay é‡è¯•é—´éš”ï¼Œç§’
- calling_window æ´»åŠ¨çª—å£ï¼Œåœ¨çª—å£æ—¶é—´å†…å…è®¸è‡ªåŠ¨è¿æ¥ï¼Œçœ‹modeçš„é…ç½®
- destination_list åŒ…å«åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å¿…é¡»å‘é€æ¶ˆæ¯çš„ç›®çš„åœ°åˆ—è¡¨(ä¾‹å¦‚ç”µè¯å·ç ã€ç”µå­é‚®ä»¶åœ°å€æˆ–å®ƒä»¬çš„ç»„åˆ)ã€‚è¿™é‡Œæ²¡æœ‰å®šä¹‰æ•°ç»„å…ƒç´ çš„æ¡ä»¶åŠå…¶é“¾æ¥

æ–¹æ³•ï¼š

- connect (data) æ ¹æ®modeå±æ€§å®šä¹‰çš„è§„åˆ™å‘é€šä¿¡ç½‘ç»œå‘èµ·è¿æ¥è¿›ç¨‹ã€‚

### s4.7.7 GPRS modem setup (class_id = 45, version = 0)

GPRSå‚æ•°

- APN APNåç§°
- PIN_code ä¸ªäººè¯†åˆ«ç ï¼ˆpersonal identification numberï¼‰
- quality_of_service æŒ‡å®šæœåŠ¡è´¨é‡å‚æ•°ï¼ˆQoSï¼‰ã€‚å®ƒæ˜¯ä¸€ä¸ªç”±ä¸¤ä¸ªå…ƒç´ ç»„æˆçš„ç»“æ„:

  - é»˜è®¤å€¼
  - è¯·æ±‚å€¼

### s4.7.8 GSM diagnostic (class_id: 47, version: 2)

â€œGSM diagnosticâ€ç±»çš„ä¸€ä¸ªå®ä¾‹å­˜å‚¨äº†åˆ†æç½‘ç»œè¿è¡Œæ‰€å¿…éœ€çš„GSM/GPRSã€UMTSã€CDMAæˆ–LTE`ç½‘ç»œå‚æ•°`ã€‚

èœ‚çªç½‘ç»œåœ¨`æ³¨å†ŒçŠ¶æ€`ã€`ä¿¡å·è´¨é‡`ç­‰æ–¹é¢éƒ½åœ¨ä¸æ–­å˜åŒ–ã€‚ç›‘æ§å’Œè®°å½•ç›¸å…³å‚æ•°æ˜¯å¿…è¦çš„ï¼Œä»¥ä¾¿è·å¾—è¯Šæ–­ä¿¡æ¯ï¼Œä»¥ä¾¿è¯†åˆ«ç½‘ç»œä¸­çš„é€šä¿¡é—®é¢˜ã€‚

å¯ç”¨â€œProfile genericâ€æ•è·

- operator è¿è¥å•†åç§°
- status modemæ³¨å†ŒçŠ¶æ€
- cs_attachment å½“å‰ç”µè·¯åˆ‡æ¢ï¼ˆCS,Circuit Switchï¼‰çŠ¶æ€ï¼Œè§[ç”µè·¯äº¤æ¢](https://baike.baidu.com/item/%E7%94%B5%E8%B7%AF%E4%BA%A4%E6%8D%A2)
- ps_status æŠ¥æ–‡åˆ†ç»„äº¤æ¢æŠ€æœ¯(PS,packet switch)çŠ¶æ€ï¼Œè§[æŠ¥æ–‡åˆ†ç»„äº¤æ¢](https://baike.baidu.com/item/%E6%8A%A5%E6%96%87%E5%88%86%E7%BB%84%E4%BA%A4%E6%8D%A2/1227042)
- cell_info èœ‚çªç½‘ç»œçŠ¶æ€
- adjacent_cells ä¸´è¿‘èŠ‚ç‚¹çŠ¶æ€
- capture_time æœ€è¿‘è¢«æ•è·çš„æ—¶é—´

### s4.7.9 LTE monitoring (class_id: 151, version = 1)

å…è®¸é€šè¿‡å¤„ç†æ‰€æœ‰å¿…è¦çš„æ•°æ®æ¥`ç›‘æ§`LTEè°ƒåˆ¶è§£è°ƒå™¨

- LTE_network_parameters ç½‘ç»œå‚æ•°
- LTE_quality_of_service æœåŠ¡è´¨é‡

## s4.8 é€šè¿‡M-Buså»ºç«‹æ•°æ®äº¤æ¢çš„æ¥å£ç±»Interface classes for setting up data exchange via M-Bus

### s4.8.2 M-Bus slave port setup (class_id = 25, version = 0)

M-Bus`ä»è®¾å¤‡`ç«¯å£è®¾ç½®

- default_baud èµ·å§‹æ³¢ç‰¹ç‡
- avail_baud åå•†æ³¢ç‰¹ç‡
- addr_state è®¾å¤‡æ˜¯å¦åˆ†é…äº†åœ°å€
- bus_address æ€»çº¿ä¸Šå½“å‰ä¸ºè®¾å¤‡åˆ†é…çš„åœ°å€

### s4.8.3 M-Bus client (class_id = 72, version = 2)

æ¯ä¸ªâ€œM-Bus clientâ€å¯¹è±¡`æ§åˆ¶`ä¸€ä¸ªM-Bus`ä»è®¾å¤‡`ã€‚

æ–¹æ³•å¯ä»¥å®ç°M-Busä»è®¾å¤‡çš„`å®‰è£…å’Œå¸è½½`

æœ¬å¯¹è±¡å¯ä»¥å‘**ä»è®¾å¤‡**é‡‡é›†æ•°æ®ï¼Œä¹Ÿå¯ä»¥å‘é€æ•°æ®ï¼ˆé…ç½®ï¼ŒåŠ¨ä½œï¼Œä¼ å¯†é’¥ç­‰ï¼‰

å±æ€§ï¼š

- mbus_port_reference â€œ`M-Bus master port setup`â€å¯¹è±¡`å¼•ç”¨`ï¼Œæ¯ä¸ªæ¥å£å…è®¸ä¸ä¸€ä¸ªæˆ–å¤šä¸ªM-Busä»è®¾å¤‡äº¤æ¢æ•°æ®ã€‚
- capture_definition æ•è·å®šä¹‰ï¼ŒTODO:éœ€è¦çœ‹å¼•ç”¨æ–‡æ¡£
- capture_period `æ•è·å‘¨æœŸ`

  - \>=1: è‡ªåŠ¨æ•è·ï¼Œç§’
  - 0ï¼šä¸è‡ªåŠ¨æ•è·ï¼Œéœ€æ‰‹åŠ¨è§¦å‘
- primary_address M-Busä»è®¾å¤‡çš„ä¸»åœ°å€ï¼ˆprimary addressï¼‰ï¼ŒèŒƒå›´æ˜¯0-250

  æœ‰è¯¥å€¼ï¼Œè¡¨ç¤ºå¯ä»¥ç«‹å³é€šä¿¡ï¼Œä¸å…è®¸è¿˜æœªå‡†å¤‡å°±ç»ªï¼ˆå®‰è£…ï¼‰æ—¶å†™è¯¥å€¼
- identification_number æ ‡è¯†å·ï¼Œç¬¬ä¸€æ¬¡é€šä¿¡æ—¶å†™å…¥
- manufacturer_id EN 137577:2018
- version EN 137577:2018
- device_type EN 137577:2018
- access_number EN 137577:2018
- status EN 137577:2018
- alarm EN 137577:2018
- configuration EN 137577:2018
- encryption_key_status `åŠ å¯†å¯†é’¥çŠ¶æ€`ï¼Œè®¾ç½®ã€ä¼ è¾“ã€ä½¿ç”¨
- configuration_extension EN 137577:2018
- invocation_status æºå¸¦æœªå†³ï¼ˆpendingï¼‰M-Busæ–¹æ³•è°ƒç”¨çš„`è°ƒç”¨çŠ¶æ€`ã€‚å½“invocation_statusè¡¨ç¤º`(1)æˆåŠŸ`æ—¶ï¼Œç»“æœæºå¸¦åœ¨invocation_statusçš„`return-data`ä¸­ã€‚å¦‚æœæ²¡æœ‰è¿”å›æ•°æ®å¯ç”¨ï¼Œåˆ™return_data octet-stringä¸ºç©ºï¼Œå³é•¿åº¦ä¸º0ã€‚å½“æ²¡æœ‰æŒ‚èµ·çš„è°ƒç”¨æ—¶ï¼Œæ•°ç»„ä¸ºç©ºã€‚

æ–¹æ³•ï¼š

- slave_install (data) `å®‰è£…`ä¸€ä¸ªæœªé…ç½®çš„ä»è®¾å¤‡ï¼ˆprimary address æ˜¯ 0ï¼‰

  - æ£€æŸ¥`M-Busåœ°å€`0ä¸Šæ˜¯å¦æœ‰æ–°è®¾å¤‡
  - æ²¡æ‰¾åˆ°è°ƒç”¨å¤±è´¥
  - æ–¹æ³•å‚æ•°è¡¨ç¤º`primary address`ï¼Œå¦‚æœä¸å¸¦å‚æ•°è°ƒç”¨ï¼Œåˆ™è‡ªåŠ¨å–æœªä½¿ç”¨çš„`primary address`ï¼Œåˆ†é…å¹¶ä¼ è¾“ç»™ä»è®¾å¤‡
- slave_deinstall (data) `å¸è½½`ä»è®¾å¤‡ã€‚æ­¤æœåŠ¡çš„ä¸»è¦ç›®çš„æ˜¯å¸è½½M-Busä»è®¾å¤‡ï¼Œå¹¶è®©ä¸»è®¾å¤‡ä¸ºå®‰è£…æ–°è®¾å¤‡åšå¥½å‡†å¤‡ã€‚æ‰§è¡Œä»¥ä¸‹æ“ä½œ:

  - ä»è®¾å¤‡`M-Busåœ°å€`è®¾ç½®ä¸º0
  - `é”€æ¯`ä¹‹å‰ä¼ è¾“çš„`å¯†é’¥`ï¼Œä¸å½±å“é»˜è®¤å¯†é’¥
  - encryption_key_statusè®¾ä¸º`(0): no encryption_key`
  - `primary address`è®¾ä¸º0
  - å…¨éƒ¨`å±æ€§`è®¾ç½®ä¸º`é»˜è®¤å€¼`
- capture (data) æ•è·ï¼Œå’Œcapture_definitionå±æ€§å…³è”
- reset_alarm (data) å¤ä½M-Busä»è®¾å¤‡`å‘Šè­¦çŠ¶æ€`
- synchronize_clock (data) åŒæ­¥ä»è®¾å¤‡æ—¶é’Ÿ
- data_send (data) å‘ä»è®¾å¤‡`å‘é€æ•°æ®`
- set_encryption_key (data) `è®¾ç½®`M-Bus`å®¢æˆ·ç«¯`è®¾å¤‡çš„åŠ å¯†`å¯†é’¥`ï¼Œ**ä»è®¾å¤‡**åˆšå®‰è£…æ—¶å®¢æˆ·ç«¯è®¾å¤‡æœ‰ä¸ªç©ºå¯†é’¥ï¼Œä¸”åŠ å¯†ä¼ è¾“ç¦ç”¨ï¼Œå¯ä»¥é€šè¿‡é…ç½®ç©ºå¯†é’¥ç¦ç”¨åŠ å¯†ä¼ è¾“
- transfer_key (data) `ä¼ è¾“åŠ å¯†å¯†é’¥`ç»™ä»è®¾å¤‡

  åœ¨åŠ å¯†ä¼ è¾“å¯ç”¨å‰ï¼Œ`åŠ å¯†å¯†é’¥`é€šè¿‡ä»è®¾å¤‡`é»˜è®¤å¯†é’¥`ï¼ˆå¯†é’¥åŠ å¯†å¯†é’¥ï¼ŒMKï¼‰`åŠ å¯†`ï¼Œä¼ è¾“ç»™ä»è®¾å¤‡ï¼Œæœ¬æ¬¡ä¼ è¾“é€šé“`ä¸åŠ å¯†`ï¼Œä¹‹åæ‰å¼€å§‹åŠ å¯†ä¼ è¾“ã€‚ä¹‹åå¯ä»¥é‡å¤è°ƒç”¨è¯¥æ–¹æ³•`æ›´æ–°`å¯†é’¥ï¼ŒåŒæ ·ä½¿ç”¨é»˜è®¤å¯†é’¥åŠ å¯†å¯†é’¥ï¼Œä½†è¿™æ¬¡ä¼ è¾“é€šé“ä¸º`åŠ å¯†çš„`

  è¢«å¸è½½åï¼Œä»è®¾å¤‡å†…å¯†é’¥é”€æ¯ï¼Œä½†é»˜è®¤å¯†é’¥ä¸å—å½±å“ï¼Œç¦ç”¨åŠ å¯†ä¼ è¾“
- transfer_security_information (data) å‘M-Busä»è®¾å¤‡ä¼ è¾“`å®‰å…¨ä¿¡æ¯`(security_information)
- invocations_reset(data) å°†M-Busä»è®¾å¤‡çš„æ–¹æ³•è°ƒç”¨é‡ç½®ä¸ºåˆå§‹çŠ¶æ€

### s4.8.4 Wireless Mode Q channel (class_id = 73, version = 1)

ä½¿ç”¨æ¨¡å¼Qæ¥å£è¿›è¡Œé€šä¿¡çš„æ“ä½œå‚æ•°ã€‚å‚è§*EN 13757-5:2015*ã€‚

### s4.8.5 M-Bus master port setup (class_id = 74, version = 0)

å¦‚æœè®¾å¤‡ä½œä¸ºM-bus masterï¼Œè¯¥ICçš„å®ä¾‹å®šä¹‰äº†ä½¿ç”¨*EN 13757-2*æ¥å£è¿›è¡Œé€šä¿¡çš„æ“ä½œå‚æ•°ã€‚

### s4.8.6 DLMS server M-Bus port setup (class_id = 76, version = 0)

åœ¨M-Busä»è®¾å¤‡æ‰˜ç®¡çš„DLMSæœåŠ¡å™¨ä¸­ä½¿ç”¨ï¼Œä½¿ç”¨DLMS/COSEMæœ‰çº¿æˆ–æ— çº¿M-Bus (wM-Bus)é€šä¿¡é…ç½®æ–‡ä»¶

- M-Bus_profile_selection å¼•ç”¨M-Busé€šä¿¡ç«¯å£è®¾ç½®å¯¹è±¡,â€œM-Bus slave port setupâ€ object (class_id = 25)æˆ– â€œWireless Mode Q channelâ€ object (class_id = 73).
- M-Bus_port_communication_state M-Bus nodeé€šä¿¡çŠ¶æ€

  - (0)æ— æ¥å…¥:ä»ªè¡¨æ— æ¥å…¥çª—å£(å•å‘ä»ªè¡¨)ï¼Œ
  - (1)æš‚æ— æ¥å…¥:ä»ªè¡¨ä¸€èˆ¬æ”¯æŒåŒå‘æ¥å…¥ï¼Œä½†æœ¬æ¬¡ä¼ è¾“åæ²¡æœ‰æ¥å…¥çª—å£(å¦‚ä¸ºäº†ä¿æŒå ç©ºæ¯”é™åˆ¶æˆ–`é™åˆ¶èƒ½è€—`ï¼Œæš‚æ— æ¥å…¥)ï¼Œ
  - (2)æœ‰é™çš„è®¿é—®:ä»ªè¡¨ä»…åœ¨ä¼ è¾“åæä¾›ä¸€ä¸ªçŸ­çš„è®¿é—®çª—å£(å¦‚ç”µæ± ä¾›ç”µä»ªè¡¨)ï¼Œ
  - (3)æ— é™æ¥å…¥:è‡³å°‘åœ¨ä¸‹æ¬¡ä¼ è¾“(å¦‚å¸‚ç”µä¾›ç”µè®¾å¤‡)ä¹‹å‰ï¼Œä»ªè¡¨æä¾›æ— é™æ¥å…¥ã€‚
  - (4)æ­¤å±æ€§ä»…åœ¨wM-Busä¸­ç›¸å…³ã€‚

  TODO:nodeæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ
- M-Bus_Data_Header_Type æŠ¥æ–‡å¤´ç±»å‹ï¼Œæ´¾ç”Ÿè‡ªå½“å‰é€šä¿¡çš„CITLå€¼ã€‚
- primary_address EN 137577:2018
- identification_number EN 137577:2018
- manufacturer_id EN 137577:2018
- version EN 137577:2018
- device_type EN 137577:2018
- max_pdu_size M-Busä½å±‚pdué•¿åº¦ä¸Šé™ï¼Œå¯¹äºé•¿æ¶ˆæ¯ï¼Œå¯ä»¥ä½¿ç”¨`DLMS/COSEMåº”ç”¨å±‚`æä¾›çš„`å—ä¼ è¾“`æˆ–`ä¼ è¾“å±‚`æä¾›çš„`åˆ†æ®µä¼ è¾“`ï¼Œä¹Ÿå¯ä»¥åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§æœºåˆ¶ã€‚
- listening_window æ­¤å±æ€§ä»…åœ¨wM-Busä¸­ç›¸å…³ï¼Œå®šä¹‰ç‚¹å¯¹ç‚¹é€šä¿¡çª—å£æ´»åŠ¨(start_time)å’Œä¸æ´»åŠ¨(end_time)çš„æ—¶é—´ç‚¹ã€‚start_timeéšå¼åœ°å®šä¹‰å‘¨æœŸ

### s4.8.7 M-Bus diagnostic (class_id = 77, version = 0)

åŒ…å«ä¸M-Busç½‘ç»œè¿è¡Œç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚å½“å‰`ä¿¡å·å¼ºåº¦`ã€`é€šé“æ ‡è¯†ç¬¦`ã€åˆ°M-Busç½‘ç»œçš„`é“¾è·¯çŠ¶æ€`ä»¥åŠä¸`å¸§äº¤æ¢`ã€`ä¼ è¾“`å’Œ`å¸§æ¥æ”¶``è´¨é‡`ç›¸å…³çš„`è®¡æ•°å™¨`ã€‚

- received-signal-strength æ­¤å±æ€§ä»…ä¸æ— çº¿åŒå‘M-Busï¼ˆ`wM-Bus,wireless M-Bus`ï¼‰é€šä¿¡ç›¸å…³ã€‚

  å½“ä½¿ç”¨wM-Busé…ç½®æ–‡ä»¶æ—¶ï¼Œè¿™ä¸ªå±æ€§ä¿å­˜äº†æ¥æ”¶åˆ°çš„æœ€åä¸€ä¸ªwM-Buså¸§çš„`ä¿¡å·å¼ºåº¦å€¼`ï¼Œç”¨`dBm`è¡¨ç¤ºã€‚
- channel_Id æ­¤å±æ€§ä»…ä¸wM-Busé€šä¿¡ç›¸å…³ã€‚å½“ä½¿ç”¨wM-Busé…ç½®æ–‡ä»¶æ—¶ï¼Œæ­¤å±æ€§ä¿å­˜å½“å‰ä½¿ç”¨çš„`é€šé“çš„æ ‡è¯†`ã€‚ç¼ºçœå€¼ä¸º0ã€‚
- link_status æ­¤å±æ€§ä»…ä¸wM-Busé€šä¿¡ç›¸å…³ã€‚å½“ä½¿ç”¨wM-Busé…ç½®æ–‡ä»¶æ—¶ï¼Œæ­¤å±æ€§ä¿å­˜åˆ°M-Busç½‘ç»œçš„`é“¾æ¥`çš„`å½“å‰çŠ¶æ€`

  - (0)ç¼ºçœå€¼(æœªæ¥æ”¶åˆ°æ•°æ®)
  - (1)é“¾è·¯æ­£å¸¸è¿è¡Œ
  - (2)é“¾è·¯æš‚æ—¶ä¸­æ–­
- broadcast_frames_counter æŒæœ‰`å¹¿æ’­å¸§è®¡æ•°`å™¨çš„å€¼ï¼Œæ—¶é—´æˆ³ä¸ºæ¥æ”¶åˆ°çš„æœ€åä¸€å¸§ï¼Œå¹¶ç”±å®¢æˆ·ç«¯æ ‡è¯†ç¬¦åŒºåˆ†
- transmissions_counter ç»Ÿè®¡ç›¸å…³M-Busç«¯å£`ä¼ è¾“`çš„`å¸§æ•°`ã€‚åˆ°è¾¾æœ€å¤§å€¼å½’0ã€‚
- FCS_OK_frames_counter ä»¥`æ­£ç¡®çš„`æ ¡éªŒå’Œè®¡ç®—æ¥æ”¶åˆ°çš„`å¸§æ•°`ã€‚åˆ°è¾¾æœ€å¤§å€¼å½’0ã€‚
- FCS_NOK_frames_counter ç»Ÿè®¡æ¥æ”¶åˆ°çš„`æ ¡éªŒå’Œ(checksum)é”™è¯¯`çš„`å¸§æ•°`
- capture_time ä¿å­˜å±æ€§received-signal-strengthã€link_statusã€transmissions_counterã€FCS_OK_frames_counteræˆ–FCS_NOK_frames_counterçš„å€¼`æœ€è¿‘å˜åŒ–`çš„`æ—¶é—´æˆ³`ã€‚

æ–¹æ³•ï¼š

- reset (data) æ¸…é™¤æ‰€æœ‰è®¡æ•°å™¨(counters)ï¼Œreceived_signal_strength, link_statuså’Œcapture_time

## s4.9 ç”¨äºåœ¨Internetä¸Šå»ºç«‹æ•°æ®äº¤æ¢çš„æ¥å£ç±»Interface classes for setting up data exchange over the Internet

### s4.9.1 TCP-UDP setup (class_id = 41, version = 0)

å…è®¸å¯¹åŸºäº`TCP-UDP/IP`çš„é€šä¿¡é…ç½®æ–‡ä»¶çš„`TCPæˆ–UDPä¼ è¾“å±‚`çš„è®¾ç½®å»ºæ¨¡

æˆ–åŸºäº`DLMS/COSEM CoAP`çš„`DLMS/COSEM CoAPä¼ è¾“å±‚`çš„`UDPå­å±‚`çš„è®¾ç½®å»ºæ¨¡

åœ¨åŸºäº`TCP-UDP/IP`çš„é€šä¿¡é…ç½®æ–‡ä»¶ä¸­ï¼Œæ‰¿è½½`ä¸€ä¸ªæˆ–å¤šä¸ª`COSEM`å®¢æˆ·ç«¯`åº”ç”¨ç¨‹åºè¿›ç¨‹çš„`ç‰©ç†è®¾å¤‡`å’Œæ‰¿è½½`ä¸€ä¸ªæˆ–å¤šä¸ª`COSEM`æœåŠ¡å™¨`apçš„`ç‰©ç†è®¾å¤‡`ä¹‹é—´çš„`æ‰€æœ‰AAs`éƒ½ä¾èµ–äº`å•ä¸ª`TCPæˆ–UDPè¿æ¥ã€‚TCPæˆ–UDPå®ä½“å°è£…åœ¨åŸºäºCOSEM TCP-UDPçš„ä¼ è¾“å±‚ä¸­ã€‚åœ¨ç‰©ç†è®¾å¤‡ä¸­ï¼Œæ¯ä¸ª`AP`(å®¢æˆ·ç«¯APæˆ–æœåŠ¡å™¨é€»è¾‘è®¾å¤‡)éƒ½ç»‘å®šåˆ°ä¸€ä¸ª`åŒ…è£…å™¨ç«¯å£(WPort)`

ä¸€ä¸ªåŸºäº`COSEM TCPæˆ–UDPçš„ä¼ è¾“å±‚`å¯èƒ½èƒ½å¤Ÿæ”¯æŒä¸€ä¸ª`ç‰©ç†è®¾å¤‡`å’Œå¤šä¸ªæ‰¿è½½COSEM apçš„`å¯¹ç­‰ç‰©ç†è®¾å¤‡`ä¹‹é—´çš„`å¤šä¸ª`TCPæˆ–UDPè¿æ¥ã€‚

ä¸€ä¸ª`DLMS/COSEM CoAPä¼ è¾“å±‚`å¯ä»¥æ”¯æŒ`å¤šä¸ªUDPè¿æ¥`ï¼Œç”¨äºä¸€ä¸ª`ç‰©ç†è®¾å¤‡`å’Œä¸€ä¸ªæˆ–å¤šä¸ªæ‰¿è½½COSEM apçš„`å¯¹ç­‰ç‰©ç†è®¾å¤‡`ä¹‹é—´çš„é€šä¿¡ã€‚

å½“ä¸€ä¸ª`COSEMç‰©ç†è®¾å¤‡`æ”¯æŒ`å„ç§æ•°æ®é“¾è·¯å±‚`æ—¶â€”â€”ä¾‹å¦‚ä»¥å¤ªç½‘å’ŒPPPâ€”â€”`æ¯ä¸€ä¸ª`éƒ½éœ€è¦`ä¸€ä¸ª`TCP-UDP setupå¯¹è±¡çš„`å®ä¾‹`ã€‚

- TCP-UDP_port ç›‘å¬ç«¯å£å·ï¼Œ4059 TCP/UDP
- IP_reference å¼•ç”¨â€œIP setupâ€å¯¹è±¡
- MSS åœ¨æœ€å¤§æ®µå¤§å°(MSSï¼ŒMaximum Segment Size)é€‰é¡¹çš„å¸®åŠ©ä¸‹ï¼ŒTCPå®ä½“å¯ä»¥å‘å®ƒçš„å¯¹ç«¯æŒ‡ç¤ºæœ€å¤§çš„æ¥æ”¶æ®µå¤§å°ã€‚æ³¨æ„:

  - è¿™ä¸ªé€‰é¡¹åªèƒ½åœ¨`åˆå§‹è¿æ¥è¯·æ±‚`ä¸­å‘é€(å³å‘é€`SYNæ§åˆ¶ä½`çš„åˆ†æ®µ);
  - å¦‚æœè¿™ä¸ªé€‰é¡¹ä¸å­˜åœ¨ï¼Œé€šå¸¸MSSè¢«è®¤ä¸ºæ˜¯å®ƒçš„é»˜è®¤å€¼ï¼Œ`576`;
  - MSSæ˜¯`ä¸å¯åå•†`çš„;å®ƒçš„å€¼ç”±è¿™ä¸ªå±æ€§æŒ‡ç¤ºã€‚
- nb_of_sim_conn åŸºäºCOSEM TCP-UDPçš„ä¼ è¾“å±‚èƒ½å¤Ÿæ”¯æŒçš„`æœ€å¤§åŒæ—¶è¿æ¥æ•°`(maximum number of simultaneous connections)
- inactivity_time_out `æ¥æ”¶è¶…æ—¶é‡Šæ”¾`ï¼Œå®šä¹‰æ—¶é—´ï¼Œä»¥ç§’è¡¨ç¤ºï¼Œå¦‚æœæ²¡æœ‰ä»COSEMå®¢æˆ·ç«¯æ”¶åˆ°å¸§ï¼Œ`ä¸æ´»åŠ¨`çš„TCPè¿æ¥å°†è¢«`ä¸­æ­¢`ã€‚

0è¡¨ç¤ºæ°¸ä¸ä¸­æ­¢

æ³¨æ„ï¼Œæ‰€æœ‰ä¸ç®¡ç†`éæ´»åŠ¨è¶…æ—¶å‡½æ•°`ç›¸å…³çš„`æ“ä½œ`ï¼Œå¦‚`æµ‹é‡`éæ´»åŠ¨æ—¶é—´ã€åœ¨è¶…æ—¶ç»“æŸæ—¶`ç»ˆæ­¢`TCPè¿æ¥ç­‰ï¼Œéƒ½åœ¨`TCP-UDPå±‚`å®ç°ä¸­è¿›è¡Œç®¡ç†ã€‚

### s4.9.2 IPv4 setup (class_id = 42, version = 0)

IPv4ä¿¡æ¯ï¼Œæ¯ä¸ªç½‘å£å¯¹åº”ä¸€ä¸ª

å±æ€§ï¼š

- DL_reference å¼•ç”¨æ•°æ®é“¾è·¯å±‚(å¦‚ä»¥å¤ªç½‘æˆ–PPP)è®¾ç½®å¯¹è±¡
- IP_address é™æ€æˆ–åŠ¨æ€çš„`ipåœ°å€`

  IPv4åœ°å€192.168.0.1(ç‚¹åˆ†åè¿›åˆ¶)å¯¹åº”C0A80001 (hexa)ï¼Œå¾—åˆ°3232235521 (double-long-unsigned)ã€‚
- multicast_IP_address `ç»„æ’­åœ°å€`ï¼Œè¯¥`æ•°ç»„`ä¸­çš„IPåœ°å€åº”å±äº`ç»„æ’­ç»„åœ°å€èŒƒå›´`(â€œDç±»â€åœ°å€ï¼ŒåŒ…æ‹¬224.0.0.0 - 239.255.255.255èŒƒå›´å†…çš„IPåœ°å€)ã€‚å½“è®¾å¤‡æ¥æ”¶åˆ°IPæ•°æ®æŠ¥æ—¶ï¼Œå¦‚æœ`ç›®çš„IPåœ°å€`å­—æ®µå±äºæ•°ç»„ä¸­IPåœ°å€ä¹‹ä¸€ï¼Œå®ƒåº”è¯¥è®¤ä¸ºè¯¥æ•°æ®æŠ¥æ˜¯ç»™å®ƒè‡ªå·±çš„ã€‚
- IP_options åŒ…å«æ”¯æŒæ‰€é€‰IPé€‰é¡¹çš„`å¿…è¦å‚æ•°`â€”â€”ä¾‹å¦‚`æ•°æ®æŠ¥æ—¶é—´æˆ³`æˆ–`å®‰å…¨æœåŠ¡`(IPSec)ã€‚

  æ ‡å‡†çš„[IP option RFC 791](https://www.iana.org/assignments/ip-parameters/ip-parameters.xhtml)ä¸­çš„éƒ¨åˆ†

  - Security: IP_Option_Type = 0x82, IP_Option_Length = 11
  - Loose Source and Record Route: IP_Option_Type = 0x83 å®½æ¾çš„æºç«™é€‰è·¯ï¼ˆä¸ºæ•°æ®æŠ¥æŒ‡å®šä¸€ç³»åˆ—å¿…é¡»ç»è¿‡çš„IPåœ°å€ï¼‰
  - Strict Source and Record Route: IP_Option_Type = 0x89 ä¸¥æ ¼çš„æºç«™é€‰è·¯é€‰é¡¹ã€‚ä¸å®½æ¾çš„æºç«™é€‰è·¯ç±»ä¼¼ï¼Œä½†æ˜¯è¦æ±‚åªèƒ½ç»è¿‡æŒ‡å®šçš„è¿™äº›åœ°å€ï¼Œä¸èƒ½ç»è¿‡å…¶ä»–çš„åœ°å€ã€‚
  - Record Route: IP_Option_Type = 0x07 è®°å½•è·¯å¾„ï¼ˆè®©æ¯ä¸ªè·¯ç”±å™¨éƒ½è®°ä¸‹å®ƒçš„IPåœ°å€ï¼‰
  - Internet Timestamp: IP_Option_Type = 0x44 æ—¶é—´æˆ³é€‰é¡¹
- subnet_mask å­ç½‘æ©ç 
- gateway_IP_address ç½‘å…³IP
- use_DHCP_flag æ˜¯å¦å¯ç”¨dhcpï¼Œå¯ç”¨åIP_address, subnet_mask and gateway_IP_addresså˜ä¸ºåŠ¨æ€
- primary_DNS_address ä¸»DNS
- secondary_DNS_address å¤‡ç”¨DNS

æ–¹æ³•ï¼š

- add_mc_IP_address (data) å‘multicast_IP_addressæ•°ç»„æ·»åŠ ä¸€ä¸ªæ–°çš„ip
- delete_mc_IP_address (data) ä»multicast_IP_addressæ•°ç»„åˆ é™¤ä¸€ä¸ªip
- get_nbof_mc_IP_addresses (data) è·å–multicast_IP_addressæ•°ç»„å…ƒç´ æ•°é‡

### s4.9.3 IPv6 setup (class_id = 48, version = 0)

å±æ€§ï¼š

- DL_reference åŒIPv4
- address_config_mode IPv6åœ°å€é…ç½®æ¨¡å¼

  - (0) Auto-configuration (default)
  - (1) DHCPv6
  - (2) Manual
  - (3) ND (Neighbour Discovery)
- unicast_IPv6_addresses `å•æ’­åœ°å€`(å”¯ä¸€æœ¬åœ°å•æ’­ï¼Œé“¾æ¥æœ¬åœ°å•æ’­ å’Œ/æˆ– å…¨çƒå•æ’­åœ°å€)ï¼Œæ˜¯`æ•°ç»„`
- multicast_IPv6_addresses `ç»„æ’­åœ°å€`, `æ•°ç»„`
- gateway_IPv6_addresses `ç½‘å…³IP`ï¼Œ`æ•°ç»„`
- primary_DNS_address åŒIPv4
- secondary_DNS_address åŒIPv4
- traffic_class åŒ…å«IPv6å¤´çš„traffic classå…ƒç´ ã€‚RFC 2474:1998ç¬¬3æ¡è§„å®šï¼Œä½¿ç”¨`DSCP` (Differentiated Services Codepoint)å¯¹æŠ¥æ–‡è¿›è¡Œåˆ†ç±»ï¼Œæ ¹æ®ç±»å‹çš„ä¸åŒQoSå¯ä»¥æŒ‡å®šä¸åŒåŠ¨ä½œï¼Œå¦‚æœ‰äº›éœ€è¦ä½å»¶è¿Ÿï¼Œæœ‰äº›éœ€è¦å¤§æµé‡ã€‚
- neighbor_discovery_setup åŒ…å«ç”¨äºæ”¯æŒIPv6`é‚»å±…å‘ç°åè®®NDP`(rfc4861)çš„è·¯ç”±å™¨å’Œä¸»æœºçš„é…ç½®ã€‚

  - RS_max_retry ç»™å‡ºä¸€ä¸ªèŠ‚ç‚¹åœ¨`æ²¡æœ‰`æ”¶åˆ°`é¢„æœŸ`çš„è·¯ç”±å™¨`é€šå‘Š`æ—¶æ‰§è¡Œçš„æœ€å¤§è·¯ç”±å™¨è¯·æ±‚`é‡è¯•æ¬¡æ•°`ã€‚
  - RS_retry_wait_time ç»™å‡ºä¸¤ä¸ªè¿ç»­è·¯ç”±å™¨è¯·æ±‚é‡è¯•ä¹‹é—´çš„`ç­‰å¾…æ—¶é—´`(ä»¥`æ¯«ç§’`ä¸ºå•ä½)ã€‚
  - RA_send_period ç»™å‡ºè·¯ç”±å™¨é€šå‘Šä¼ è¾“çš„`å‘¨æœŸ`ï¼Œå•ä½ä¸ºç§’

æ–¹æ³•ï¼š

- add_IPv6_address (data) æ·»åŠ IPv6åœ°å€ï¼Œå‚æ•°åŒ…æ‹¬ç±»å‹ï¼šå•æ’­ã€ç»„æ’­ã€ç½‘å…³
- remove_IPv6_address (data) ç§»é™¤IPv6åœ°å€ï¼Œå‚æ•°åŒ…æ‹¬ç±»å‹ï¼šå•æ’­ã€ç»„æ’­ã€ç½‘å…³

### s4.9.4 MAC address setup (class_id = 43, version = 0)

ä»åŸæ¥çš„â€œEthernet setupâ€æ›´åè€Œæ¥ï¼Œè¯´æ˜è¿™ä¸ªç±»åŸæ¥ä»…ç”¨äºä»¥å¤ªç½‘ã€‚ç°åœ¨å¯ä»¥ç”¨äºæ›´å¹¿æ³›çš„ç”¨é€”ï¼Œå¦‚PLCç½‘ç»œçš„MAC

ä¿å­˜MACåœ°å€

å±æ€§ï¼š

- MAC_address MACåœ°å€

### s4.9.5 PPP setup (class_id = 44, version = 0)

é€šè¿‡å¤„ç†ä¸ç»™å®š`ç‰©ç†è®¾å¤‡`ç›¸å…³çš„`PPPè®¾ç½®`çš„`æ‰€æœ‰ä¿¡æ¯`ï¼Œä»¥åŠä¸ä½¿ç”¨è¿™äº›è®¾ç½®çš„`ä½å±‚è¿æ¥`ï¼Œè¯¥ICå…è®¸ä½¿ç”¨`PPPåè®®æ¨¡æ‹Ÿæ¥å£`çš„è®¾ç½®ã€‚ä¸€ä¸ªç‰©ç†è®¾å¤‡çš„`æ¯ä¸ª`ç½‘ç»œæ¥å£éƒ½åº”è¯¥æœ‰ä¸€ä¸ªè¯¥ICçš„å®ä¾‹ã€‚

- PHY_reference é€šè¿‡å®ƒçš„logical_nameå¼•ç”¨`å¦ä¸€ä¸ªå¯¹è±¡`ã€‚å¼•ç”¨çš„å¯¹è±¡åŒ…å«å…·ä½“`ç‰©ç†å±‚æ¥å£çš„ä¿¡æ¯`ï¼Œæ”¯æŒPPPå±‚ã€‚ TODO:å¼•ç”¨ä»€ä¹ˆå¯¹è±¡ï¼Ÿ
- LCP_options `LCP`é…ç½®[å‚æ•°](https://www.iana.org/assignments/ppp-numbers/ppp-numbers.xml)ã€‚

  - Maximum-Receive-Unit (MRU), LCP_Option_Type = 1. See RFC 1661. `æœ€å¤§æ¥æ”¶å•å…ƒ`ã€‚ç”¨äºé€šçŸ¥peerå¯ä»¥æ¥æ”¶æ›´å¤§çš„åŒ…ï¼ˆå¦‚å¯¹æ–¹å‘çš„åŒ…æ¯”è¾ƒå°ï¼Œå¯ä»¥å‘Šè¯‰ä»–è‡ªå·±æœ€å¤§èƒ½æ¥æ”¶å¤šå°‘ï¼‰ï¼Œä¹Ÿèƒ½é€šçŸ¥peerå‘æ›´å°çš„åŒ…ï¼Œå¤ªå¤§å¤„ç†ä¸äº†
  - Async-Control-Character-Map (ACCM), LCP_Option_Type = 2. See RFC 1662. å¼‚æ­¥æ§åˆ¶å­—ç¬¦æ˜ åƒ
  - Authentication-Protocol, LCP_Option_Type = 3. See RFC 1661. `è®¤è¯åè®®`ï¼ŒPAPã€CHAPã€EAPã€‚
  - Magic-Number, LCP_Option_Type = 5. See RFC 1661. è¯¥é…ç½®é€‰é¡¹æä¾›äº†ä¸€ç§`æ£€æµ‹å›ç¯é“¾è·¯`å’Œå…¶ä»–æ•°æ®é“¾è·¯å±‚`å¼‚å¸¸`çš„æ–¹æ³•;
  - Protocol-Field-Compression (PFC), LCP_Option_Type = 7. See RFC 1661. `åè®®åŸŸå‹ç¼©`ï¼Œè¿™ä¸ªé…ç½®é€‰é¡¹æä¾›äº†ä¸€ç§åå•†PPPåè®®å­—æ®µå‹ç¼©çš„æ–¹æ³•
  - Address-and-Control-Field-Compression (ACFC), LCP_Option_Type = 8. See RFC 1661. `åœ°å€å’Œæ§åˆ¶å­—æ®µå‹ç¼©`ï¼Œè¿™ä¸ªé…ç½®é€‰é¡¹æä¾›äº†ä¸€ç§æ–¹æ³•æ¥åå•†æ•°æ®é“¾è·¯å±‚åœ°å€å’Œæ§åˆ¶å­—æ®µçš„å‹ç¼©;
  - FCS-Alternatives, LCP_Option_Type = 9. See RFC 1570. FCSæ›¿æ¢ï¼Œå¯ä»¥æŒ‡å®šå¯¹ç­‰ç«¯å‘é€çš„`å¦ä¸€ç§`FCSæ ¼å¼ï¼Œæˆ–è€…åå•†`å®Œå…¨æ”¾å¼ƒ`FCS
  - Callback, LCP_Option_Type = 13. See RFC 1570.
 å›æ‹¨ï¼Œæ˜¯æŒ‡å½“é€šä¿¡ä¸€æ–¹æ‹¨å·åˆ°å¦ä¸€æ–¹åï¼Œç”±å¦ä¸€æ–¹æ–­å¼€æ‹¨å·è¿æ¥å¹¶è¿›è¡Œ`åå‘çš„æ‹¨å·`ã€‚æ›´åŠ å®‰å…¨ï¼Œå¦ä¸€æ–¹å¯ä»¥åœ¨å›å«å‰éªŒè¯å¯¹æ–¹æ˜¯å¦åˆæ³•ï¼Œå¦‚æŸ¥æ•°æ®åº“æˆ–æŸ¥å¯¹æ–¹å·ç 
- IPCP_options åŒ…å«`ç½‘é™…åè®®æ§åˆ¶åè®®`ï¼ˆIPCPï¼‰(PPPçš„ç½‘ç»œæ§åˆ¶åè®®æ¨¡å—)çš„å¿…è¦å‚æ•°ï¼Œå…è®¸åå•†ç†æƒ³çš„äº’è”ç½‘åè®®å‚æ•°ã€‚æœ‰å…³IPCPçš„è¯¦æƒ…ï¼Œè¯·å‚é˜…`RFC 1332`ã€‚
- PPP_authentication PPPè®¤è¯å‚æ•°ï¼ŒPAPã€CHAPã€EAPï¼Œ[è§æœ¬æ–‡](https://workos.com/blog/authentication-protocols-your-guide-to-the-basics)

  - PAP: æ˜æ–‡å¯†ç ä¼ è¾“ï¼Œå®¢æˆ·ç«¯å‘é€æ˜æ–‡ç”¨æˆ·åå¯†ç 
  - CHAPï¼šæœåŠ¡ç«¯å‘ä¸ªOTP(ç›¸å½“äºç›)ï¼Œå®¢æˆ·ç«¯ç”¨OTPå’Œå¯†ç è®¡ç®—å“ˆå¸Œå€¼ï¼ŒæŠŠæ˜æ–‡çš„ç”¨æˆ·åå’Œå“ˆå¸Œå€¼å‘é€æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ç”¨ç›¸åŒçš„OTPå’Œå¯†ç è®¡ç®—å“ˆå¸Œå€¼ï¼Œå¹¶æ¯”å¯¹ã€‚è¿‡ç¨‹ä¸­å¯†ç æ²¡æœ‰æ˜æ–‡ä¼ è¾“
  - EAP: æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€`èº«ä»½éªŒè¯è¯·æ±‚`ï¼ŒåŒ…æ‹¬å®ƒåº”ä½¿ç”¨çš„ `40 ç§`èº«ä»½éªŒè¯æ–¹æ³•ä¸­çš„å“ªä¸€ç§ã€‚å®¢æˆ·ç«¯æ ¹æ®è¯¥æ–¹æ³•åŠ å¯†ç”¨æˆ·åå¯†ç ï¼Œå‘é€ç»™æœåŠ¡ç«¯

### s4.9.6 SMTP setup (class_id = 46, version = 0)

å…è®¸ä½¿ç”¨ç®€å•é‚®ä»¶ä¼ è¾“åè®®(Simple Mail Transfer Protocolï¼ŒSMTP)åè®®ä¸è¿œç¨‹æœåŠ¡å™¨å»ºç«‹æ•°æ®äº¤æ¢

- server_port æœåŠ¡å™¨ç«¯å£ï¼Œ25/TCP,UDP
- user_name ç”¨æˆ·åï¼Œç™»å½•ç”¨
- login_password å¯†ç ï¼Œç™»é™†ç”¨
- server_address æœåŠ¡å™¨ip
- sender_address å‘é€è€…ipåœ°å€

### s4.9.7 NTP setup (class_id = 100, version = 0)

NTPåè®®æ—¶é—´åŒæ­¥

å±æ€§ï¼š

- activated NTPæ—¶é—´åŒæ­¥æ˜¯å¦æ¿€æ´»
- server_address NTPæœåŠ¡å™¨åœ°å€
- server_port ç«¯å£
- authentication_method è®¤è¯æ–¹å¼
- authentication_keys è®¤è¯å¯†é’¥æ•°ç»„
- client_key å®¢æˆ·ç«¯å¯†é’¥ï¼ŒNTPæœåŠ¡ç«¯å…¬é’¥ï¼ŒIFFæ–¹å¼

æ–¹æ³•ï¼š

- synchronize (data) åŒæ­¥æ—¶é—´
- add_authentication_key (data) æ·»åŠ authentication_key
- delete_authentication_key (data) åˆ é™¤authentication_key

### s4.9.8 CoAP setup (class_id = 152 version = 0)

å±æ€§ï¼š

- UDP_reference æŒ‡å‘`TCP-UDP setup`å¯¹è±¡,å’ŒUDPå±‚ç›¸å…³
- ack_timeout confirmableæ¶ˆæ¯çš„æœ€å°`åˆå§‹ACKè¶…æ—¶æ—¶é—´`
- ack_random_factor åˆå§‹ACKè¶…æ—¶æ—¶é—´ç”Ÿæˆ`éšæœºå› å­`ï¼Œåˆå§‹ACKè¶…æ—¶æ—¶é—´åœ¨ack_timeout - ack_timeout x ack_random_factor x 0.01ä¹‹é—´
- max_retransmit confirmableæ¶ˆæ¯çš„`æœ€å¤§é‡ä¼ æ¬¡æ•°`
- nstart åŒæ—¶æœªå®Œæˆçš„ä¸‹åˆ—å½¢å¼çš„CoAPè¯·æ±‚æ¶ˆæ¯çš„æ•°é‡:æœªæ”¶åˆ°CoAPç¡®è®¤çš„CON CoAPæ¶ˆæ¯æˆ–æœªæ”¶åˆ°CoAPå“åº”æ¶ˆæ¯çš„NON CoAPæ¶ˆæ¯ã€‚
- delay_ack_timeout CoAPæ¶ˆæ¯ä¼ é€’å±‚`ç­‰å¾…åº”ç”¨å±‚`è¿”å›å“åº”çš„æ—¶é—´(å•ä½ä¸ºms)ï¼Œç„¶åå®ƒå°†è¿”å›ç¡®è®¤ä»¥é˜²æ­¢æ¥è‡ªå¯¹ç­‰ä½“çš„è™šå‡é‡ä¼ ã€‚
- exponential_back_off

  é‡å‘å»¶è¿Ÿå› å­
  
  > nè¡¨ç¤ºç¬¬å‡ æ¬¡é‡å‘

  retransmission_delay = initial_ack_timeout x (exponential_back_off x 0.01) ^ (n -1)
- probing_rate å®šä¹‰ä¸€ä¸ªç«¯ç‚¹åœ¨å‘é€åˆ°å¦ä¸€ä¸ªæ²¡æœ‰å“åº”çš„ç«¯ç‚¹æ—¶`ä¸åº”è¶…è¿‡`çš„å¹³å‡æ•°æ®é€Ÿç‡(å­—èŠ‚/ç§’)ã€‚
- CoAP_uri_path uri-path
- transport_mode ä¼ è¾“æ–¹å¼

  - ä»…å¯é 
  - ä»…ä¸å¯é 
  - åŒæ—¶æ”¯æŒ
- version DLMS/COSEM CoAP wrapperçš„ç‰ˆæœ¬
- token_length tokené•¿åº¦ï¼ˆCoAPåè®®ä¸­çš„tokenï¼‰

### s4.9.9 CoAP diagnostic (class_id = 153, version = 0)

CoAPè¯Šæ–­

å±æ€§ï¼š

- messages_counter æŠ¥æ–‡è®¡æ•°
- request_response_counter CoAPè¯·æ±‚å“åº”çš„æŠ¥æ–‡è®¡æ•°
- coap_bt_counter CoAP Block-Wise transfer layer(å—ä¼ è¾“)ï¼Œå‘èµ·æ€»æ•°ï¼Œå®Œæˆæ€»æ•°ï¼Œè¶…æ—¶æ€»æ•°
- capture_time æ•è·æ—¶é—´ï¼ˆæœ€è¿‘æ›´æ–°æœ¬å¯¹è±¡ç›¸å…³å±æ€§çš„æ—¶é—´ï¼‰

æ–¹æ³•ï¼š

- reset (data) å…¨éƒ¨æ¸…ç©º

### s6.2.5 Clock objects (class_id = 8)

TODO:å¯¹å›¾çš„ç–‘é—®ã€‚è¡¨å†…æ—¶é—´å®é™…ä¸Šåªæœ‰ä¸€ä»½ï¼Œé€šè¿‡Dçš„ä¸åŒåŒºåˆ†ä¸åŒçš„è¡¨ç°å½¢å¼ã€‚è€Œä¸”å¯ä»¥ç”¨ä¸åŒçš„ç±»è¡¨ç¤ºã€‚è¯´æ˜obiså’Œclassé—´æ²¡æœ‰å¤ªå¤§çš„è”ç³»

### s6.2.17 Payment metering related objects

Cå†³å®šäº†å¤§çš„åŠŸèƒ½æ¨¡å—ï¼ŒDåŒºåˆ†è¿™ä¸ªåŠŸèƒ½æ¨¡å—éœ€è¦ç”¨åˆ°çš„æ•°æ®ï¼Œå¯ä»¥æ˜¯éš¶å±äºä¸åŒclassçš„ã€‚

å¦‚å›¾ï¼ŒC=19è¡¨ç¤ºpaymentç›¸å…³åŠŸèƒ½ï¼Œéœ€è¦ç”¨åˆ°æ¥è‡ª111ã€112ã€113ã€115ã€01ã€116ç±»çš„æ•°æ®

### 6.2.28 Objects for data exchange using narrow-band OFDM PLC for G3-PLC networks å’Œ 6.2.42 Device ID objects

ç»™å‡ºäº†ç›¸åŒçš„obiså¯¹åº”ä¸åŒçš„ç±»çš„æƒ…å†µ
