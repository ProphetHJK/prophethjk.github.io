---
title: "DLMS/COSEM Blue Bookå­¦ä¹ ç¬”è®°"
author: Jinkai
date: 2022-03-08 09:00:00 +0800
published: true
categories: [æŠ€æœ¯]
tags: [C++, DAO, database]
---

## shortname

`Short names`(`SN` referencing)ï¼šCOSEMå¯¹è±¡çš„æ¯ä¸ªå±æ€§å’Œæ–¹æ³•éƒ½ç”¨ä¸€ä¸ª`13ä½æ•´æ•°`æ ‡è¯†ã€‚çŸ­åç§°çš„è¯­æ³•ä¸DLMSå‘½åå˜é‡åç§°çš„è¯­æ³•ç›¸åŒã€‚ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨SNå¼•ç”¨è®¿é—®è®¾å¤‡ï¼Œä¸€äº›`short_name`è¢«ä¿ç•™ä¸ºç‰¹æ®ŠCOSEMå¯¹è±¡çš„`base_name(objectName)`ã€‚ä¿ç•™base_namesçš„èŒƒå›´æ˜¯0xFA00åˆ°0xFFF8ã€‚è¿™é‡Œçš„`base_name`å°±æ˜¯cosemå¯¹è±¡çš„`ä¸åŒ…å«åç§»`çš„çŸ­åï¼Œç›¸å½“äºè¡¨æ ¼ä¸­çš„xï¼Œå¯¹åº”æ¯ä¸ªå±æ€§çš„çŸ­åå«short_nameï¼Œæ˜¯åŒ…å«åç§»çš„

## 4.3.2 Register (class_id = 3, version = 0)

åŒ…å«å€¼ï¼ˆvalueï¼‰å’Œé‡çº²ï¼ˆscaler_unit,åŒ…æ‹¬ç²¾åº¦(scaler)ã€å•ä½ï¼ˆunit)ï¼‰

æ¸…é™¤æ–¹æ³•

## 4.3.3 Extended register (class_id = 4, version = 0)

åŒ…å«å€¼ã€é‡çº²ã€çŠ¶æ€ï¼ˆå‚å®¶è‡ªå®šä¹‰ï¼‰ã€å¯„å­˜å™¨æ•è·æ—¶é—´

æ¸…é™¤æ–¹æ³•

## 4.3.4 Demand register (class_id = 5, version = 0)

éœ€é‡å¯„å­˜å™¨

å‘¨æœŸæ€§æµ‹é‡æŸä¸ªå€¼å¾—åˆ°å½“å‰å¹³å‡å€¼ä¸ä¸Šæ¬¡å¹³å‡å€¼

E3è¡¨ç¤ºç¬¬ä¸‰ä¸ªå‘¨æœŸå†…çš„ç”µé‡å¢é‡,å‡è®¾å½“å‰æ—¶é—´å¤§äºE3ç»Ÿè®¡ç»“æŸæ—¶é—´ï¼ˆç¬¬ä¸‰å‘¨æœŸç»“æŸæ—¶é—´ï¼‰ï¼Œå°äºE4ç»Ÿè®¡ç»“æŸæ—¶é—´ï¼Œç”µé‡è®°å½•å€¼æ¯”E3ç»Ÿè®¡ç»“æŸæ—¶å¤§Î”e

- current_average_value å½“å‰å¹³å‡å€¼ï¼Œenergy/3t,energy=E2+E3+Î”e,t=period,3=å‘¨æœŸä¸ªæ•°
- last_average_value ä¸Šä¸€å¹³å‡å€¼ï¼Œenergy/3t,energy=E1+E2+E3,t=period,3=å‘¨æœŸä¸ªæ•°
- scaler_unit é‡çº²
- status çŠ¶æ€
- capture_time ä¸Šä¸€å¹³å‡å€¼è®¡ç®—æ—¶é—´
- start_time_current å½“å‰å¹³å‡å€¼ç»Ÿè®¡å¼€å§‹æ—¶é—´
- period å‘¨æœŸ
- number_of_periods å‘¨æœŸä¸ªæ•°ï¼Œç”¨äºä¸Šä¸€å¹³å‡å€¼è®¡ç®—ï¼Œä¸º1è¡¨ç¤ºåŒºé—´å¼(block)ï¼Œå¤§äº1è¡¨ç¤ºæ»‘å·®å¼(sliding)

æ–¹æ³•ï¼š

- reset (data) æ¸…é™¤
- next_period (data) è¯¥æ–¹æ³•ç”¨äºè§¦å‘ä¸€ä¸ªæ—¶é—´æ®µçš„æ­£å¸¸ç»ˆæ­¢(å’Œé‡æ–°å¯åŠ¨)ã€‚å…³é—­(ç»ˆæ­¢)å½“å‰æµ‹é‡å‘¨æœŸã€‚æ›´æ–°capture_timeå’Œstart_timeï¼Œæ‹·è´current_average_valueåˆ°last_average_valueï¼Œè®¾ç½®current_average_valueä¸ºé»˜è®¤å€¼ã€‚å¼€å§‹ä¸‹ä¸€ä¸ªæµ‹é‡å‘¨æœŸã€‚

## 4.3.5 Register activation (class_id = 6, version = 0)

- register_assignment å¯„å­˜å™¨åˆ—è¡¨ï¼ŒåŒ…æ‹¬Registerâ€,â€œExtended registerâ€ or â€œDemand registerâ€ç­‰çš„ç±»idå’ŒOBIS
- mask_list æ ‡è®°åˆ—è¡¨ï¼Œæœ‰å¤šä¸ªregister_act_maskï¼Œæ¯ä¸ªregister_act_maskåŒ…å«å”¯ä¸€çš„mask_nameï¼Œæ¯ä¸ªregister_act_maskä¸­çš„index_listä¸­çš„å€¼é¡ºåºä¸register_assignmentä¸­çš„å¯¹è±¡é¡ºåºä¸€ä¸€å¯¹åº”ï¼ŒTODO:ç¤ºä¾‹
- active_mask æ¿€æ´»çš„æ ‡è®°ï¼Œmask_listä¸­çš„æŸä¸ªæ ‡è®°ï¼Œä½¿ç”¨mask_nameå†³å®šï¼Œç”¨äºè¡¨ç¤ºå½“å‰å¯ç”¨çš„maskï¼Œè¿›ä¸€æ­¥è¡¨ç¤ºå¯ç”¨çš„register

æ–¹æ³•ï¼š

- add_register (data) å‘register_assignmentä¸­æ·»åŠ ä¸€ä¸ªé¡¹ï¼Œæ·»åŠ åœ¨æ•°ç»„å°¾éƒ¨
- add_mask (data) æ·»åŠ æˆ–æ›´æ–°mask_list
- delete_mask (data) ä»mask_liståˆ é™¤ä¸€ä¸ªmaskï¼Œä½¿ç”¨mask_name

## 4.3.6 Profile generic (class_id = 7, version = 1)

æ›²çº¿åŒ…å«æ•è·å¯¹è±¡ï¼Œå¯é€šè¿‡å€¼çš„èŒƒå›´æˆ–è¾“å…¥èŒƒå›´æ£€ç´¢èŒƒå›´å†…æ‰€æœ‰è®°å½•

æ•è·å¯¹è±¡åˆ—è¡¨å®šä¹‰äº†è¦ä¿å­˜åœ¨bufferä¸­çš„å€¼ï¼Œåˆ—è¡¨æ˜¯é™æ€çš„ï¼Œä¿è¯æ¯ä¸ªè®°å½•éƒ½æ‹¥æœ‰ç›¸åŒçš„é•¿åº¦å’Œç»“æ„

ä¿®æ”¹æ•è·åˆ—è¡¨å¿…é¡»æ¸…ç©ºæ‰€æœ‰æ‰€æœ‰bufferä¸­è®°å½•ï¼Œbufferè¢«å…¶ä»–profileä½¿ç”¨ä¹Ÿå¿…é¡»æ¸…ç©ºbufferã€‚TODO:å«ä¹‰ï¼Ÿ

è®°å½•å¯ä»¥æŒ‰æŸä¸ªå­—æ®µè¿›è¡Œæ’åºï¼Œå¦‚æ—¶é—´ï¼Œæˆ–æ˜¯æŒ‰å…ˆè¿›åå‡ºçš„æ ˆçš„æ–¹å¼æ’åºã€‚ä¾‹ï¼ŒæŒ‰ç…§Demand registerä¸­çš„last_average_valueå€¼æ¥ä»å°åˆ°å¤§æ’åºè·å¾—æœ€å¤§éœ€é‡register

### æ›²çº¿æ•°æ®å¤§å°é™åˆ¶å‚æ•°

- è®°å½•æ•°
- æœ€å¤§ä¿ç•™æ¡æ•°ã€‚å½“è®°å½•æ•°æ»¡æ—¶ï¼Œæ–°æ•è·æ•°æ®ä¼šè¦†ç›–æœ€ä¸é‡è¦çš„ä¸€æ¡æ•°æ®ï¼Œé‡è¦åº¦æ ¹æ®æ’åºæ–¹å¼è·å¾—ï¼Œå¦‚æ ¹æ®æ—¶é—´æ’åºï¼Œæœ€ä¸é‡è¦çš„æ•°æ®å°±æ˜¯æœ€æ—¶é—´æœ€æ—©çš„æ•°æ®
- ç¼“å†²åŒºç‰©ç†é™åˆ¶

### é€‰æ‹©æ€§è®¿é—®

- æŒ‰ç…§å€¼çš„èŒƒå›´ï¼š

    å€¼å¯ä»¥æ˜¯æ—¶é—´ï¼Œæˆ–æ˜¯æŸä¸ªæ•è·å¯¹è±¡çš„å€¼

- æŒ‰ç…§æ’åºåè®°å½•å­˜å‚¨çš„é¡ºåºèŒƒå›´ï¼š

    å¦‚ä»ç¬¬ä¸€æ¡è®°å½•ï¼ˆé‡è¦æ€§æœ€é«˜ï¼‰åˆ°ç¬¬ä¸‰æ¡
    å¦‚ä»æŸä¸ªå€¼æœ€å¤§çš„è®°å½•åˆ°ç¬¬ä¸‰å¤§çš„è®°å½•ï¼Œéœ€è¦é‡æ–°ä¸´æ—¶æ’åº

### å±æ€§

- buffer åŒ…å«è®°å½•åºåˆ—ï¼Œæ¯ä¸ªè®°å½•åŒ…å«è‹¥å¹²æ•è·å¯¹è±¡
- capture_objects æ•è·å¯¹è±¡åˆ—è¡¨ï¼Œæ•°ç»„å½¢å¼
- capture_period è‡ªåŠ¨æ•è·å‘¨æœŸï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œå¤§äº1è¡¨ç¤ºè¾¾åˆ°å‘¨æœŸæ•è·ï¼Œç­‰äº0è¡¨ç¤ºä¸è‡ªåŠ¨æ•è·ï¼Œéœ€è¦æ‰‹åŠ¨è§¦å‘
- sort_method æ’åºæ–¹å¼ï¼Œé»˜è®¤ä¸ºå…ˆè¿›å…ˆå‡ºæ’åºã€‚å¦‚æœprofileå·²ç»æ’åºï¼Œæ’å…¥æ–°çš„è®°å½•æ—¶ï¼Œå°†è®°å½•æ’å…¥é€‚å½“ä½ç½®ï¼Œç§»åŠ¨è¯¥ä½ç½®ä¹‹åæ‰€æœ‰è®°å½•ï¼Œæœ€ä¸é‡è¦è®°å½•å¯èƒ½åœ¨bufferæ»¡åä¸¢å¤±ã€‚å¦‚æœæ–°è®°å½•çš„é‡è¦åº¦æœ€ä½ä¸”bufferå·²æ»¡ï¼Œåˆ™è¯¥è®°å½•ä¸æ’å…¥
- sort_object æ’åºä¾æ®ï¼ˆå¯¹è±¡ï¼‰
- entries_in_use å½“å‰è®°å½•æ€»æ•°
- profile_entries è®°å½•ä¸Šé™

### æ–¹æ³•

reset (data) æ¸…ç©ºbufferï¼Œentries_in_useæ¸…é›¶ï¼Œå…¶ä»–é…ç½®ä¸å˜
capture (data) æ‰‹åŠ¨è§¦å‘æ•è·ï¼Œè¯»å–æ¯ä¸ªæ•è·å¯¹è±¡çš„å€¼ï¼Œç”Ÿæˆè®°å½•æ’å…¥buffer,åŒæ ·ä¸ä¼šæ”¹å˜æ•è·å¯¹è±¡åˆ—è¡¨

### ä¿®æ”¹æ•è·å¯¹è±¡åˆ—è¡¨åè¡Œä¸º

è°ƒç”¨ä½¿ç”¨äº†è¯¥æ•è·å¯¹è±¡åˆ—è¡¨çš„profileçš„resetæ“ä½œ

### é™åˆ¶

å®šä¹‰æ•è·å¯¹è±¡åˆ—è¡¨æ—¶ï¼Œé¿å…ç›¸äº’æˆ–å¾ªç¯å¼•ç”¨ã€‚TODO:å®ä¾‹ï¼Ÿ

## 4.3.7 Utility tables (class_id = 26, version = 0)

å…è®¸å°è£… ANSI C12.19:2012 table æ•°æ® TODO:è¿™æ˜¯ä»€ä¹ˆï¼Ÿ

## 4.3.8 Register table (class_id = 61, version = 0)

å¯¹åŒæ„æ¡ç›®ã€å¤šä¸ªå¯¹è±¡çš„ç›¸åŒå±æ€§è¿›è¡Œåˆ†ç»„ï¼Œè¿™äº›å¯¹è±¡éƒ½æ˜¯ç›¸åŒICçš„å®ä¾‹,å¹¶ä¸”åœ¨å®ƒä»¬çš„logical_name (OBISä»£ç )ä¸­ï¼Œå€¼ç»„Aåˆ°Då’ŒFä¸­çš„å€¼æ˜¯ç›¸åŒçš„ã€‚

å±æ€§ï¼š

logical_name å½“é€»è¾‘åä¸ºA.B.C.D.255.Fæ—¶ï¼Œåªæ•è·ä¸€ä¸ªå±æ€§ï¼Œå¦‚valueã€‚å½“é€»è¾‘åä¸ºA.B.98.10.X.255æ—¶ï¼Œå¯ä»¥æ•è·æœ‰å…³å¯¹è±¡çš„ä¸åŒå±æ€§
table_cell_values ä¿å­˜æ•è·å±æ€§çš„å€¼ï¼Œå¯å‹ç¼©
table_cell_definition Class_idå®šä¹‰æ•è·å±æ€§çš„å¯¹è±¡çš„å…¬å…±Class_id;logical_nameåŒ…å«å¯¹è±¡çš„é€šç”¨é€»è¾‘åï¼ŒE = 255(é€šé…ç¬¦);group_E_valuesåŒ…å«å•å…ƒæ ‡è¯†ç¬¦åˆ—è¡¨ï¼Œç±»å‹ä¸ºunsignedï¼Œåœ¨DLMS UA 1000-1 Ed 15 Part 1:2021çš„ç›¸åº”è¡¨ä¸­å®šä¹‰;Attribute_indexæ˜¯æŒ‡å‘å¯¹è±¡å†…å±æ€§çš„æŒ‡é’ˆã€‚Attribute_index 0è¡¨ç¤ºæ‰€æœ‰å…¬å…±å±æ€§ã€‚
scaler_unit é‡çº²ï¼Œå½“â€œRegisterâ€æˆ–â€œExtended Registerâ€å¯¹è±¡çš„â€œvalueâ€å±æ€§è¢«æ•è·æ—¶ï¼Œscaler_unitåº”ä¸ºæ‰€æœ‰å¯¹è±¡çš„å…¬å…±å±æ€§ã€‚å¦‚æœæ˜¯å…¶ä»–å±æ€§æˆ–æ˜¯å…¶ä»–ICï¼Œåˆ™è¯¥å±æ€§æ— ç”¨ä¸”ç¦æ­¢è®¿é—®

æ–¹æ³•ï¼š

reset (data) æ¸…ç©ºtable_cell_values
capture (data) æ•è·ï¼Œå°†åŸICå¯¹è±¡ä¸­çš„å€¼æ‹·è´åˆ°table_cell_valuesä¸­ï¼Œå¦‚æœtable_cell_definitionä¸­çš„attribute_indexä¸º0ï¼Œåˆ™æ•è·æ‰€æœ‰å±æ€§

table_cell_definitionè¢«å†™å…¥æ—¶çš„åŠ¨ä½œï¼š

è‡ªåŠ¨è°ƒç”¨resetæ–¹æ³•ï¼Œå¦‚æœéœ€è¦æ•è·çš„å±æ€§çš„å ç”¨ç©ºé—´è¿‡å¤§ï¼Œtable_cell_definitionçš„å†™å…¥ä¼šè¢«æ‹’ç»

## 4.3.9 Status mapping (class_id = 63, version = 0)

è¯¥ICå…è®¸å°†çŠ¶æ€å­—ä¸­çš„ä½æ˜ å°„åˆ°å¼•ç”¨è¡¨ä¸­çš„é¡¹ã€‚

- status_word çŠ¶æ€å­—ï¼Œn*8æ¯”ç‰¹ï¼Œæœ€å¤§65536æ¯”ç‰¹
- mapping_table åŒ…å«status_wordåˆ°å¼•ç”¨è¡¨ä¸­ä½ç½®çš„æ˜ å°„ã€‚
  - ref_table_id è¡¨ç¤ºå¼•ç”¨è¡¨çš„id
  - ref_table_mappingé€‰æ‹©long-unsignedï¼šè¯¥å€¼å¯¹åº”å¼•ç”¨è¡¨ä¸­çš„ä¸€æ¡è®°å½•ï¼Œè¯¥è®°å½•å¯¹åº”status_wordä¸­çš„ç¬¬ä¸€ä½ï¼Œè¯¥è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•å¯¹åº”status_wordä¸­çš„ç¬¬äºŒä½ï¼Œç›´åˆ°status_wordçš„æœ€åä¸€ä½

  å‡è®¾status_wordä¸º10000001ï¼Œlong-unsignedå€¼ä¸º3

  |status_wordä½å€¼|å¼•ç”¨è¡¨ç´¢å¼•|
  |:---:|:---:|
  |1|3|
  |0|4|
  |0|5|
  |...|...|
  |1|10|
  - ref_table_mappingé€‰æ‹©arrayï¼šarrayä¸­çš„æ¯ä¸ªå€¼å¯¹åº”å¼•ç”¨è¡¨ä¸­çš„ä¸€æ¡è®°å½•ï¼Œæ¯æ¡è®°å½•å¯¹åº”status_wordä¸­çš„å¯¹åº”ä½ï¼Œå¦‚arrayç¬¬ä¸€ä¸ªå€¼å¯¹åº”statusä¸­çš„ç¬¬ä¸€ä½ï¼Œæœ€åä¸€ä¸ªå€¼ä»£è¡¨æœ€åä¸€ä½

## 4.3.10 Compact data (class_id: 62, version = 1)

ç´§å‡‘æ•°æ®

Compactæ•°æ®ICçš„å®ä¾‹å…è®¸æ•è·ç”±capture_objectså±æ€§ç¡®å®šçš„COSEMå¯¹è±¡å±æ€§å€¼ã€‚æ•æ‰å¯ä»¥å‘ç”Ÿ:
    - åœ¨å¤–éƒ¨è§¦å‘å™¨ä¸Š(æ˜¾å¼æ•æ‰);
    - åœ¨è¯»å–compact_bufferå±æ€§æ—¶(éšå¼æ•è·)ã€‚

ç”±capture_methodå±æ€§ç¡®å®š

å€¼ä¿å­˜åœ¨compact_buffer attributeä¸­ï¼Œä»¥octet-stringå½¢å¼

è¿™ç»„æ•°æ®ç±»å‹ç”±template_idå±æ€§æ ‡è¯†ã€‚æ•è·çš„æ¯ä¸ªå±æ€§çš„æ•°æ®ç±»å‹ç”±template_descriptionå±æ€§ä¿å­˜ã€‚

å®¢æˆ·ç«¯å¯ä»¥ç”¨æœªå‹ç¼©çš„å½¢å¼é‡æ–°æ„é€ æ•°æ®(è§£å‹)ï¼Œå³åŒ…æ‹¬COSEMå±æ€§æè¿°ç¬¦ã€æ•°æ®ç±»å‹å’Œä½¿ç”¨capture_objectsã€template_idå’Œtemplate_descriptionå±æ€§çš„æ•°æ®å€¼ã€‚

å±æ€§ï¼š

- compact_buffer æ•è·çš„å±æ€§çš„å€¼ï¼Œoctet-stringå½¢å¼ï¼Œå½“ç±»å‹ä¸ºoctet-string, bit-string, visible-string, utf8-string or arrayæ—¶ï¼Œé•¿åº¦ä¹ŸåŒ…å«åœ¨å†…
- capture_objects æŒ‡å®šåˆ†é…ç»™â€œCompact dataâ€å¯¹è±¡å®ä¾‹çš„`COSEMå¯¹è±¡å±æ€§åˆ—è¡¨`ï¼Œä¸¤ç§é€‰æ‹©æ€§è®¿é—®æ–¹å¼ï¼š
  - `ç›¸å¯¹é€‰æ‹©æ€§è®¿é—®`ï¼šç›¸å¯¹å½“å‰çš„æ—¥æœŸæˆ–å½“å‰çš„è®°å½•è¿”å›è®°å½•ï¼Œç”±data_indexå…ƒç´ æ§åˆ¶
  - `ç»å¯¹é€‰æ‹©æ€§è®¿é—®`ï¼šæ ¹æ®æ˜ç¡®çš„æ—¶é—´èŒƒå›´æˆ–è®°å½•èŒƒå›´è¿”å›è®°å½•ï¼Œç”±restriction_elementæ§åˆ¶ï¼Œåˆ—ï¼ˆcolumnsï¼‰æ˜¯ç”±data_indexçš„MS byte(Most Significant byte,æ„ä¸ºæœ€é«˜æœ‰æ•ˆå­—èŠ‚)çš„ä½åŠå­—èŠ‚ï¼ˆå³è¾¹4ä½ï¼‰å†³å®šçš„

  |MS-Byte|MS-Byte|LS-Byte|
  |:---:|:---:|:---:|
  |Upper nibble|`Lower nibble`||
  |0000|0000|00000000|
  - data_index:æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒ`é€‰æ‹©`å…·æœ‰å¤æ‚æ•°æ®ç±»å‹(ç»“æ„æˆ–æ•°ç»„)çš„å±æ€§çš„ä¸€ä¸ªæˆ–å‡ ä¸ª`ç‰¹å®šå…ƒç´ `:
    - å¦‚æœå±æ€§çš„æ•°æ®ç±»å‹æ˜¯ç®€å•ç±»å‹ï¼Œåˆ™è¯¥å€¼æ— æ„ä¹‰
    - å¦‚æœå±æ€§çš„æ•°æ®ç±»å‹æ˜¯ç»“æ„ä½“æˆ–æ•°ç»„ï¼ˆéprofile genericå¯¹è±¡çš„bufferï¼‰ï¼Œåˆ™è¯¥å€¼æŒ‡å‘è¯¥ç»“æ„ä½“æˆ–æ•°ç»„ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å®šå…ƒç´ 
    - å¦‚æœå±æ€§çš„æ•°æ®ç±»å‹æ˜¯profile genericå¯¹è±¡çš„bufferï¼Œè¯¥å€¼åŒ…å«ç›¸å¯¹é€‰æ‹©æ€§è®¿é—®çš„å‚æ•°ï¼Œå¦‚å½“å‰æ—¥æœŸæˆ–è®°å½•
    - 0x0000 =æ ‡è¯†æ•´ä¸ªå±æ€§;
    - 0x0001åˆ°0x0FFF =æ ‡è¯†å¤æ‚å±æ€§ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚å¤æ‚å±æ€§ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ç”±data_index 1æ ‡è¯†;
    - 0x1000åˆ°0xFFFF =å¯¹ä¿å­˜Profile genericå¯¹è±¡çš„bufferçš„æ•°ç»„è¿›è¡Œç›¸å¯¹é€‰æ‹©æ€§è®¿é—®ã€‚æ•°æ®ç´¢å¼•é€‰æ‹©æœ€è¿‘(æœ€è¿‘)æ—¶é—´æ®µå†…çš„æ¡ç›®ï¼Œæˆ–æœ€è¿‘(æœ€è¿‘)æ¡ç›®å†…çš„æ¡ç›®ï¼Œä»¥åŠæ•°ç»„ä¸­çš„åˆ—ã€‚
    - å‚è€ƒTable 9 â€“ Encoding of selective access parameters with data_indexã€‚ä¾‹ï¼Œ0x830Cï¼ŒMS-Byteä¸­çš„é«˜4ä½ä¸º0x8ï¼Œè¡¨ç¤ºåŒ…æ‹¬å½“å‰å°æ—¶åœ¨å†…çš„æœ€åä¸€ä¸ªå®Œæ•´å°æ—¶æ•°ï¼Œä½4ä½ä¸º0x3ï¼Œè¡¨ç¤ºå‰3åˆ—ï¼ŒLS-Byteä¸º0x0C,è¡¨ç¤º12å°æ—¶ï¼Œç»¼ä¸Šï¼Œè¯¥å€¼è¡¨ç¤ºé€‰æ‹©æœ€å12ä¸ªå°æ—¶å†…çš„å‰3åˆ—æ•°æ®
  - restriction_elementï¼šå½“å±æ€§çš„æ•°æ®ç±»å‹æ˜¯profile genericå¯¹è±¡æ—¶ï¼Œè¯¥å€¼ç”¨äºè¡¨ç¤º`ç»å¯¹é€‰æ‹©æ€§è®¿é—®`çš„å‚æ•°ï¼Œæ—¶é—´èŒƒå›´ï¼Œè®°å½•åºå·èŒƒå›´ï¼Œ
    - æ­¤æ—¶çš„data_indexæ¡ä»¶ï¼š
      - MS Byteé«˜4ä½ä¸º0ï¼ˆä¸º1çš„è¯è¡¨ç¤ºç›¸å¯¹é€‰æ‹©æ€§è®¿é—®ï¼‰
      - MS Byteä½4ä½ä¸º0x0åˆ°0xF
      - Lower byteä¸º0
    - restriction_typeè¡¨ç¤ºé€‰æ‹©æ€§è®¿é—®çš„æ–¹å¼
    - restriction_valueè¡¨ç¤ºé€‰æ‹©æ€§è®¿é—®èŒƒå›´

- template_id åŒ…å«æ¨¡æ¿çš„`æ ‡è¯†ç¬¦`ã€‚å®ƒåº”å”¯ä¸€æ ‡è¯†â€œCompact dataâ€ICçš„å®ä¾‹å’Œ template_descriptionã€‚
- template_description æ¯ä¸ªè¢«æ•è·çš„å±æ€§çš„`æ•°æ®ç±»å‹`ï¼Œç”±æœåŠ¡ç«¯è‡ªåŠ¨ç”Ÿæˆï¼Œæ ¹æ®capture_objectsï¼ŒåŒ…å«ä»¥ä¸‹ç»“æ„ä½“ï¼š
  - ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯0x02ç»“æ„ä½“tag
  - åé¢æ˜¯æ•°é‡ï¼Œå˜é•¿ï¼Œå’Œcapture_objectsæ•°é‡ç›¸åŒ
  - åé¢æ˜¯æ¯ä¸ªå±æ€§çš„æ•°æ®ç±»å‹ï¼Œä¸capture_objectsä¸€ä¸€å¯¹åº”:
    - å¯¹äºå…·æœ‰ç®€å•æ•°æ®ç±»å‹çš„å±æ€§ï¼Œè¯¥å€¼ä¸€ä¸ªå­—èŠ‚ï¼ŒåŒ…å«ç±»å‹tagï¼Œå¦‚bit-string\[4\]
    - å¯¹äºarray\[1\]ï¼Œè¯¥å€¼ä¸º0x01ï¼Œåé¢æ˜¯å…ƒç´ çš„ç±»å‹ï¼ˆæ•°ç»„å†…æ‰€æœ‰å…ƒç´ éƒ½ç›¸åŒï¼Œæ‰€ä»¥å°±ä¸€ä¸ªï¼‰ã€‚ä¸è®°å½•æ•°ç›®æ˜¯å› ä¸ºcompact_bufferå·²ç»è®°å½•äº†
    - å¯¹äºstructure\[2\]ï¼Œè¯¥å€¼ä¸º0x02,åé¢æ˜¯å…ƒç´ æ•°ç›®ï¼Œåé¢æ˜¯æ¯ä¸ªå…ƒç´ çš„ç±»å‹
- capture_method å®šä¹‰compact_bufferæ›´æ–°çš„æ–¹å¼ï¼š
  - 0ï¼šåœ¨è°ƒç”¨Capture (data)æ–¹æ³•æ—¶æ•è·ã€‚è¿™å¯èƒ½å‘ç”Ÿåœ¨è¿œç¨‹æˆ–æœ¬åœ°(æ˜¾å¼æ•è·)
  - 1ï¼šè¯»å–compact_bufferå±æ€§æ—¶æ•è·(éšå¼æ•è·)

æ–¹æ³•ï¼š

- reset(data) ä»…æ¸…ç©ºcompact_buffer
- capture(data) å°†æ•è·å¯¹è±¡çš„å€¼å¡«å……è‡³compact_bufferä¸­ï¼Œ**ä¸ä¼šè§¦å‘æ•è·å¯¹è±¡å†…çš„ä»»ä½•å…¶ä»–æ“ä½œ**ï¼Œå¦‚capture()æˆ–reset()

å¯¹capture_objectsçš„ä»»ä½•ä¿®æ”¹ï¼Œå¿…é¡»`é‡ç½®`compact_bufferä»¥åŠ`è‡ªåŠ¨æ›´æ–°`template_description

## 4.4 Interface classes for access control and management

## 4.4.3 Association SN (class_id = 12, version = 4)

COSEM logical devicesèƒ½å¤Ÿåœ¨COSEM contextä¸­`ä½¿ç”¨SNå¼•ç”¨å»ºç«‹AAs`ï¼Œä½¿ç”¨â€œAssociation SNâ€ICçš„å®ä¾‹å»ºæ¨¡AAsã€‚ä¸€ä¸ªCOSEM logical deviceså¯ä»¥å¯¹`æ¯ä¸ª`è®¾å¤‡èƒ½å¤Ÿæ”¯æŒçš„`AA`æ‹¥æœ‰`ä¸€ä¸ª`è¯¥ICçš„`å®ä¾‹`ã€‚

å±æ€§ï¼š

- object_list å¯¹è±¡åˆ—è¡¨ï¼Œæ•°ç»„å½¢å¼ï¼ŒåŒ…å«base_name,class_id,version,logical_nameï¼Œbase_nameå®šä¹‰è§[æ–‡ç« å¼€å¤´](##shortname)
  >å®é™…è¿™é‡Œbase_nameå’Œlogical_nameçš„å«ä¹‰é‡å¤äº†ï¼Œä¸è¿‡base_nameæ˜¯æ˜¯ç”¨æ¥ä½œä¸ºå’Œaccess_rights_listå…³è”çš„å¤–é”®çš„

  TODO:logical_nameå’Œbase_nameé‡å¤äº†
- access_rights_list åŒ…å«å¯¹å±æ€§å’Œæ–¹æ³•çš„`æƒé™`ï¼Œæ•°ç»„å½¢å¼ï¼Œå’Œobject_listé—´é€šè¿‡`base_name`ç®¡ç†ï¼Œç›¸å½“äºå¤–é”®ï¼Œå…ƒç´ æ•°é‡éœ€è¦ç›¸åŒï¼Œå…ƒç´ é¡ºåºæœ€å¥½ä¹Ÿç›¸åŒã€‚åŒ…å«base_nameï¼Œattribute_access(å¯é€‰)ï¼Œmethod_access(å¯é€‰)
  >object_listæ”¯æŒä»¥class_idï¼Œlogical_nameæˆ–base_nameä¸ºæ¡ä»¶é€‰æ‹©æ€§è®¿é—®ï¼Œaccess_rights_listæ”¯æŒä»¥base_nameä¸ºæ¡ä»¶é€‰æ‹©æ€§è®¿é—®
- security_setup_reference å¼•ç”¨`Security setup`çš„logical_nameï¼Œè¢«å¼•ç”¨çš„å¯¹è±¡ç®¡ç†ç»™å®šçš„"Association SN"å¯¹è±¡å®ä¾‹çš„å®‰å…¨æ€§
- user_list `å…è®¸ä½¿ç”¨`æœ¬å¯¹è±¡ç®¡ç†çš„`AA`çš„ç”¨æˆ·åˆ—è¡¨
  - user_idè¡¨ç¤ºuserçš„idï¼ˆ`AARQ`ä¸­çš„`calling-AE-invocation-id`æºå¸¦ï¼‰
  - user_nameæ˜¯ç”¨æˆ·çš„åå­—

  >å¦‚æœæ•°ç»„`ä¸ºç©º`ï¼Œåˆ™`ä»»ä½•ç”¨æˆ·`éƒ½èƒ½ä½¿ç”¨AAï¼›å¦‚æœæ•°ç»„ä¸ä¸ºç©ºï¼Œåˆ™ä»…æœ‰åˆ—è¡¨å†…ç”¨æˆ·å¯ä»¥å»ºç«‹AAï¼Œä¹Ÿå°±æ˜¯AARQä¸­çš„calling-AE-invocation-idå­—æ®µå¿…é¡»åŒ¹é…åˆ—è¡¨ä¸­çš„user_idã€‚

  ```asn.1
    array user_list_entry
    user_list_entry ::= structure
    {
        user_id:    unsigned,
        user_name   CHOICE {
                    visible-string  [10],
                    UTF-8-string    [12]
                    }
    }
  ```

- current_user å½“å‰ç”¨æˆ·ï¼Œè‹¥user_listä¸ºç©ºï¼Œè¯¥å€¼çš„user_idå’Œuser_nameéƒ½ä¸º0ï¼ˆç©ºï¼‰

æ–¹æ³•ï¼š

- read_by_logicalname (data) è¯»å–æŒ‡å®šå¯¹è±¡çš„å±æ€§å€¼ï¼Œå¯¹è±¡ç”±class_idå’Œlogical_nameæŒ‡å®šï¼Œattribute_indexè¡¨ç¤ºç´¢å¼•ï¼Œ0è¡¨ç¤ºå…¨éƒ¨å±æ€§ï¼Œ1è¡¨ç¤ºç¬¬ä¸€ä¸ªå±æ€§ã€‚å›å¤çš„æ•°æ®ç”±å±æ€§ç±»å‹å†³å®š
- change_secret (data) ä¿®æ”¹LLSå¯†ç æˆ–HLSå¯†é’¥ï¼ˆä¸åŒ…æ‹¬è®¤è¯ï¼‰ï¼Œå¯èƒ½åŒ…å«æ ¡éªŒä¿¡æ¯æˆ–æœ¬èº«è¢«åŠ å¯†ï¼ŒHLS with GMACè®¤è¯çš„å¯†é’¥ç”±Security setupç®¡ç†ã€‚
- reply_to_HLS_authentication (data) æ­¤æ–¹æ³•çš„`è¿œç¨‹è°ƒç”¨`å°†`æœåŠ¡ç«¯å¯¹å®¢æˆ·ç«¯`çš„`è´¨è¯¢`(change) f(`StoC`) çš„å®¢æˆ·ç«¯`ç§˜å¯†å¤„ç†çš„ç»“æœ`ä¼ é€’ç»™æœåŠ¡ç«¯ï¼Œä½œä¸ºé€šè¿‡å‚æ•°åŒ–è®¿é—®è°ƒç”¨çš„ Read.request åŸè¯­çš„æ•°æ®æœåŠ¡å‚æ•°

|æœåŠ¡ç«¯S|å®¢æˆ·ç«¯C|
|:---:|:---:|
|StoC->||
||<-f(StoC)åŠ å¯†å¤„ç†åçš„ç»“æœ|

dataæ•°æ®æ˜¯å®¢æˆ·ç«¯å¯¹æœåŠ¡ç«¯çš„å›å¤

TODOï¼šè¯·æ±‚å’Œå›å¤çš„æ•°æ®æ˜¯ä»€ä¹ˆ

å›åº”æ•°æ®ï¼š

å¦‚æœè®¤è¯è¢«æ¥å—ï¼Œåˆ™å“åº”ï¼ˆRead.confirm åŸè¯­ï¼‰åŒ…å« Result == OK å’ŒæœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è´¨è¯¢æœåŠ¡å™¨çš„ç§˜å¯†å¤„ç†ç»“æœï¼Œåœ¨ Read çš„æ•°æ®æœåŠ¡å‚æ•°ä¸­ f(CtoS) å“åº”æœåŠ¡ã€‚

dataæ•°æ®æ˜¯æœåŠ¡ç«¯å¯¹å®¢æˆ·çš„å›å¤

å¦‚æœè®¤è¯ä¸è¢«æ¥å—ï¼Œåˆ™è¿”å›non-OKå€¼ï¼Œä¸”ä¸åŒ…æ‹¬data

- add_user (data) å‘user_listæ·»åŠ ä¸€ä¸ªç”¨æˆ·
- remove_user (data) ä»user_listç§»é™¤ä¸€ä¸ªç”¨æˆ·

## 4.4.4 Association LN (class_id = 15, version = 3)

COSEM logical devicesèƒ½å¤Ÿä½¿ç”¨ LN å¼•ç”¨åœ¨ COSEM contextä¸­å»ºç«‹ AAï¼Œé€šè¿‡â€œAssociation LNâ€IC çš„å®ä¾‹å¯¹ AA å»ºæ¨¡ã€‚ ä¸€ä¸ª COSEM logical devicesä»¶å¯¹äºè¯¥å™¨ä»¶èƒ½å¤Ÿæ”¯æŒçš„æ¯ä¸ª AA éƒ½æœ‰ä¸€ä¸ªè¯¥ IC çš„å®ä¾‹ã€‚

å±æ€§ï¼š

- object_list åŒAssociation SNä¸­object_listå’Œaccess_rights_listçš„æ•´åˆ

  é€‰æ‹©æ€§è®¿é—®æ”¯æŒnull(æ‰€æœ‰),class_list,object_id_list,object_id(class_id+logical_name)
- associated_partners_id åŒ…å«COSEMå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯(é€»è¾‘è®¾å¤‡ï¼Œç‰©ç†è®¾å¤‡åŒ…å«è‹¥å¹²ä¸ªé€»è¾‘è®¾å¤‡)ï¼Œå±äºç”±Association LNå¯¹è±¡å»ºæ¨¡çš„AAã€‚å®¢æˆ·ç«¯èŒƒå›´ä¸º0x0-0x7F,æœåŠ¡ç«¯èŒƒå›´ä¸º0x0-0x3FFF
- application_context_name åœ¨COSEMç¯å¢ƒä¸­ï¼Œå¸Œæœ›é¢„å…ˆå­˜åœ¨ä¸€ä¸ª`application context`ï¼Œå¹¶åœ¨AAå»ºç«‹æœŸé—´é€šè¿‡å…¶åç§°å¼•ç”¨å®ƒã€‚æ­¤å±æ€§åŒ…å«è¯¥AAçš„application contextçš„åç§°ã€‚è§*Green Book 4.5.2 application context*ï¼Œ*9.4.2.2.2 The COSEM application context*ã€‚TODO:æŸ¥çœ‹æ–‡æ¡£
- xDLMS_context_info åŒ…å«å…³äºç»™å®šAAçš„`xDLMS context`çš„æ‰€æœ‰å¿…è¦ä¿¡æ¯
  - conformance element: åŒ…å«æœåŠ¡å™¨æ”¯æŒçš„xDLMSä¸€è‡´æ€§å—,TODO:ä¸€è‡´æ€§å—æ˜¯ä»€ä¹ˆã€‚ä½ä¸²çš„é•¿åº¦ä¸º24ä½;
  - max_receive_pdu_sizeï¼šåŒ…å«xDLMS APDUçš„`æœ€å¤§é•¿åº¦`ï¼Œå®¢æˆ·ç«¯å¯ä»¥å‘é€çš„å­—èŠ‚æ•°åœ¨AAè¿‡ç¨‹ä¸­åå•†ï¼Œå—xDLMS initiateResponse APDUçš„server-max-receive-pdu-sizeå‚æ•°çš„é™åˆ¶;
  - max_send_pdu_sizeï¼šåœ¨è¿™ä¸ªAAä¸­æœåŠ¡å™¨å¯ä»¥å‘é€çš„xDLMS APDUçš„`æœ€å¤§é•¿åº¦`ï¼Œä»¥å­—èŠ‚è¡¨ç¤ºã€‚å®ƒå—åˆ°xDLMS initiateRequest APDUçš„client-max-receive-pdu-sizeå‚æ•°çš„é™åˆ¶;
  - dlms_version_numberï¼šåŒ…å«æœåŠ¡ç«¯æ”¯æŒçš„DLMSç‰ˆæœ¬
  - quality_of_serviceï¼šæœªä½¿ç”¨
  - cyphering_infoï¼šåœ¨ä¸€ä¸ªæ´»åŠ¨çš„AAä¸­ï¼ŒåŒ…å«xDLMS initiateRequest APDUçš„ä¸“ç”¨å…³é”®å‚æ•°ï¼Œè§*GREEN BOOK 9.5*

- authentication_mechanism_name AAè®¤è¯æœºæ„åç§°
- secret LLSæˆ–HLSå¯†é’¥ï¼ŒåŒä¸ŠSN
- association_status AAå½“å‰çŠ¶æ€
- security_setup_reference å¼•ç”¨Security setupå¯¹è±¡çš„logical name.è¯¥å¯¹è±¡ç”¨äºç®¡ç†Association LNæœ¬å¯¹è±¡å®ä¾‹
- user_list åŒä¸ŠSN
- current_user åŒä¸ŠSN

æ–¹æ³•ï¼š

- reply_to_HLS_authentication (data) åŒä¸ŠSN
- change_HLS_secret (data) åŒä¸ŠSN
- add_object (data) åŒä¸ŠSN
- remove_object (data) åŒä¸ŠSN
- add_user (data) åŒä¸ŠSN
- remove_user (data) åŒä¸ŠSN

## SAP assignment (class_id = 17, version = 0)

è¯¥ IC å…è®¸é€šè¿‡æä¾›æœ‰å…³å°†é€»è¾‘è®¾å¤‡åˆ†é…ç»™å…¶ SAP çš„ä¿¡æ¯æ¥å¯¹ç‰©ç†è®¾å¤‡çš„é€»è¾‘ç»“æ„è¿›è¡Œå»ºæ¨¡ã€‚ å‚è§ DLMS UA 1000-2 Ed.11:2021ï¼Œç¬¬ 10 æ¡ã€‚

å±æ€§ï¼š

- SAP_assignment_list åŒ…å«ç‰©ç†è®¾å¤‡ä¸Šæ‰€æœ‰é€»è¾‘è®¾å¤‡å’Œä»–ä»¬çš„sap
  - é€»è¾‘è®¾å¤‡å
  - sap

æ–¹æ³•ï¼š

- connect_logical_device (data) å°†`é€»è¾‘è®¾å¤‡`è¿æ¥åˆ°SAPã€‚è¿æ¥åˆ°SAP 0å°†æ–­å¼€è®¾å¤‡è¿æ¥ã€‚ä¸€ä¸ªSAPä¸èƒ½è¿æ¥å¤šä¸ªè®¾å¤‡(SAP 0é™¤å¤–)ã€‚

  é€»è¾‘è®¾å¤‡ï¼šç‰©ç†è®¾å¤‡ä¸­çš„`æŠ½è±¡å®ä½“`ï¼Œè¡¨ç¤ºç”¨COSEMå¯¹è±¡å»ºæ¨¡çš„`åŠŸèƒ½å­é›†`

## 4.4.6 Image transfer (class_id = 18, version = 0)

å›¾åƒä¼ è¾“ICæ¨¡å‹çš„å®ä¾‹æ˜¯å°†`äºŒè¿›åˆ¶æ–‡ä»¶`(ç§°ä¸ºimage)ä¼ è¾“åˆ°`COSEMæœåŠ¡å™¨`çš„è¿‡ç¨‹ã€‚

æ­¥éª¤1ï¼š(å¯é€‰)è·å–ImageBlockSize
æ­¥éª¤2ï¼šå®¢æˆ·ç«¯å¯åŠ¨é•œåƒä¼ è¾“
æ­¥éª¤3ï¼šå®¢æˆ·ç«¯ä¼ è¾“imageBlocks
æ­¥éª¤4ï¼šå®¢æˆ·ç«¯æ£€æŸ¥ç¡®è®¤ä¼ è¾“å®Œæˆ
æ­¥éª¤5ï¼šæœåŠ¡ç«¯æ ¡éªŒé•œåƒå®Œæ•´æ€§ï¼ˆå®¢æˆ·ç«¯å‘èµ·æˆ–æœåŠ¡ç«¯è‡ªè¡Œå®Œæˆï¼‰
æ­¥éª¤6ï¼šï¼ˆå¯é€‰ï¼‰å®¢æˆ·ç«¯æ£€æŸ¥è¦æ¿€æ´»çš„å›¾åƒä¸Šçš„ä¿¡æ¯
æ­¥éª¤7ï¼šæœåŠ¡ç«¯æ¿€æ´»é•œåƒï¼ˆå®¢æˆ·ç«¯å‘èµ·æˆ–æœåŠ¡ç«¯è‡ªè¡Œå®Œæˆï¼‰

å±æ€§ï¼š

- image_block_size ä¿å­˜ImageBlockSizeï¼Œä¸€ä¸ªé•œåƒè¢«åˆ†ä¸ºè‹¥å¹²å—ï¼Œè¿™é‡Œæ˜¯æ¯ä¸ªå—å¤§å°ï¼Œç”¨å…«ä½å­—èŠ‚è¡¨ç¤ºï¼Œä¸èƒ½è¶…è¿‡åå•†çš„ServerMaxReceivePduSize
- image_transferred_blocks_status `ä½å›¾`ï¼Œæä¾›å…³äºæ¯ä¸ªImageBlockçš„ä¼ è¾“çŠ¶æ€çš„ä¿¡æ¯ã€‚bit-stringä¸­çš„æ¯ä¸€ä½æä¾›äº†ä¸€ä¸ªå•ç‹¬çš„ImageBlockçš„ä¿¡æ¯ï¼Œ0ä¸ºæœªä¼ è¾“ï¼Œ1ä¸ºå·²ä¼ è¾“ã€‚
- image_first_not_transferred_block_number ç¬¬ä¸€ä¸ªæœªä¼ è¾“çš„å—çš„ç¼–å·ï¼Œå¦‚æœä¼ è¾“å…¨éƒ¨å®Œæˆï¼Œè¯¥ç¼–å·åº”è¯¥ç­‰äºæˆ–å¤§äºimage_block_size
- image_transfer_enabled `æ§åˆ¶`æ˜¯å¦`å¯ç”¨`å›¾åƒä¼ è¾“`è¿‡ç¨‹`ï¼Œåªæœ‰ç½®ä¸ºtrueæ‰èƒ½æ‰§è¡Œimage transferç›¸å…³æ–¹æ³•ï¼Œä¸ºfalseæ˜¯ç¦ç”¨æ‰€æœ‰æ–¹æ³•çš„æ‰§è¡Œï¼Œè¿”å›é”™è¯¯
- image_transfer_status `ä¼ è¾“çŠ¶æ€`
- image_to_activate_info æä¾›æœ‰å…³å‡†å¤‡`æ¿€æ´»çš„æ˜ åƒçš„ä¿¡æ¯`ã€‚è¿™æ˜¯ä¸€ä¸ª`æ•°ç»„`ï¼Œæ¯ä¸ªå¾…æ¿€æ´»çš„é•œåƒéƒ½æœ‰`ç‹¬ç«‹`ä¿¡æ¯ï¼Œå®ƒæ˜¯ä½œä¸ºå›¾åƒéªŒè¯è¿‡ç¨‹çš„ç»“æœç”Ÿæˆçš„ã€‚å®¢æˆ·ç«¯å¯ä»¥åœ¨æ¿€æ´»æ˜ åƒä¹‹å‰æ£€æŸ¥è¿™äº›ä¿¡æ¯ï¼ˆä»æœåŠ¡ç«¯çš„è¿™ä¸ªå±æ€§ä¸­è¯»å‡ºæ¥åæ£€æŸ¥ï¼‰ã€‚åŒ…æ‹¬`å¤§å°ã€æ ‡è¯†ï¼ˆidentificationï¼‰å’Œç­¾å`

æ–¹æ³•ï¼š

- image_transfer_initiate (data) `åˆå§‹åŒ–`ä¼ è¾“è¿‡ç¨‹ï¼Œå‚æ•°åŒ…æ‹¬identifierå’ŒImageSizeï¼ˆä¸æ˜¯image block sizeï¼‰ã€‚åœ¨æ­¤ä¹‹åï¼Œå°†image_transfer_statusï¼ˆä¼ è¾“çŠ¶æ€ï¼‰å±æ€§ç½®ä¸º1ï¼Œimage_first_not_transferred_block_numberç½®ä¸º0ï¼Œå¯¹äºè¯¥æ–¹æ³•çš„è°ƒç”¨ä¼šé‡ç½®æ•´ä¸ªä¼ è¾“æµç¨‹
- image_block_transfer (data) ä¼ `è¾“ä¸€ä¸ªå—`åˆ°æœåŠ¡ç«¯ï¼ŒåŒ…æ‹¬å—åºå·å’Œå—å†…å®¹ï¼Œä¹‹åå°†image_transferred_blocks_statuså¯¹åº”ä½ç½®1ï¼Œimage_first_not_transferred_block_numberæ›´æ–°
- image_verify (data) åœ¨æ¿€æ´»ä¹‹å‰éªŒè¯æ˜ åƒçš„å®Œæ•´æ€§(è§¦å‘æœåŠ¡ç«¯è‡ªæ ¡éªŒ)ã€‚

  è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„ç»“æœå¯èƒ½æ˜¯`successã€temporary_failure`æˆ–`other_reason`ã€‚å¦‚æœ`ä¸æˆåŠŸ`ï¼Œåˆ™å¯ä»¥é€šè¿‡æ£€ç´¢`image_transfer_status`å±æ€§çš„å€¼æ¥æ‰¾åˆ°éªŒè¯çš„ç»“æœã€‚

  å¦‚æœ`æˆåŠŸ`ï¼Œimage_to_activate_infoå±æ€§å°†ä¿å­˜è¦æ¿€æ´»çš„å›¾åƒçš„ä¿¡æ¯ã€‚
- image_activate (data) `æ¿€æ´»é•œåƒ`ã€‚

  å¦‚æœä¼ è¾“çš„Imageä¹‹å‰æ²¡æœ‰ç»è¿‡`éªŒè¯`ï¼ˆæ²¡æ‰§è¡Œimage_verifyï¼‰ï¼Œé‚£ä¹ˆè¿™å°†ä½œä¸ºImage_activateçš„ä¸€éƒ¨åˆ†å®Œæˆã€‚
  è°ƒç”¨æ­¤æ–¹æ³•çš„ç»“æœå¯èƒ½æ˜¯`æˆåŠŸ`ã€`æš‚æ—¶å¤±è´¥`æˆ–`å…¶ä»–åŸå› `ã€‚å¦‚æœä¸æ˜¯æˆåŠŸï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡æ£€ç´¢`image_transfer_status`å±æ€§çš„å€¼æ¥äº†è§£æ¿€æ´»çš„ç»“æœã€‚

å¦‚æœå®¢æˆ·ç«¯ä¸çŸ¥é“å›¾åƒä¼ è¾“ç›®æ ‡æœåŠ¡å™¨å¯ä»¥å¤„ç†çš„å›¾åƒå—çš„å¤§å°ï¼Œé‚£ä¹ˆåœ¨å¼€å§‹å¤„ç†ä¹‹å‰ï¼Œå®¢æˆ·ç«¯éœ€è¦è¯»å–å›¾åƒä¼ è¾“åˆ°çš„æ¯ä¸ªæœåŠ¡å™¨çš„ç›¸å…³â€œimage transferâ€å¯¹è±¡çš„`image_block_size`å±æ€§ã€‚å®¢æˆ·ç«¯å¯ä»¥ä¼ è¾“`åˆé€‚å¤§å°`çš„ImageBlocksã€‚

å¦‚æœå›¾åƒå—é€šè¿‡`å¹¿æ’­`å‘é€ç»™ä¸€ç»„COSEMæœåŠ¡ç«¯ï¼Œå›¾åƒå—å¤§å°åœ¨ç»„ä¸­çš„æ¯ä¸ªæˆå‘˜ä¸­åº”è¯¥æ˜¯ç›¸åŒçš„ã€‚

æ ¡éªŒä¸´æ—¶å¤±è´¥ä¸æ˜¯çœŸæ­£å¤±è´¥ï¼Œå¯èƒ½æ˜¯æ ¡éªŒè¿˜æœªå®Œæˆï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è·å–image_transfer_statuså±æ€§çš„å€¼æ¥æ£€æŸ¥ImageéªŒè¯çš„ç»“æœã€‚

æœåŠ¡ç«¯å†…å¯ä»¥ä¿å­˜å¤šä¸ªå¾…æ¿€æ´»çš„é•œåƒ

### Image transfer for M-Bus devices

## 4.4.7 Security setup (class_id = 64, version = 1)

â€œSecurity setupâ€ICçš„å®ä¾‹åŒ…å«æœ‰å…³æ­£åœ¨ä½¿ç”¨çš„`å®‰å…¨å¥—ä»¶(security suite)`çš„å¿…è¦ä¿¡æ¯ï¼Œä»¥åŠåœ¨å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¹‹é—´é€‚ç”¨çš„`å®‰å…¨ç­–ç•¥(security policy)`(ç”±å®ƒä»¬å„è‡ªçš„ç³»ç»Ÿæ ‡é¢˜æ ‡è¯†)ã€‚å®ƒä»¬è¿˜æä¾›äº†æé«˜å®‰å…¨æ€§çº§åˆ«å’Œç®¡ç†`å¯¹ç§°å¯†é’¥`ã€`éå¯¹ç§°å¯†é’¥å¯¹`å’Œ`è¯ä¹¦`çš„æ–¹æ³•

å±æ€§ï¼š

- security_policy `å®‰å…¨ç­–ç•¥`ï¼Œä½¿ç”¨å®‰å…¨å¥—ä»¶ä¸­å¯ç”¨çš„å®‰å…¨ç®—æ³•å¼ºåˆ¶èº«ä»½éªŒè¯å’Œ/æˆ–åŠ å¯†å’Œ/æˆ–æ•°å­—ç­¾åã€‚å®ƒç‹¬ç«‹åœ°åº”ç”¨äºè¯·æ±‚å’Œå“åº”ã€‚
- security_suite å®‰å…¨å¥—ä»¶ï¼Œæ˜ç¡®åŠ å¯†ç®—æ³•
  
  - (0) AES-GCM-128 authenticated encryption and AES-128 key wrap
  - (1) AES-GCM-128 authenticated encryption, ECDSA P-256 digital signature, ECDH P-256 key agreement, SHA-256 hash, V.44 compression and AES-128 key wrap
  - (2) AES-GCM-256 authenticated encryption, ECDSA P-384 digital signature, ECDH P-384 key agreement, SHA-384 hash, V.44 compression and AES-256 key wrap
  - (3) â€¦ (15) reserved
- client_system_title æºå¸¦ï¼ˆå½“å‰ï¼‰`å®¢æˆ·ç«¯`system titleï¼Œåœ¨å·²ç¡®è®¤æˆ–æœªç¡®è®¤çš„AAå»ºç«‹è¿‡ç¨‹ä¸­ï¼Œç”±AARQ APDUçš„calling-AP-titleå­—æ®µæ‰¿è½½;
- server_system_title æºå¸¦`æœåŠ¡ç«¯`çš„system_titleï¼Œåœ¨ç¡®è®¤AAå»ºç«‹æ—¶ï¼Œç”±AARE APDUçš„response-AP-titleå­—æ®µè¿›è¡Œ
- certificates æºå¸¦å¯ç”¨çš„X.509 v3`è¯ä¹¦ä¿¡æ¯`ï¼Œå¹¶å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­ã€‚æœåŠ¡ç«¯å¯ä»¥ä¿å­˜æœåŠ¡ç«¯è¯ä¹¦ã€æ¯ä¸ªå®¢æˆ·ç«¯çš„è¯ä¹¦ã€CAè¯ä¹¦ã€‚

æ–¹æ³•ï¼š

- security_activate (data) æ¿€æ´»å’Œ`åŠ å¼ºå®‰å…¨ç­–ç•¥`security_policyï¼Œæ–°çš„å€¼å®‰å…¨æ€§å¿…é¡»é«˜äºæˆ–ç­‰äºåŸå€¼ï¼Œä¹Ÿå°±æ˜¯åªèƒ½åŠ å¼ºï¼Œä¸èƒ½å‡å¼±
- key_transfer (data) ç”¨äº`ä¼ è¾“`ä¸€ä¸ªæˆ–å¤šä¸ª`å¯†é’¥`(EK,AK,BK,MK),åŒ…æ‹¬å¯†é’¥æ ‡è¯†å’Œå°è£…åçš„å¯†é’¥ï¼ˆkey wrappedï¼‰ã€‚å¯ä»¥æ˜¯æ•°ç»„ï¼Œä¸€æ¬¡å¤šä¸ªå¯†é’¥ã€‚`key wrap`ç®—æ³•ç”±åŠ å¯†å¥—ä»¶æŒ‡å®š
- key_agreement (data) ç”¨äºä½¿ç”¨å®‰å…¨å¥—ä»¶æŒ‡å®šçš„`å¯†é’¥åå•†ç®—æ³•`å¯¹ä¸€ä¸ªæˆ–å¤šä¸ª`å¯¹ç§°å¯†é’¥`è¾¾æˆä¸€è‡´ã€‚åœ¨å¥—ä»¶1å’Œå¥—ä»¶2çš„æƒ…å†µä¸‹ï¼ŒECDHå¯†é’¥åå•†ç®—æ³•ä¸ä¸´æ—¶ç»Ÿä¸€æ¨¡å‹(Ephemeral Unified Model) C(2e, 0s, ECC CDH)æ–¹æ¡ˆä¸€èµ·ä½¿ç”¨ã€‚
- generate_key_pair (data) æ ¹æ®`å®‰å…¨å¥—ä»¶`çš„è¦æ±‚ç”Ÿæˆ`éå¯¹ç§°å¯†é’¥å¯¹`ã€‚data`å‚æ•°`æ ‡è¯†è¦ç”Ÿæˆçš„å¯†é’¥å¯¹çš„`ç”¨æ³•`:
  - digital signature key pair æ•°å­—ç­¾å
  - key agreement key pair å¯†é’¥åå•†
  - TLS key pair TLSé€šä¿¡

  ä»¥ä¸Šæ¯ä¸ªç”¨æ³•çš„å¯†é’¥å¯¹æœ€å¤šåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯æœ€å¤šæœ‰ä¸‰ä¸ªå¯†é’¥å¯¹
- generate_certificate_request (data) å½“è°ƒç”¨æ­¤æ–¹æ³•æ—¶ï¼ŒæœåŠ¡å™¨å‘é€`è¯ä¹¦ç­¾åè¯·æ±‚`(`CSR`)æ•°æ®ï¼Œè¿™æ˜¯CAä¸ºæœåŠ¡å™¨å…¬é’¥ç”Ÿæˆè¯ä¹¦æ‰€å¿…éœ€çš„ã€‚dataå‚æ•°ä¸ºè¯·æ±‚è¯ä¹¦çš„å¯†é’¥å¯¹ç±»å‹

  å“åº”ä¸ºCSRæ•°æ®ï¼ŒPKCS #10æ ¼å¼DERç¼–ç çš„octet-string
- import_certificate (data) `å¯¼å…¥X.509 V3æ ¼å¼è¯ä¹¦`ï¼ŒDERç¼–ç octet-stringï¼Œæ— éœ€æŒ‡å®šç±»å‹ï¼ŒTODOï¼šå¦‚ä½•åŒºåˆ†è¯ä¹¦ç±»å‹,è‡ªåŠ¨è¯†åˆ«ï¼Ÿ
- export_certificate (data) `å¯¼å‡ºè¯ä¹¦`ï¼Œæ ¹æ®ç±»å‹æˆ–åºåˆ—å·
- remove_certificate (data) `ç§»é™¤è¯ä¹¦`ï¼Œå‚æ•°åŒä¸Šå¯¼å‡ºè¯ä¹¦

## 4.4.8 Push interface class

åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒDLMSæ¶ˆæ¯å¯ä»¥åœ¨æ²¡æœ‰æ˜ç¡®è¯·æ±‚çš„æƒ…å†µä¸‹â€œ`æ¨é€`â€åˆ°ç›®çš„åœ°ï¼Œä¾‹å¦‚:

- å¦‚æœæœ¬åœ°ç›‘æ§çš„å€¼`è¶…è¿‡é˜ˆå€¼`;
- ç”±`æœ¬åœ°äº‹ä»¶`è§¦å‘(å¦‚å¼€æœº/å…³æœºï¼ŒæŒ‰ä¸‹æŒ‰é’®ï¼Œä»ªè¡¨ç›–æ‰“å¼€)ã€‚

DLMS/COSEMæ¨é€æœºåˆ¶éµå¾ª`å‘å¸ƒ/è®¢é˜…`æ¨¡å¼ã€‚

åœ¨DLMS/COSEMä¸­ï¼Œå‘å¸ƒæ˜¯ç”±â€œAssociationâ€å¯¹è±¡çš„object_listå±æ€§å»ºæ¨¡çš„ï¼Œè¯¥å±æ€§æä¾›äº†ç»™å®šAAä¸­å¯è®¿é—®çš„COSEMå¯¹è±¡åˆ—è¡¨å’Œå®ƒä»¬çš„å±æ€§ã€‚è®¢é˜…æ˜¯é€šè¿‡ç¼–å†™â€œPush setupâ€å¯¹è±¡çš„é€‚å½“å±æ€§æ¥å»ºæ¨¡çš„ã€‚ä½¿ç”¨xDLMS DataNotificationæœåŠ¡(åœ¨æŒ‡å®šçš„è§¦å‘å™¨ä¸Š)å‘é€æ‰€éœ€çš„æ•°æ®ã€‚

## 4.4.8.2 Push setup (class_id = 40, version = 3)

"Push setup"ICåŒ…å«è¦æ¨é€çš„`COSEMå¯¹è±¡å±æ€§`çš„`å¼•ç”¨åˆ—è¡¨`ã€‚å®ƒè¿˜åŒ…å«æ¨é€`ç›®çš„åœ°`å’Œ`æ–¹æ³•`ï¼Œä»¥åŠ`é€šä¿¡æ—¶é—´çª—å£`å’Œ`é‡è¯•å¤„ç†`

Pushåœ¨*push*æ–¹æ³•è¢«è°ƒç”¨æ—¶å¯åŠ¨ï¼Œç”±`push *Single action schedule*å¯¹è±¡`ã€`alarm *Register monitor*å¯¹è±¡`ã€`ä¸“ç”¨çš„å†…éƒ¨äº‹ä»¶`æˆ–`å¤–éƒ¨äº‹ä»¶`è§¦å‘ã€‚pushæ“ä½œè¢«`è§¦å‘`åï¼Œæ ¹æ®ç»™å®šçš„`push setup`å¯¹è±¡ä¸­çš„è®¾ç½®æ‰§è¡Œã€‚æ ¹æ®`é€šä¿¡çª—å£`çš„è®¾ç½®ï¼Œpushä¼šåœ¨`éšæœºå»¶è¿Ÿ`åç«‹å³æ‰§è¡Œï¼Œæˆ–è€…åœ¨é€šä¿¡çª—å£æ¿€æ´»åç«‹å³æ‰§è¡Œã€‚å¦‚æœpushä¸æˆåŠŸï¼Œåˆ™ä¼š`é‡è¯•`ã€‚é‡è¯•å¯èƒ½åœ¨æç¤ºæ”¯æŒåè®®å±‚å¤±è´¥æˆ–ç¼ºå°‘ç¡®è®¤æ—¶å‘ç”Ÿã€‚

å±æ€§ï¼š

- push_object_list å®šä¹‰è¦æ¨é€çš„`å±æ€§åˆ—è¡¨`ï¼Œåœ¨è°ƒç”¨`push (data)`æ–¹æ³•æ—¶ï¼Œå†…å®¹è¢«å‘é€åˆ°`send_destination_and_method`å±æ€§ä¸­å®šä¹‰çš„ç›®æ ‡ã€‚
  - class_id ç±»
  - logical_name å¯¹è±¡
  - attribute_index å±æ€§åºå·ï¼Œ0è¡¨ç¤ºå…¨éƒ¨ï¼Œå¦‚æœattribute_indexæ˜¯0ï¼Œåˆ™data_indexä¸º0ä¸”æ— æ„ä¹‰ï¼Œå…¶ä»–å€¼ä¹Ÿä¸ºç©ºæˆ–null
  - data_index å½“å±æ€§æ˜¯æ•°ç»„æˆ–ç»“æ„ä½“æ—¶(é™¤profile generic)ï¼Œ0è¡¨ç¤ºæ‰€æœ‰å…ƒç´ ï¼Œ0x0001-0x0FFFè¡¨ç¤ºå…ƒç´ åºå·ï¼Œå…¶ä»–å€¼ä¸ºç©ºæˆ–null
  - restriction,columns å½“å±æ€§æ˜¯profile genericå¯¹è±¡çš„æ—¶ï¼Œå’Œdata_indexä¸€èµ·è¡¨ç¤ºé€‰æ‹©æ€§è®¿é—®å‚æ•°

  æºå¸¦æ¨é€æ•°æ®çš„`DataNotification APDU`å—åˆ°*å®‰å…¨å¥—ä»¶suit*ã€*å®‰å…¨ç­–ç•¥policy*å’Œ*å®‰å…¨ææ–™material*çš„ä¿æŠ¤ï¼Œè¿™äº›å®‰å…¨é…ç½®åŒ…å«åœ¨"Security setup"å¯¹è±¡ä¸­ï¼Œç”±AAåº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„`Association SN/Association LN`å¯¹è±¡çš„`security_setup_reference`å±æ€§å¼•ç”¨ï¼Œä¸`push_client_SAP`å±æ€§ç›¸å…³è”ï¼›ä»¥åŠpush_protection_parameterså±æ€§ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¯¹äºåœ¨è¯¥AAä¸­æ²¡æœ‰è¢«æˆäºˆè¯»å–è®¿é—®æƒçš„å±æ€§ï¼Œæˆ–è€…ç”±äºä»»ä½•å…¶ä»–åŸå› ä¸èƒ½è¢«è®¿é—®çš„å±æ€§ï¼Œåº”è¯¥è¿”å›ç©ºæ•°æ®ã€‚
- send_destination_and_method åŒ…å«`ç›®æ ‡åœ°å€`å’Œ`ä¼ è¾“æœåŠ¡`(ä¾‹å¦‚ç”µè¯å·ç ï¼Œç”µå­é‚®ä»¶åœ°å€ï¼ŒIPåœ°å€)ï¼Œç”¨äºå‘é€push_object_listæŒ‡å®šçš„æ•°æ®
  - transport_service ä¼ è¾“æœåŠ¡ç±»å‹ï¼Œå¦‚TCP,HDLC,Gatewayç­‰
  - destination ç›®çš„åœ°å€ï¼Œå–å†³äºtransport_serviceï¼Œæ¯”å¦‚CoAPåè®®çš„ç›®çš„åœ°å€æ—¶ä¸€ä¸ªCoAP URI,
  - message APDUç¼–ç ç±»å‹
    - (0) A-XDR encoded xDLMS APDU
    - (1) XML encoded xDLMS APDU
    - (128...255) manufacturer specific

  ä¸€ä¸ªPush setupå¯¹è±¡ä»…æ”¯æŒä¸€ä¸ªtransport_serviceå’Œdestinationï¼Œå¦‚æœåŒä¸€ä¸ªå†…å®¹éœ€è¦ä¸ŠæŠ¥ç»™å¤šä¸ªç›®çš„åœ°ï¼Œåˆ™éœ€è¦å¤šä¸ªä¸åŒå¯¹è±¡
- communication_window `é€šä¿¡çª—å£`ï¼ŒåŒ…å«å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´çš„åŒºé—´ï¼Œæ˜¯ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ ä¸ºä¸€ä¸ªåŒºé—´ã€‚å¦‚æœæ²¡æœ‰å…ƒç´ ï¼Œåˆ™ä¸é™åˆ¶çª—å£ï¼Œéšæ—¶å¯ä»¥æ¨é€
- randomisation_start_interval å‘é€ç¬¬ä¸€åŒ…å‰çš„`éšæœºç­‰å¾…`æ—¶é—´çš„`æœ€å¤§å€¼`ï¼Œä¸ºäº†é˜²æ­¢å¤§é‡åŒç½‘ç»œè®¾å¤‡åŒæ—¶æ¨é€ã€‚
  - éšæœºç­‰å¾…æ—¶é—´ä»0åˆ°æœ€å¤§å€¼éšæœº
  - ä»…åœ¨æ´»åŠ¨çª—å£å†…è°ƒç”¨pushç”Ÿæ•ˆï¼Œ`ä¸åœ¨é‡è¯•æ—¶ç”Ÿæ•ˆ`ï¼ˆpushå¤±è´¥åç­‰å¾…å›ºå®šå»¶è¿Ÿæ—¶é—´é‡è¯•ï¼Œä¸åº”ç”¨éšæœºç­‰å¾…æ—¶é—´ï¼‰
  - åœ¨æ´»åŠ¨çª—å£å¤–æ—¶pushï¼Œåˆ°è¾¾çª—å£å¼€å§‹æ—¶é—´æ—¶è®¡ç®—éšæœºå€¼
  - éšæœºå»¶è¿Ÿè¶…å‡ºçª—å£ç»“æŸæ—¶é—´ï¼Œé‚£è¦åˆ°ä¸‹ä¸€ä¸ªçª—å£æ‰èƒ½pushï¼Œè§ä¸Šä¸€èŠ‚çš„å›¾ç‰‡
  - æœªå®šä¹‰çª—å£æ—¶ï¼Œæ‰€æœ‰pushå’Œé‡è¯•éƒ½ä¼šåº”ç”¨éšæœºç­‰å¾…
- number_of_retries æœ€å¤§é‡è¯•æ¬¡æ•°
- repetition_delay é‡å‘å»¶è¿Ÿ
  - æœ€å°æ—¶é—´
  - æŒ‡æ•°ï¼Œç”¨äºè®¡ç®—ä¸‹æ¬¡å»¶è¿Ÿ
  - æœ€å¤§æ—¶é—´

  >ğ‘Ÿğ‘’ğ‘ğ‘’ğ‘¡ğ‘–ğ‘¡ğ‘–ğ‘œğ‘›_ğ‘‘ğ‘’ğ‘™ğ‘ğ‘¦ = ğ‘Ÿğ‘’ğ‘ğ‘’ğ‘¡ğ‘–ğ‘¡ğ‘–ğ‘œğ‘›_ğ‘‘ğ‘’ğ‘™ğ‘ğ‘¦_ğ‘šğ‘–ğ‘› Ã— (ğ‘Ÿğ‘’ğ‘ğ‘’ğ‘¡ğ‘–ğ‘¡ğ‘–ğ‘œğ‘›_ğ‘‘ğ‘’ğ‘™ğ‘ğ‘¦_ğ‘’ğ‘¥ğ‘ğ‘œğ‘›ğ‘’ğ‘›ğ‘¡ Ã— 0.01)^(ğ‘›âˆ’1)

  nè¡¨ç¤ºç¬¬å‡ æ¬¡ï¼Œn=1è¡¨ç¤ºç¬¬ä¸€æ¬¡é‡è¯•

  >**pushå†…å®¹æ²¡æœ‰ç¼“å­˜ï¼Œæ¯æ¬¡pushé‡è¯•ï¼Œå†…å®¹å¯èƒ½ä¼šå˜**

- port_reference é€šä¿¡ç«¯å£å¼•ç”¨ï¼Œå¼•ç”¨é€šä¿¡ç«¯å£setupå¯¹è±¡çš„logical_name,TODO:æŸ¥çœ‹å¯¹åº”ç« èŠ‚
- push_client_SAP å®¢æˆ·ç«¯SAP,æ¨é€ç›®æ ‡ï¼Œç»‘å®šå¯¹åº”çš„AA
- push_protection_parameters æ•°æ®ä¿æŠ¤å‚æ•°ï¼Œè§Data Protection IC
- push_operation_method å®šä¹‰æ˜¯å¦ä½¿ç”¨ `Service_Class` == `Unconfirmed` æˆ– `Confirmed` è°ƒç”¨ DataNotification.request æœåŠ¡åŸè¯­ä»¥åŠæ¨é€`é‡è¯•`çš„æ“ä½œ`æ–¹å¼`ã€‚
- confirmation_parameters ä»…ç”¨äºç›¸å¯¹é€‰æ‹©æ€§è®¿é—®æ—¶ï¼ˆè§æœ¬èŠ‚push_object_listä¸­çš„data_indexå’Œrestrictionï¼‰ï¼Œè¯¥å€¼å®šä¹‰é€‰æ‹©çš„æ¡ä»¶ï¼ˆå·²ç»è¢«ç¡®è®¤çš„æ¡ç›®ï¼Œå·²ç»è¢«ç¡®è®¤çš„ä¸å†æ¨é€ï¼‰ï¼Œé˜²æ­¢æ¨é€è¾ƒæ—©çš„æ•°æ®ã€‚å¦‚æœæ²¡æœ‰æ¡ç›®è¢«ç¡®è®¤åˆ™æ‰€æœ‰æ¡ç›®éƒ½ä¼šè¢«é€‰æ‹©ï¼Œå…¨éƒ¨æ¨é€
  - é€‰æ‹©æ¡ç›®å¼€å§‹æ—¶é—´
  - å½“å‰æ—¶é—´å¼€å§‹çš„å‘ååç§»æ—¶é—´ï¼Œç§’
- last_confirmation_date_time ä¿å­˜ `AL` æœ€è¿‘è°ƒç”¨ `DataNotification.confirm æœåŠ¡åŸè¯­`å¹¶æ”¶åˆ° `Result == CONFIRMED` çš„æ—¥æœŸå’Œæ—¶é—´ã€‚

æ–¹æ³•ï¼š

push (data) æ¿€æ´»ä¸€æ¬¡æ¨é€ï¼Œå‘é€æºå¸¦æ¨é€æ•°æ®çš„DataNot ification APDU
reset (data) é‡ç½®ä¸ºåˆå§‹çŠ¶æ€

## 4.4.9 COSEM data protection (class_id = 30, version = 0)

è¯¥ICçš„å®ä¾‹å…è®¸å¯¹`COSEMæ•°æ®`ï¼Œå³`å±æ€§å€¼`ã€`æ–¹æ³•`è°ƒç”¨å’Œ`è¿”å›å‚æ•°`åº”ç”¨`åŠ å¯†ä¿æŠ¤`ã€‚è¿™æ˜¯é€šè¿‡ "Data protection"æ¥å£ç±»çš„å®ä¾‹é—´æ¥è®¿é—®å…¶ä»–COSEMå¯¹è±¡çš„å±æ€§å’Œ/æˆ–æ–¹æ³•æ¥å®ç°çš„ï¼Œè¯¥æ¥å£ç±»æä¾›å¿…è¦çš„æœºåˆ¶å’Œå‚æ•°æ¥åº”ç”¨/éªŒè¯/ç§»é™¤å¯¹COSEMæ•°æ®çš„ä¿æŠ¤ã€‚

`ä¿æŠ¤å‚æ•°`æ€»æ˜¯ç”±`å®¢æˆ·ç«¯`æ§åˆ¶ï¼Œä¸€äº›å…ƒç´ ç”±æœåŠ¡å™¨é€‚å½“åœ°å¡«å……ã€‚`å®‰å…¨å¥—ä»¶`ç”±â€œ`Security setup`â€å¯¹è±¡å†³å®šï¼Œè¯¥å¯¹è±¡æ¥è‡ªå½“å‰çš„â€œAssociation SNâ€/â€œAssociation LNâ€å¯¹è±¡ã€‚

å±æ€§ï¼š

- protection_buffer åŒ…å«`å—ä¿æŠ¤çš„æ•°æ®`ã€‚è¯»å–æ—¶ï¼Œæ•è·ç”±protection_object_listæŒ‡å®šçš„å±æ€§ï¼Œç„¶åæ ¹æ®protection_parameters_getåº”ç”¨ä¿æŠ¤ã€‚å†™å…¥æ—¶ï¼Œå—ä¿æŠ¤çš„æ•°æ®è¢«æ”¾å…¥protection_bufferä¸­ï¼Œç„¶åæ ¹æ®protection_parameters_setéªŒè¯/åˆ é™¤ä¿æŠ¤ï¼Œå¹¶è®¾ç½®ç”±protection_object_listæŒ‡å®šçš„å±æ€§ã€‚
- protection_object_list å®šä¹‰åœ¨`è¯»å–`protection_bufferæ—¶è¦`æ•è·`çš„å±æ€§åˆ—è¡¨ï¼Œæˆ–è€…åœ¨`å†™å…¥`protection_bufferæ—¶è¦`è®¾ç½®`çš„å±æ€§åˆ—è¡¨ã€‚
  
  å…³äºé€‰æ‹©æ€§è®¿é—®çš„æè¿°è§Compact data
- protection_parameters_get åŒ…å«æ‰€æœ‰å¿…è¦çš„`å‚æ•°`ï¼Œç”¨äºæŒ‡å®š`è¯»å–`protection_bufferæ—¶åº”ç”¨çš„`ä¿æŠ¤`ã€‚è¿™ä¸ªå±æ€§é¦–å…ˆç”±`å®¢æˆ·ç«¯`å†™å…¥ã€‚æœåŠ¡å™¨å¯èƒ½éœ€è¦å¡«å†™ä¸€äº›é¢å¤–çš„å…ƒç´ ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å¿…é¡»è¯»å›è¿™ä¸ªå±æ€§â€”â€”å¦‚æœéœ€è¦çš„è¯ï¼Œè½¬å‘ç»™ç¬¬ä¸‰æ–¹â€”â€”ä»¥ä¾¿ä»–ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›å‚æ•°æ¥éªŒè¯/åˆ é™¤ä¿æŠ¤
- protection_parameters_set åŒ…å«æ‰€æœ‰`å¿…è¦çš„å‚æ•°`ï¼Œç”¨äºåœ¨`å†™å…¥`protection_bufferæ—¶`éªŒè¯/åˆ é™¤`åº”ç”¨çš„ä¿æŠ¤ã€‚å‚æ•°ä¸getç›¸åŒã€‚æ­¤å±æ€§ç”±å®¢æˆ·ç«¯ç¼–å†™ï¼Œå¹¶ç”±æœåŠ¡å™¨ä½¿ç”¨å®ƒæ¥éªŒè¯å’Œåˆ é™¤ä¿æŠ¤ã€‚
- required_protection è§„å®šäº†é€šè¿‡â€œData protectionâ€å¯¹è±¡è®¿é—®çš„`å±æ€§å€¼/è°ƒç”¨`å’Œ`æ–¹æ³•çš„è¿”å›å‚æ•°`æ‰€éœ€çš„ä¿æŠ¤ã€‚

  å¯¹äºrequestå’Œresponseçš„ä¿æŠ¤æ–¹å¼

æ–¹æ³•ï¼š

- get_protected_attributes (data) è·å–object_listå…ƒç´ æŒ‡å®šçš„å±æ€§çš„å€¼ï¼Œå¹¶åº”ç”¨get_protected_attributes_responseä¸­æ ¹æ®protection_parametersè®¾ç½®çš„ä¿æŠ¤

  get_protected_attributes_responseä¸­çš„protection_parameterså€¼æ˜¯æ ¹æ®å®¢æˆ·ç«¯å‚æ•°get_protected_attributes_requestä¸­çš„å¾—åˆ°çš„ï¼ŒæœåŠ¡ç«¯å¯èƒ½ä¼šæœ‰ä¿®æ”¹ï¼Œæ‰€ä»¥å¯èƒ½ä¼šæœ‰ä¸åŒ
- set_protected_attributes (data) æ ¹æ®protection_parameterså…ƒç´ ï¼Œåœ¨éªŒè¯å¹¶ç§»é™¤protected_attributeså…ƒç´ ä¸Šçš„ä¿æŠ¤ä¹‹åï¼Œè®¾ç½®object_listå…ƒç´ æŒ‡å®šçš„å±æ€§å€¼ã€‚
- invoke_protected_method (data) ä»¥ä¿æŠ¤æ–¹å¼æ‰§è¡Œç‰¹å®šæ–¹æ³•ï¼Œæ–¹æ³•çš„å‚æ•°å’Œè¿”å›å€¼è¢«ä¿æŠ¤ã€‚åœ¨æ ¹æ®invoke_protected_method_requestä¸­çš„protection_parameterséªŒè¯å¹¶ç§»é™¤protected_method_invocation_parametersä¸Šçš„`ä¿æŠ¤å`ï¼Œ`è°ƒç”¨`object_methodå…ƒç´ `æŒ‡å®šçš„æ–¹æ³•`ã€‚

  åœ¨è°ƒç”¨ç”± object_method å…ƒç´ æŒ‡å®šçš„æ–¹æ³•åï¼Œæ ¹æ® invoke_protected_method_response ä¸­çš„ protection_parameters çš„ä¿æŠ¤ï¼ˆå¿…é¡»æ»¡è¶³ required_protectionï¼‰åº”ç”¨äºè¿”å›å‚æ•°ï¼Œå¹¶ä¸”ç”± protection_parameters å’Œ protected_method_return_parameters ç»„æˆçš„ invoke_protected_method_response è¿”å›ã€‚
  
  ```asn.1
  invoke_protected_method_request ::= structure {
    object_method è¦æ‰§è¡Œçš„æ–¹æ³•
    protection_parameters: ä¿æŠ¤å‚æ•°
    object_method_definitionï¼š è¢«ä¿æŠ¤çš„å‚æ•°
    }

  invoke_protected_method_response ::= structure {
    protection_parameters: ä¿æŠ¤å‚æ•°
    protected_method_return_parameters: è¢«ä¿æŠ¤çš„è¿”å›å€¼ï¼ˆå‚æ•°ï¼‰
    }
  ```

    protection_parameterså¿…é¡»æ»¡è¶³required_protection

## 4.4.10 Function control (class_id: 122, version: 0)

ICâ€œFunction controlâ€çš„å®ä¾‹å…è®¸å¯ç”¨å’Œç¦ç”¨æœåŠ¡ç«¯ä¸­çš„åŠŸèƒ½ï¼ˆFunctionï¼‰ã€‚æ¯ä¸ªå¯ä»¥å¯ç”¨/ç¦ç”¨çš„åŠŸèƒ½éƒ½ç”±ä¸€ä¸ªåç§°æ ‡è¯†ï¼Œå¹¶ç”±å¼•ç”¨çš„ä¸€ç»„ç‰¹å®šå¯¹è±¡æ ‡è¯†ç¬¦å®šä¹‰ã€‚

ä¾èµ–â€œSingle action scheduleâ€å’Œâ€œScript tableâ€å¯¹è±¡å®ç°æŒ‰æ—¶é—´æ§åˆ¶åŠŸèƒ½ç¦ç”¨å¯ç”¨

å±æ€§ï¼š

- activation_status æ˜¾ç¤ºfunction_listå±æ€§ä¸­å®šä¹‰çš„æ¯ä¸ªåŠŸèƒ½å—çš„`å½“å‰çŠ¶æ€`(å¯ç”¨æˆ–ç¦ç”¨)
- function_list å®šä¹‰ä¸€ä¸ª`åŠŸèƒ½åˆ—è¡¨`ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨set_function_statusæ–¹æ³•å¯ç”¨æˆ–ç¦ç”¨è¿™äº›åŠŸèƒ½ã€‚é€šè¿‡class_idå’Œlogical_nameæŒ‡å®šï¼Œå½“åŠŸèƒ½ä¸èƒ½å¯¹åº”ç‰¹å®šçš„COSEMå¯¹è±¡æ—¶ï¼Œclass_idä¸º0ï¼Œlogical_nameä¸ºç‰¹å®šæè¿°æ–‡æœ¬ï¼Œ

æ–¹æ³•ï¼š

set_function_status (data) å¯ç”¨æˆ–ç¦ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªåŠŸèƒ½
add_function (data) æ·»åŠ ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œå¿…é¡»æ˜¯æœåŠ¡ç«¯æ”¯æŒçš„
remove_function (data) ç§»é™¤ä¸€ä¸ªæ–°åŠŸèƒ½

